// BvDReader.js
(function($){
Type.registerNamespace('BvD');BvD.FocusType=function(){};BvD.FocusType.prototype = {auto:1,pageTop:2,pageBottom:3,thumbnailUp:4,thumbnailDown:5,thumbnailLeft:6,thumbnailRight:7,thumbnailEnter:8,thumbnailFirstPage:9,thumbnailLastPage:10}
BvD.FocusType.registerEnum('BvD.FocusType',false);BvD.ReaderMode=function(){};BvD.ReaderMode.prototype = {html:1,images:2,flash:3}
BvD.ReaderMode.registerEnum('BvD.ReaderMode',false);BvD.ReaderView=function(){};BvD.ReaderView.prototype = {undefined:0,vertical:1,thumbnails:2,doubleVertical:3,horizontal:4,fit:5,singlePage:6,twoSinglePages:7,singlePageFullScreen:8}
BvD.ReaderView.registerEnum('BvD.ReaderView',false);BvD.RenditionLayout=function(){};BvD.RenditionLayout.prototype = {undefined:0,reflowable:1,prePaginated:2}
BvD.RenditionLayout.registerEnum('BvD.RenditionLayout',false);BvD.RenditionOrientation=function(){};BvD.RenditionOrientation.prototype = {undefined:0,landscape:1,portrait:2,auto:3}
BvD.RenditionOrientation.registerEnum('BvD.RenditionOrientation',false);BvD.RenditionPageSpread=function(){};BvD.RenditionPageSpread.prototype = {defaultBehavior:0,left:1,right:2,center:3}
BvD.RenditionPageSpread.registerEnum('BvD.RenditionPageSpread',false);BvD.RenditionSpread=function(){};BvD.RenditionSpread.prototype = {undefined:0,none:1,landscape:2,portrait:3,both:4,auto:5}
BvD.RenditionSpread.registerEnum('BvD.RenditionSpread',false);BvD.SelectionMode=function(){};BvD.SelectionMode.prototype = {defaultValue:-1,popup:0,autoHighlight:1,autoNote:2}
BvD.SelectionMode.registerEnum('BvD.SelectionMode',false);BvD.ZoomFit=function(){};BvD.ZoomFit.prototype = {width:1,height:2,screen:3,custom:4}
BvD.ZoomFit.registerEnum('BvD.ZoomFit',false);BvD.Bookmark=function(id,xmlid,utcDateTime,mode){if(xmlid==null){throw new Error(String.format(BvD.Errors.code16_1,'xmlid'));}if(utcDateTime==null){throw new Error(String.format(BvD.Errors.code16_1,'utcDateTime'));}this.id=id;this.xmlId=xmlid.toLowerCase();this.utcDateTime=utcDateTime;this.mode=mode;}
BvD.Bookmark.areEqual=function(bookmark1,bookmark2){if(bookmark1===bookmark2){return true;}if(bookmark1==null||bookmark2==null){return false;}return bookmark1.id===bookmark2.id&&bookmark1.xmlId===bookmark2.xmlId&&BvD.BowDate.areEqual(bookmark1.utcDateTime,bookmark2.utcDateTime)&&bookmark1.mode===bookmark2.mode;}
BvD.Bookmark.prototype={id:0,xmlId:null,utcDateTime:null,mode:0,equals:function(other){return BvD.Bookmark.areEqual(this,other);}}
BvD.BR$F=function(){this.$0={};this.$1={};this.$2=[];}
BvD.BR$F.prototype={add_$3:function($p0){this.$4=ss.Delegate.combine(this.$4,$p0);},remove_$3:function($p0){this.$4=ss.Delegate.remove(this.$4,$p0);},$4:null,$5:function(){return this.$2.clone();},$6:function($p0){return this.$1[$p0];},$7:function($p0){var $0=[];if($p0!=null){for(var $1=0;$1<$p0.length;++$1){var $2=this.$6($p0[$1]);if($2!=null){$0.add($2);}}}return $0;},$8:function($p0){return (String.isNullOrEmpty($p0))?null:this.$0[$p0.toLowerCase()];},$9:function($p0){var $0=[];if($p0!=null){for(var $1=0;$1<$p0.length;++$1){var $2=this.$8($p0[$1]);if($2!=null){$0.add($2);}}}return $0;},$A:function($p0){if($p0!=null){for(var $0=0;$0<$p0.length;++$0){var $1=this.$8($p0[$0]);if($1!=null){return true;}}}return false;},$B:function($p0){if(!this.$2.length&&($p0==null||!$p0.length)){return;}if($p0==null){$p0=[];}var $0=this.$C();var $1=[];var $2=null;for(var $3=0;$3<$p0.length;++$3){var $4=$p0[$3];if($0.contains($4.id)){$0.remove($4.id);}else{$1.add($4);}}$2=this.$7($0);if(!$1.length&&!$2.length){return;}this.$2.clear();Object.clearKeys(this.$0);Object.clearKeys(this.$1);if($p0.length>0){this.$2.addRange($p0);var $5=$p0.length;for(var $6=0;$6<$5;++$6){var $7=$p0[$6];this.$1[$7.id]=$7;this.$0[$7.xmlId]=$7;}}this.$D(new BvD.CollectionChangedEventArgs($1,$2,null));},$C:function(){var $0=[];for(var $1=0;$1<this.$2.length;++$1){$0.add(this.$2[$1].id);}$0.sort();return $0;},$D:function($p0){if(this.$4!=null){try{this.$4(this,$p0);}catch($0){BvD.ClientSideError.send('[Bookmarks] OnCollectionChanged',$0);}}}}
BvD.BookmarksManager=function(reader){if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}this.$1=reader;this.$3=this.$1.get_$1C().allowBookmarks;this.$2=new BvD.BR$F();this.$2.add_$3(ss.Delegate.create(this,this.$6));}
BvD.BookmarksManager.prototype={$0:null,$1:null,$2:null,$3:false,add_collectionChanged:function(value){this.$4=ss.Delegate.combine(this.$4,value);},remove_collectionChanged:function(value){this.$4=ss.Delegate.remove(this.$4,value);},$4:null,add_enabledChanged:function(value){this.$5=ss.Delegate.combine(this.$5,value);},remove_enabledChanged:function(value){this.$5=ss.Delegate.remove(this.$5,value);},$5:null,get_enabled:function(){return this.$3;},set_enabled:function(value){if(this.$3!==value){this.$3=value;this.reload();this.$7(ss.EventArgs.Empty);}return value;},get_list:function(){return this.$2.$5();},addOnCurrentPage:function(){var $0=this.$1.get_currentTocEntry();if($0!=null){this.add($0.get_xmlId());}},removeOnCurrentPage:function(){var $0=this.get_currentBookmark();if($0!=null){this.remove($0.id);}},getById:function(id){return this.$2.$6(id);},toggleOnCurrentPage:function(){if(this.get_currentPageIsBookmarked()){this.removeOnCurrentPage();}else{this.addOnCurrentPage();}},add:function(xmlid){try{if(this.get_readerWriter()!=null&&this.get_enabled()&&!String.isNullOrEmpty(xmlid)&&!this.isBookmarked(xmlid)){this.get_readerWriter().$0(xmlid);}}catch($0){BvD.ClientSideError.send('[BookmarksManager] Add - '+xmlid,$0);}},remove:function(id){try{if(this.get_readerWriter()!=null&&this.get_enabled()&&this.getById(id)!=null){this.get_readerWriter().$1(id);}}catch($0){BvD.ClientSideError.send('[BookmarksManager] Remove - '+id,$0);}},get_currentPageIsBookmarked:function(){return this.get_currentBookmark()!=null;},isBookmarked:function(xmlid){if(String.isNullOrEmpty(xmlid)||!this.$3){return false;}var $0=(this.$1.get_mode()===1)?this.$1.get_tableOfContents().getSectionEntries(xmlid):this.$1.get_tableOfContents().getPageEntries(xmlid);if($0==null||!$0.length){return false;}var $1=[];for(var $2=0;$2<$0.length;++$2){$1.add($0[$2].get_xmlId());}return this.$2.$A($1);},get_currentBookmark:function(){var $0=this.$1.get_currentTocEntry();if($0==null||!this.$3){return null;}var $1=$0.get_xmlId();var $2=(this.$1.get_mode()===1)?this.$1.get_tableOfContents().getSectionEntries($1):this.$1.get_tableOfContents().getPageEntries($1);if($2==null||!$2.length){return null;}for(var $3=0;$3<$2.length;++$3){var $4=this.$2.$8($2[$3].get_xmlId());if($4!=null){return $4;}}return null;},get_readerWriter:function(){return this.$0;},set_readerWriter:function(value){if(this.$0!==value){this.$0=value;this.reload();}return value;},reload:function(){if(this.get_readerWriter()==null||!this.get_enabled()){this.$2.$B(null);return;}try{var $0=this.get_readerWriter().$2();if($0!=null){this.$2.$B($0);}}catch($1){BvD.ClientSideError.send('[BookmarksManager] Reload',$1);}},$6:function($p0,$p1){if(this.$4!=null){try{this.$4(this,$p1);}catch($0){BvD.ClientSideError.send('[BookmarksManager] OnCollectionChanged',$0);}}},$7:function($p0){if(this.$5!=null){try{this.$5(this,$p0);}catch($0){BvD.ClientSideError.send('[BookmarksManager] OnEnabledChanged',$0);}}},$8:function(){var $0='';var $1=this.$2.$5();for(var $2=0;$2<$1.length;++$2){var $3=$1[$2];$0+=$3.xmlId+';'+$3.id+';';}return $0;}}
BvD.BookmarksParser=function(){}
BvD.BookmarksParser.parse=function(s){if(!String.isNullOrEmpty(s)){try{return BvD.BookmarksParser.$0(s);}catch($0){BvD.ClientSideError.send('[BookmarksParser] Parse',$0);}}return [];}
BvD.BookmarksParser.$0=function($p0){var $0=[];var $1=$.parseJSON($p0);var $dict1=$1;for(var $key2 in $dict1){var $2={key:$key2,value:$dict1[$key2]};var $3=$2.key;var $4=$2.value;var $5=-1;var $6=null;var $7=null;var $8=0;var $dict3=$4;for(var $key4 in $dict3){var $9={key:$key4,value:$dict3[$key4]};var $A=$9.key;var $B=$9.value;switch($A){case 'id':$5=$B;break;case 'xmlid':$6=$B;break;case 'date':$7=BvD.ServerDateTime.parse($B);break;case 'mode':$8=BvD.MathUtils.parseInt32($B.toString(),0);break;}}$0.add(new BvD.Bookmark($5,$6,new BvD.BowDate($7),$8));}return $0;}
BvD.BookmarksReaderWriter=function(){}
BvD.BookmarksReaderWriter.prototype={$0:function($p0){this.add($p0);},$1:function($p0){this.remove($p0);},$2:function(){return this.reload();}}
BvD.CollectionChangedEventArgs=function(addedItems,removedItems,updatedItems){BvD.CollectionChangedEventArgs.initializeBase(this);this.addedItems=addedItems;this.removedItems=removedItems;this.updatedItems=updatedItems;}
BvD.CollectionChangedEventArgs.prototype={addedItems:null,removedItems:null,updatedItems:null}
BvD.FlashAddNoteEventArgs=function(xmlid,type,coordinates,isNote,selectedText){BvD.FlashAddNoteEventArgs.initializeBase(this);this.xmlid=xmlid;this.type=type;this.coordinates=coordinates;this.isNote=isNote;this.selectedText=selectedText;}
BvD.FlashAddNoteEventArgs.prototype={xmlid:null,coordinates:null,isNote:false,type:0,selectedText:null}
BvD.FlashKeyEventArgs=function(code,ctrl,alt,shift,meta){BvD.FlashKeyEventArgs.initializeBase(this);this.code=code;this.ctrl=ctrl;this.alt=alt;this.shift=shift;this.meta=meta;}
BvD.FlashKeyEventArgs.prototype={code:0,ctrl:false,alt:false,shift:false,meta:false}
BvD.FlashLogHitEventArgs=function(xmlid){BvD.FlashLogHitEventArgs.initializeBase(this);this.xmlid=xmlid;}
BvD.FlashLogHitEventArgs.prototype={xmlid:null}
BvD.FlashNotesListEventArgs=function(ids,xmlid){BvD.FlashNotesListEventArgs.initializeBase(this);this.ids=ids;this.xmlid=xmlid;}
BvD.FlashNotesListEventArgs.prototype={ids:null,xmlid:null}
BvD.FlashRedirectEventArgs=function(url){BvD.FlashRedirectEventArgs.initializeBase(this);this.url=url;}
BvD.FlashRedirectEventArgs.prototype={url:null}
BvD.FlashRemoveNoteEventArgs=function(xmlid,id){BvD.FlashRemoveNoteEventArgs.initializeBase(this);this.xmlid=xmlid;this.id=id;}
BvD.FlashRemoveNoteEventArgs.prototype={xmlid:null,id:0}
BvD.FlashSelectNotesEventArgs=function(xmlid,selectionType){BvD.FlashSelectNotesEventArgs.initializeBase(this);this.xmlid=xmlid;this.selectionType=selectionType;}
BvD.FlashSelectNotesEventArgs.prototype={xmlid:null,selectionType:null}
BvD.FlashSomPanelStateEventArgs=function(oldState,newState,viewerId){BvD.FlashSomPanelStateEventArgs.initializeBase(this);this.oldState=oldState;this.newState=newState;this.viewerId=viewerId;}
BvD.FlashSomPanelStateEventArgs.prototype={oldState:0,newState:0,viewerId:0}
BvD.LinkEventArgs=function(jevent,link){BvD.LinkEventArgs.initializeBase(this);this.jEvent=jevent;this.link=link;}
BvD.LinkEventArgs.prototype={jEvent:null,link:null}
BvD.ReaderViewEventArgs=function(oldView,newView){BvD.ReaderViewEventArgs.initializeBase(this);this.oldView=oldView;this.newView=newView;}
BvD.ReaderViewEventArgs.prototype={oldView:0,newView:0}
BvD.Selection2EventArgs=function(selection){BvD.Selection2EventArgs.initializeBase(this);if(selection==null){throw new Error(String.format(BvD.Errors.code16_1,'selection'));}this.selection=selection;}
BvD.Selection2EventArgs.prototype={selection:null}
BvD.SelectionEventArgs=function(xmlId,type,text,offsets,positionStart,positionEnd,normalizedPositionStart,normalizedPositionEnd){BvD.SelectionEventArgs.initializeBase(this);this.xmlId=xmlId;this.type=type;this.text=text;this.offsets=offsets;this.positionStart=positionStart;this.positionEnd=positionEnd;this.normalizedPositionStart=normalizedPositionStart;this.normalizedPositionEnd=normalizedPositionEnd;if(this.positionStart!=null&&this.positionEnd!=null){this.rectangle=BvD.Rectangle.fromLTRB(this.positionStart.left,this.positionStart.top,this.positionEnd.left,this.positionEnd.top);}if(this.normalizedPositionStart!=null&&this.normalizedPositionEnd!=null){this.normalizedRectangle=BvD.Rectangle.fromLTRB(this.normalizedPositionStart.left,this.normalizedPositionStart.top,this.normalizedPositionEnd.left,this.normalizedPositionEnd.top);}}
BvD.SelectionEventArgs.prototype={xmlId:null,type:0,text:null,offsets:null,positionStart:null,positionEnd:null,rectangle:null,normalizedPositionStart:null,normalizedPositionEnd:null,normalizedRectangle:null}
BvD.BR$1B=function(config,tableOfContents){this.$20='';this.$21=-1;this.$27='';BvD.BR$1B.initializeBase(this,[config,tableOfContents]);BvD.BR$1B.$1D=this;this.$26=new BvD.BR$16();this.get_bookmarks().add_collectionChanged(ss.Delegate.create(this,this.$29));this.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$2A));BvD.Layer.add_layerShown(ss.Delegate.create(this,this.$31));BvD.Layer.add_layerHidden(ss.Delegate.create(this,this.$31));BvD.AjaxEngine.get_history().add_changed(ss.Delegate.create(this,this.$32));}
BvD.BR$1B.prototype={$1E:false,$1F:false,$22:null,$23:null,$24:true,$25:false,$26:null,showNotes:function($p0){if(this.$1E){this.get_$2B().ShowNotes($p0);}},get_mode:function(){return 3;},start:function(){if(this.$1F){return;}this.$1F=true;if(!BvD.Flash.get_enabled()){this.onNoFlashDetected(ss.EventArgs.Empty);return;}this.$2C();},get_is508Enabled:function(){return this.get_$1C().is508Enabled;},smartPageDown:function(){if(this.get_isReady()){this.get_$2B().SmartPageDown();}},smartPageUp:function(){if(this.get_isReady()){this.get_$2B().SmartPageUp();}},previous:function(){if(this.$1E){this.get_$2B().Previous();}},next:function(){if(this.$1E){this.get_$2B().Next();}},goTo:function($p0){if(this.$1E){var $0=this.get_tableOfContents().getByXmlId($p0);if($0!=null&&!$0.get_isBvdPage()){$0=$0.getFirstDescendantOrFollowingBvdPage();if($0!=null){$p0=$0.get_xmlId();}}this.get_$2B().GoXMLID($p0);}},get_currentTocEntry:function(){return (this.$1E)?this.get_tableOfContents().getByXmlId(this.get_$2B().GetCurrentXMLID()):null;},isOnThisXmlid:function($p0){return this.$1E&&this.get_$2B().IsOnThisXMLID($p0);},get_isFirstPage:function(){return this.$1E&&this.get_$2B().BOB();},get_isLastPage:function(){return this.$1E&&this.get_$2B().EOB();},zoomIn:function(){if(this.$1E){this.get_$2B().ZoomIn();}},zoomOut:function(){if(this.$1E){this.get_$2B().ZoomOut();}},zoomPageWidth:function(){if(this.$1E){this.get_$2B().ZoomPageWidth();}},zoomPageHeight:function(){if(this.$1E){this.get_$2B().ZoomPageHeight();}},get_zoomFit:function(){return 4;},get_isFixedLayout:function(){return true;},get_zoomLevel:function(){if(this.$1E){var $0=this.get_$2B().GetZoomLevel();return (!$0)?-1:$0;}return -1;},set_zoomLevel:function($p0){if(this.$1E){this.get_$2B().SetZoomLevel($p0);}return $p0;},get_isFirstZoomLevel:function(){return this.$1E&&this.get_$2B().IsFirstZoomLevel();},get_isLastZoomLevel:function(){return this.$1E&&this.get_$2B().IsLastZoomLevel();},get_grab:function(){return this.$25;},set_grab:function($p0){if(this.get_isReady()){this.get_$2B().Grab($p0);}return $p0;},get_view:function(){return (this.$1E)?this.$2E(this.get_$2B().GetCurrentViewId()):0;},set_view:function($p0){if(!$p0){throw new Error(String.format(BvD.Errors.code3_1,$p0));}if(this.$1E){this.get_$2B().ChangeView($p0);}return $p0;},reload:function(){if(this.$1E){this.get_$2B().Reload();}},print:function(){this.print2('',1);},print2:function($p0,$p1){if(this.get_isReady()){this.get_$2B().Print($p0,$p1,this.get_$1C().flashPrintHeader,this.get_$1C().flashPrintFooter);}},setFocus:function($p0){if(this.$1E){this.get_$2B().SetPageFocus(null,null,$p0);}},setSearchTerms:function($p0){this.$20=$p0;this.$28();},showSearchTerms:function($p0){if(this.$1E){this.get_$2B().ShowSearchTerms($p0);}},get_selectionMode:function(){return this.$21;},set_selectionMode:function($p0){if(!this.$1E){return;}this.$21=$p0;this.get_$2B().SetSelectionMode(this.$21);return $p0;},get_selections:function(){return this.$26;},setFlashToc:function($p0){this.$27=$p0;},get_touchScrollingEnabled:function(){return this.$2F('m_MouseMode')==='2';},set_touchScrollingEnabled:function($p0){this.$30('m_MouseMode',($p0)?'2':'1');return $p0;},createConfig:function($p0,$p1,$p2){if(this.$1E){try{return this.get_$2B().CreateConfig($p0,$p1,$p2);}catch($0){BvD.ClientSideError.send('[FlashReader] CreateConfig(controlerConfig:'+$p0+', currentViewConfig:'+$p1+', allViewsConfig:'+$p2+')',$0);}}return '';},loadConfig:function($p0,$p1,$p2,$p3){if(this.$1E){try{return this.get_$2B().LoadConfig($p0,$p1,$p2,$p3);}catch($0){BvD.ClientSideError.send('[FlashReader] LoadConfig(st:'+$p0+', controlerConfig:'+$p1+', currentViewConfig:'+$p2+', allViewsConfig:'+$p3+')',$0);}}return '';},getExtraURLParameter:function($p0){return (this.$1E)?this.get_$2B().GetExtraURLParameter($p0):null;},setExtraURLParameter:function($p0,$p1){if(this.$1E){this.get_$2B().SetExtraURLParameter($p0,$p1);}},readPage:function(){if(this.get_isReady()&&this.get_is508Enabled()){this.get_$2B().ReadPage();}},getIdealHeight:function($p0){return (this.$1E)?this.get_$2B().GetIdealHeight($p0):0;},emulateMouseWheel:function($p0){if(this.$1E){this.get_$2B().EmulMouseWheel($p0);}},$28:function(){if(this.$1E){this.get_$2B().SetSearchTerms(this.$20);}},$29:function($p0,$p1){if(this.$1E){this.get_$2B().SetBookmarks(this.get_bookmarks().$8());}},$2A:function($p0,$p1){if(this.$1E){this.get_$2B().ReloadNotesCurrentPage();var $0=[];for(var $1=0;$1<$p1.addedItems.length;++$1){var $2=$p1.addedItems[$1];if(!$0.contains($2.xmlId)){$0.add($2.xmlId);}}for(var $3=0;$3<$p1.removedItems.length;++$3){var $4=$p1.removedItems[$3];if(!$0.contains($4.xmlId)){$0.add($4.xmlId);}}for(var $5=0;$5<$p1.updatedItems.length;++$5){var $6=$p1.updatedItems[$5];if(!$0.contains($6.xmlId)){$0.add($6.xmlId);}}this.get_$2B().ReloadNotesOnXmlId($0);}},get_$2B:function(){if(this.$23==null){var $0=document.getElementById(this.get_$1C().viewerId);if(!BvD.Is.NullOrUndefined($0)){this.$23=$0;}}return this.$23;},$2C:function(){var $0={};$0['codebase']='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0';$0['width']='100%';$0['height']='100%';$0['quality']='high';$0['pluginspage']='http://www.macromedia.com/go/getflashplayer';$0['align']='middle';$0['play']='true';$0['loop']='true';$0['scale']='showall';$0['devicefont']='false';$0['id']=this.get_$1C().viewerId;$0['bgcolor']='#ffffff';$0['name']=this.get_$1C().viewerId;$0['menu']='true';$0['allowFullScreen']='false';$0['allowScriptAccess']='always';$0['movie']=BvD.Utils.filePath((String.isNullOrEmpty(this.get_$1C().flashFile))?'viewer':this.get_$1C().flashFile);$0['salign']='lt';$0['wmode']=((this.get_$1C().is508Enabled)?'window':'transparent');$0['tabindex']='0';$0['accesskey']=this.get_$1C().accessKey;$('#'+this.get_$1C().containerId)[0].innerHTML=BvD.Flash.getHtml($0);},$2D:function(){var $0=ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();var $1_0=BvD.Mouse.getWheelDelta($p1_0);this.get_$2B().externalMouseEvent($1_0);});$('#'+this.get_$1C().containerId).on('DOMMouseScroll.bowFlashReader mousewheel.bowFlashReader',$0);},$2E:function($p0){switch($p0){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;default:return 0;}},$2F:function($p0){return (this.$1E)?this.get_$2B().GetAdditionalConfig($p0):null;},$30:function($p0,$p1){if(this.$1E){this.get_$2B().SetAdditionalConfig($p0,$p1);}},$31:function($p0,$p1){if(this.get_is508Enabled()){var $0=$(this.get_$2B());var $1=!BvD.Layer.get_countOpened();if($1){if(this.$22!=null){this.$22.remove();this.$22=null;}$0.show();}else{var $2=$0.width();var $3=$0.height();this.$22=$('<div></div>');this.$22.css('width',$2+'px').css('height',$3+'px');$0.hide();this.$22.insertAfter($0);}}},$32:function($p0,$p1){try{if($p1.componentName==='BvdepFlashReader'){var $0=BvD.QueryString.parse($p1.queryString);var $1=$0.get('xmlid');if($1==null){$1=this.get_$1C().xmlId.xmlId;}var $2=this.get_currentTocEntry();if($2!=null){var $3=$2.get_xmlId();if(!String.equals($1,$3,true)){this.$24=false;this.goTo($1);}}}}catch($4){}},$33:function(){try{var $0=this.get_$2B();if($0==null){throw new Error(BvD.Errors.code3_2);}if(this.$1E){throw new Error(BvD.Errors.code3_3);}if(this.get_$1C().xmlId.isBookOnly){throw new Error(BvD.Errors.code3_4);}$($0).css('outline','none');$0.EnableBookmarks(this.get_$1C().allowBookmarks);$0.EnableNotes(this.get_$1C().allowNotes);$0.EnableHighlights(this.get_$1C().allowHighlights);$0.SetPreviewChunk(this.get_$1C().flashPreviewMessage);$0.EnableSOMLinks(this.get_$1C().showSoms);$0.SetSomPanelState(this.get_$1C().somState);$0.SetStaticPath(BvD.Xsl.get_staticPath());if(!String.isNullOrEmpty(this.get_$1C().flashOfflineVersion)){$0.SetOfflineVersions(this.get_$1C().flashOfflineVersion);}if(!String.isNullOrEmpty(this.get_$1C().link)){$0.SetExtraURLParameter('link',this.get_$1C().link);}if(this.get_$1C().flashSearchHighlightHeuristicEnabled){$0.SetAdditionalConfig('m_SearchHighlightHeuristicEnabled','1');}var $1=this.get_$1C().xmlId;var $2=this.get_tableOfContents().getByBooKSection(this.get_$1C().xmlId).getFirstDescendantOrFollowingBvdPage();if($2!=null){$1=BvD.BookSection.parse($2.get_xmlId());}$0.Init($1.bookId,$1.sectionId,'');this.$1E=true;this.$2D();this.$29(null,null);this.$28();if(!String.isNullOrEmpty(this.get_$1C().flashInitialConfig)){this.loadConfig(this.get_$1C().flashInitialConfig,true,-2,true);}}catch($3){BvD.ClientSideError.send('[FlashReader] Initiate',$3);}},$34:function(){if(!this.get_isReady()){this.set_isReady(true);this.onReaderReady(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);}},$35:function($p0,$p1){this.onViewChanged(new BvD.ReaderViewEventArgs(this.$2E($p0),this.$2E($p1)));},$36:function($p0){if(this.$24){BvD.AjaxEngine.get_history().locationChanged('BvdepFlashReader','xmlid='+$p0);}else{this.$24=true;}this.onPageChanged(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);},$37:function($p0,$p1){this.onZoomChanged(ss.EventArgs.Empty);},$38:function($p0,$p1,$p2,$p3,$p4){if(BvD.Browser.isChrome){return;}if(!BvD.Browser.isMac&&!BvD.Browser.isOpera&&!BvD.Browser.isIE&&(BvD.Browser.isGecko&&!this.get_is508Enabled())){return;}this.onKeyPressed(new BvD.FlashKeyEventArgs($p0,$p1,$p2,$p3,$p4));},$39:function(){this.$25=true;this.onGrabChanged(ss.EventArgs.Empty);},$3A:function(){this.$25=false;this.onGrabChanged(ss.EventArgs.Empty);},$3B:function($p0){this.onLinkClicked(new BvD.LinkEventArgs(null,$p0));},$3C:function($p0){this.get_bookmarks().add($p0);},$3D:function($p0){this.get_bookmarks().remove($p0);},$3E:function($p0,$p1,$p2,$p3,$p4,$p5,$p6){this.onNoteAdded(new BvD.FlashAddNoteEventArgs($p0,$p2,new BvD.Rectangle($p4,$p3,$p5-$p3,$p6-$p4),$p1,this.get_$2B().GetSelectedText()));},$3F:function($p0){return this.get_notes().$A($p0);},$40:function($p0){return this.get_notes().$B($p0);},$41:function(){var $0='';var $1=this.get_notes().get_list();for(var $2=0;$2<$1.length;++$2){$0+=$1[$2].xmlId+';';}return $0;},$42:function($p0,$p1){if(String.isNullOrEmpty($p0)){return;}var $0=$p0.split(';');if($0==null||!$0.length){return;}var $1=[];for(var $2=0;$2<$0.length;++$2){var $3=$0[$2];$1.add(parseInt($3,10));}this.get_notes().$8($1,$p1);},$43:function($p0){this.onRedirected(new BvD.FlashRedirectEventArgs($p0));},$44:function($p0,$p1,$p2){this.onSomPanelStateChanged(new BvD.FlashSomPanelStateEventArgs($p0,$p1,$p2));},$45:function($p0,$p1){this.onNoteRemoved(new BvD.FlashRemoveNoteEventArgs($p1,$p0));},$46:function($p0,$p1){this.onAllNotesSelected(new BvD.FlashSelectNotesEventArgs($p0,$p1));},$47:function($p0){this.onLogHit(new BvD.FlashLogHitEventArgs($p0));return $p0;},$48:function(){return this.$27;}}
window.ViewerSafariKey=function(){try{return BvD.Xsl.get_sessionKey();}catch($0){BvD.ClientSideError.send('[FlashReaderCallbacks] ViewerSafariKey',$0);return '';}}
window.OfflineViewerGetBookAvailableTOC=function(){try{return BvD.BR$1B.$1D.$48();}catch($0){BvD.ClientSideError.send('[FlashReaderCallbacks] OfflineViewerGetBookAvailableTOC',$0);return '';}}
window.ViewerBookFailed=function($p0,$p1){BvD.ClientSideError.send('[FlashReaderCallbacks] ViewerBookFailed('+$p0+') - '+$p1,null);}
window.ViewerPageFailed=function($p0,$p1,$p2){BvD.ClientSideError.send('[FlashReaderCallbacks] ViewerPageFailed('+$p0+','+$p1+') - '+$p2,null);}
window.ViewerInitialized=function(){BvD.Timer.setTimeout('ViewerInitialized',10,ss.Delegate.create(BvD.BR$1B.$1D,BvD.BR$1B.$1D.$33));}
window.ViewerOnBookLoaded=function(){BvD.BR$1B.$1D.$34();}
window.ViewerOnLink=function($p0){if(!BvD.Is.String($p0)){$p0=null;}BvD.BR$1B.$1D.$3B($p0);}
window.ViewerOnKeyPressed=function($p0,$p1,$p2,$p3){if(!BvD.Is.Int32($p0)){$p0=0;}if(!BvD.Is.Boolean($p1)){$p1=false;}if(!BvD.Is.Boolean($p2)){$p2=false;}if(!BvD.Is.Boolean($p3)){$p3=false;}BvD.BR$1B.$1D.$38($p0,$p1,$p2,$p3,$p1);}
window.ViewerOnGrab=function($p0){if(!BvD.Is.Boolean($p0)){$p0=false;}if($p0){BvD.BR$1B.$1D.$39();}else{BvD.BR$1B.$1D.$3A();}}
window.ViewerViewChanged=function($p0,$p1){if(!BvD.Is.Int32($p0)){$p0=0;}if(!BvD.Is.Int32($p1)){$p1=0;}BvD.BR$1B.$1D.$35($p0,$p1);}
window.ViewerOnZoomChanged=function($p0,$p1){if(!BvD.Is.DoubleNumber($p0)){$p0=0;}if(!BvD.Is.Int32($p1)){$p1=0;}BvD.BR$1B.$1D.$37($p0,$p1);}
window.ViewerGetNotes=function($p0){if(!BvD.Is.String($p0)){$p0=null;}return BvD.BR$1B.$1D.$3F($p0);}
window.ViewerJSonGetNotes=function($p0){if(!BvD.Is.String($p0)){$p0=null;}return BvD.BR$1B.$1D.$40($p0);}
window.ViewerOnPageChange=function($p0,$p1){if(!BvD.Is.String($p0)){$p0=null;}BvD.BR$1B.$1D.$36($p0);}
window.ViewerOnBookmarksAdd=function($p0){if(!BvD.Is.String($p0)){$p0=null;}BvD.BR$1B.$1D.$3C($p0);}
window.ViewerOnBookmarksRemove=function($p0){var $0=BvD.MathUtils.parseInt32($p0,-1);if($0===-1){$0=-2;}BvD.BR$1B.$1D.$3D($0);}
window.ViewerOnNotesSelected=function($p0,$p1){if(!BvD.Is.String($p0)){$p0=null;}if(!BvD.Is.String($p1)){$p1=null;}BvD.BR$1B.$1D.$42($p0,$p1);}
window.ViewerOnAddNote=function($p0,$p1,$p2,$p3,$p4,$p5,$p6){if(!BvD.Is.String($p0)){$p0=null;}if(!BvD.Is.Boolean($p1)){$p1=false;}if(!BvD.Is.Int32($p2)){$p2=0;}if(!BvD.Is.Int32($p3)){$p3=0;}if(!BvD.Is.Int32($p4)){$p4=0;}if(!BvD.Is.Int32($p5)){$p5=0;}if(!BvD.Is.Int32($p6)){$p6=0;}BvD.BR$1B.$1D.$3E($p0,$p1,$p2,$p3,$p4,$p5,$p6);}
window.ViewerOnSomPanelStateChanged=function($p0,$p1,$p2){if(!BvD.Is.Int32($p0)){$p0=0;}if(!BvD.Is.Int32($p1)){$p1=0;}if(!BvD.Is.Int32($p2)){$p2=0;}BvD.BR$1B.$1D.$44($p0,$p1,$p2);}
window.ViewerGetAllXmlidsWithNotes=function(){return BvD.BR$1B.$1D.$41();}
window.ViewerRedirect=function($p0){if(!BvD.Is.String($p0)){$p0=null;}BvD.BR$1B.$1D.$43($p0);}
window.ViewerOnRemoveNote=function($p0,$p1){if(!BvD.Is.String($p1)){$p1=null;}var $0=0;if(BvD.Is.String($p0)){$0=BvD.MathUtils.parseInt32($p0,0);}else if(BvD.Is.Int32($p0)){$0=$p0;}BvD.BR$1B.$1D.$45($0,$p1);}
window.ViewerOnAllNotesSelected=function($p0,$p1){if(!BvD.Is.String($p0)){$p0=null;}if(!BvD.Is.String($p1)){$p1=null;}BvD.BR$1B.$1D.$46($p0,$p1);}
window.OfflineViewerDoLogHit=function($p0){if(!BvD.Is.String($p0)){$p0=null;}return BvD.BR$1B.$1D.$47($p0);}
BvD.BR$16=function(){BvD.BR$16.initializeBase(this);}
BvD.epubReadingSystem=function(){}
BvD.epubReadingSystem.prototype={name:'Bureau_van_Dijk_Reader',version:'8.5',layoutStyle:'reflowable',domManipulation:true,layoutChanges:true,touchEvents:true,mouseEvents:true,keyboardEvents:true,spineScripting:true,hasFeature:function($p0){if(String.isNullOrEmpty($p0)){return false;}$p0=$p0.replaceAll('-','').toLowerCase();switch($p0){case 'dommanipulation':return this.domManipulation;case 'layoutchanges':return this.layoutChanges;case 'touchevents':return this.touchEvents;case 'mouseevents':return this.mouseEvents;case 'keyboardevents':return this.keyboardEvents;case 'spinescripting':return this.spineScripting;default:return false;}}}
BvD.BR$14=function(config,tableOfContents){this.$23=[];this.$24=new Array(2);this.$28=6;this.$2D=-1;this.$2F=3;BvD.BR$14.initializeBase(this,[config,tableOfContents]);this.$37();this.$38();this.$3B();this.$29=new BvD.BR$15(this);this.set_contentsNavigator(new BvD.HtmlContentsNavigator(this.get_tableOfContents()));if(this.get_$1C().useHtmlIFrame){this.$39();this.$33=[];this.$2C=BvD.IFrameProxy.of('#'+this.get_$1C().viewerId);BvD.AjaxEngine.setIFrame(this.get_$1C().ajaxComponent);this.$2C.on('click.bowHtmlReader','a[href]',ss.Delegate.create(this,this.$4B));this.$2C.add_changing(ss.Delegate.create(this,this.$3A));this.$2C.add_changed(ss.Delegate.create(this,this.$50));$(document).on('orientationchange',ss.Delegate.create(this,this.$56));}else{$(document).on('click.bowHtmlReader','#'+this.get_$1C().viewerId+' a[href]',ss.Delegate.create(this,this.$4B));}BvD.AjaxEngine.onPanelReady(this.get_$1C().ajaxComponent,ss.Delegate.create(this,this.$4E));}
BvD.BR$14.prototype={$20:null,$21:false,$22:null,$25:null,$26:null,$27:null,$29:null,$2A:'',$2B:false,$2C:null,$2E:true,$30:null,$31:false,$32:null,$33:null,$34:null,$35:null,$36:null,get_mode:function(){return 1;},prefetchPrevious:function(){if(this.get_isReady()){var $0=this.get_currentTocEntry();var $1=this.$53();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){this.$3F($0.get_xmlId(),$1,true);}else{var $2=this.get_contentsNavigator().preceding(this.$34[0]);if($2!=null){this.$3F($2.get_xmlId(),'',true);}}}},previous:function(){if(this.get_isReady()){var $0=this.get_currentTocEntry();var $1=this.$53();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){this.$3F($0.get_xmlId(),$1,false);}else{var $2=this.get_contentsNavigator().preceding(this.$34[0]);if($2!=null){this.$3F($2.get_xmlId(),'',false);}}}},prefetchNext:function(){if(this.get_isReady()){var $0=this.get_currentTocEntry();var $1=this.$54();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){this.$3F($0.get_xmlId(),$1,true);}else{var $2=this.get_contentsNavigator().following(this.$34[this.$34.length-1]);if($2!=null){this.$3F($2.get_xmlId(),'',true);}}}},next:function(){if(this.get_isReady()){var $0=this.get_currentTocEntry();var $1=this.$54();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){this.$3F($0.get_xmlId(),$1,false);}else{var $2=this.get_contentsNavigator().following(this.$34[this.$34.length-1]);if($2!=null){this.$3F($2.get_xmlId(),'',false);}}}},prefetchGoTo:function($p0){if(!this.get_isReady()||String.isNullOrEmpty($p0)){return;}if($p0.indexOf('/')===-1){var $0=this.get_tableOfContents().getEpubAnchor($p0);if($0!=null){this.$2A=$0.anchor;this.$3F($0.tocEntry.get_xmlId(),'',true);return;}}this.$3F($p0,'',true);},goTo:function($p0){if(!this.get_isReady()||String.isNullOrEmpty($p0)){return;}if($p0.indexOf('/')===-1){var $0=this.get_tableOfContents().getEpubAnchor($p0);if($0!=null){this.$2A=$0.anchor;this.$3F($0.tocEntry.get_xmlId(),'',false);return;}}this.$3F($p0,'',false);},get_currentTocEntry:function(){return (this.get_isReady())?this.$34[0]:null;},get_displayedTocEntries:function(){return (this.get_isReady())?this.$34.clone():new Array(0);},isOnThisXmlid:function($p0){return this.get_isReady()&&this.get_tableOfContents().isSameSection(this.$25,$p0);},get_isFirstPage:function(){if(!this.get_isReady()){return false;}var $0=this.get_currentTocEntry();var $1=this.$53();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){return false;}return this.get_contentsNavigator().preceding(this.$34[0])==null;},get_isLastPage:function(){if(!this.get_isReady()){return false;}var $0=this.get_currentTocEntry();var $1=this.$54();if($0.get_isIndex()&&!String.isNullOrEmpty($1)){return false;}return this.get_contentsNavigator().following(this.$34[this.$34.length-1])==null;},zoomIn:function(){if(this.get_isReady()){this.$44(this.$24[(this.$2E)?1:0]+BvD.BR$14.$1F,4,true);}},zoomOut:function(){if(this.get_isReady()){this.$44(this.$24[(this.$2E)?1:0]-BvD.BR$14.$1F,4,true);}},zoomPageWidth:function(){if(this.get_isReady()&&this.$2E){this.$46(this.$24[(this.$2E)?1:0],1,true);}},zoomPageHeight:function(){if(this.get_isReady()&&this.$2E){this.$46(this.$24[(this.$2E)?1:0],2,true);}},zoomPageScreen:function(){if(this.get_isReady()&&this.$2E){this.$46(this.$24[(this.$2E)?1:0],3,true);}},get_zoomFit:function(){return this.$2F;},get_isFixedLayout:function(){return this.$2E;},get_zoomLevel:function(){return (this.get_isReady())?this.$24[(this.$2E)?1:0]:-1;},set_zoomLevel:function($p0){if(this.get_isReady()){this.$44($p0,4,true);}return $p0;},get_isFirstZoomLevel:function(){return this.get_isReady()&&this.$24[(this.$2E)?1:0]<=BvD.BR$14.$1D;},get_isLastZoomLevel:function(){return this.get_isReady()&&this.$24[(this.$2E)?1:0]>=BvD.BR$14.$1E;},get_view:function(){return this.$28;},set_view:function($p0){if(this.$28===$p0){return;}var $0=this.$28;if($p0===2){this.$28=$p0;$('#'+this.get_$1C().viewerId).hide();this.get_thumbnails().$9();this.get_thumbnails().$E(this.get_currentTocEntry().get_xmlId());}else if($p0===6){this.$28=$p0;$('#'+this.get_$1C().viewerId).show();}if($0!==this.$28){this.onViewChanged(new BvD.ReaderViewEventArgs($0,this.$28));}return $p0;},reload:function(){this.$48(null,null,false);},print:function(){if(this.get_isReady()){if(this.$20!=null){try{this.$20.close();this.$20=null;}catch($2){}}var $0='/print?xmlid='+encodeURIComponent(this.$25);var $1='directories=no,menubar=no,status=no,location=no,scrollbars=yes,resizable=yes';this.$20=window.open($0,'Print',$1);}},print2:function($p0,$p1){this.print();},setQuery:function($p0){if($p0==null){$p0='';}$p0=$p0.trim();if($p0===this.$27){return;}BvD.Cookies.setStateValueParameter('query',$p0);this.$27=$p0;this.reload();},showSearchTerms:function($p0){this.$2B=$p0;this.$40().toggleClass('showhighlights',$p0);},get_currentQuery:function(){return (this.get_isReady())?$('#Reader_Query').val():'';},get_selections:function(){return this.$29;},forceReload:function($p0){if($p0==null){$p0=this.get_$1C().xmlId.toString();}var $0=this.get_tableOfContents().getByXmlId($p0);$0=this.$4A($0);if($0!=null){$p0=$0.get_xmlId();}var $1=new BvD.QueryString().set('xmlid',$p0).set('query',this.$27);BvD.Ajax.link($1,this.get_$1C().ajaxComponent);},$37:function(){try{this.$21=BvD.QueryString.parse(BvD.Uri.get_current().query).get('__disablefxl')==='1';}catch($0){}},$38:function(){this.$32=new BvD.Css('BowHtmlReaderFixedLayout');this.$32.get('#HtmlAjax').set('left','0').set('right','0').set('bottom','0').set('top','0').set('position','absolute');this.$32.get('#HtmlAjax > div').set('position','relative').set('overflow','hidden');this.$32.get('#HtmlAjax > div > div').set('position','relative').set('transform-origin','0 0');},$39:function(){this.$22=new BvD.epubReadingSystem();window.navigator.epubReadingSystem=this.$22;},$3A:function($p0,$p1){this.$2C.get_windows().each(ss.Delegate.create(this,function($p1_0,$p1_1){
$p1_1.navigator.epubReadingSystem=this.$22;}));},$3B:function(){this.$24[0]=this.get_$1C().zoom;this.$24[1]=this.get_$1C().zoom/100;if(this.get_$1C().zoomConfig!=null){BvD.BR$14.$1E=this.get_$1C().zoomConfig.maxZoomLevel;BvD.BR$14.$1D=this.get_$1C().zoomConfig.minZoomLevel;BvD.BR$14.$1F=this.get_$1C().zoomConfig.zoomStep;}},$3C:function(){if(this.$33.length>0){var $enum1=ss.IEnumerator.getEnumerator(this.$33);while($enum1.moveNext()){var $0=$enum1.current;$0.disconnect();}this.$33.clear();}try{var $1={};$1.childList=true;$1.subtree=true;var $2=this.$2C.get_documents();for(var $3=0;$3<$2.length;++$3){var $4=new MutationObserver(ss.Delegate.create(this,this.$3D));var $5=$2[$3];if($5!=null){var $6=$5.body;if($6!=null){$4.observe($6,$1);}}this.$33.add($4);}}catch($7){}},$3D:function($p0,$p1){for(var $0=0;$0<$p0.length;++$0){var $1=$p0[$0].addedNodes;for(var $2=0;$2<$1.length;++$2){var $3=$1[$2];if($3.nodeType===1&&$3.tagName.toLowerCase()==='video'){this.$3E($3);}}}},$3E:function($p0){try{$p0.setAttribute('controls','controls');}catch($0){}},$3F:function($p0,$p1,$p2){if(!this.get_isReady()||String.isNullOrEmpty($p0)){return;}this.$2A='';this.set_anchor(this.$2A);if($p0.indexOf('#')!==-1){var $0=$p0.split('#');$p0=$0[0];this.$2A=$0[1]||'';this.set_anchor(this.$2A);if(String.isNullOrEmpty($p0)){$p0=this.get_currentTocEntry().get_xmlId();}}if($p0.indexOf('/')===-1){return;}if(!this.isOnThisXmlid($p0)||$p1!==this.$26){if(!$p2){this.set_view(6);}this.$48($p0,$p1,$p2);}else{this.$51(false);}},$40:function(){var $0=$('#'+this.get_$1C().containerId);if(this.get_$1C().useHtmlIFrame){$0=$0.add(this.$2C.get_documents().find('body'));}return $0;},$41:function(){var $0=this.$2C.get_documents().find('head meta[name="viewport"]').length===this.$2C.get_count();if(!$0){BvD.ClientSideError.send('[HtmlReader] Missing viewport in fixed layout: '+this.get_currentTocEntry().get_xmlId(),null);}return $0;},$42:function(){var $0=[];var $1=this.$2C.get_documents().find('head meta[name="viewport"]');for(var $3=0;$3<$1.length;++$3){var $4=$1.eq($3);var $5=$4.attr('content');var $6=$5.split(',');var $7=0;var $8=0;for(var $9=0;$9<$6.length;++$9){var $A=$6[$9].split('=');var $B=$A[0].trim().toLowerCase();var $C=BvD.MathUtils.parseDouble($A[1].trim(),-1);if($C>-1){if($B==='width'){$7=Math.ceil($C);}else if($B==='height'){$8=Math.ceil($C);}}}$0.add(new BvD.Size($7,$8));}var $2=this.get_tableOfContents().get_pageProgressionDirection()==='rtl';if(this.$34.length>1){var $D=this.$34[0].get_renditionPageSpread();var $E=this.$34[1].get_renditionPageSpread();if(!!$D||!!$E){$2=$D===2||(!$D&&$E===1);}}return new BvD.HtmlViewport($0,true,$2);},$43:function(){var $0=this.$34[0].get_renditionOrientation();if(this.$34.length>1){var $1=this.$34[1].get_renditionOrientation();if($0===3){$0=$1;}else if($1!==3&&$1!==$0){$0=3;}}if($0!==3){var $2=this.$55();if(($0===1&&$2)||($0===2&&!$2)){return 90;}}return 0;},$44:function($p0,$p1,$p2){this.$30=null;$(document).off('resize.bowHtmlReader');if(this.$2E){if(!this.$31){this.$31=true;this.$32.appendTo($(document));if($p1!==4){$(window).on('resize.bowHtmlReader',ss.Delegate.create(this,this.$45));}}this.$2C.get_iFrames().attr('scrolling','no');this.$2C.get_documents().find('html').css('overflow','hidden');this.$46($p0,$p1,$p2);}else{if(this.$31){this.$31=false;this.$32.detach();this.$2C.get_iFrames().css('left','').css('top','').css('width','').css('height','');}this.$2C.get_iFrames().attr('scrolling','auto');this.$2C.get_documents().find('html').css('overflow','');this.$47($p0,$p2);}},$45:function($p0){this.$46(this.$24[1],this.$2F,true);},$46:function($p0,$p1,$p2){if($p0<BvD.BR$14.$1D){$p0=BvD.BR$14.$1D;}if($p0>BvD.BR$14.$1E){$p0=BvD.BR$14.$1E;}var $0=this.$2F;var $1=this.$24[1];var $2=$p0/100;this.$2F=$p1;var $3=0;var $4=0;if(this.$30==null){this.$30=this.$42();}var $5=this.$43();var $6=this.$30.get_totalSize();var $7;var $8;if(!$5){$7=$6.width;$8=$6.height;}else{$7=$6.height;$8=$6.width;}this.$32.get('#HtmlAjax > div > div').set('width',$7+'px').set('height',$8+'px');if(this.$2F!==4){this.$32.get('#HtmlAjax').set('overflow','scroll');var $A=document.getElementById('HtmlAjax');var $B=$A.offsetWidth;var $C=$A.offsetHeight;this.$32.get('#HtmlAjax').set('overflow','auto');var $D=$C/$8;var $E=$B/$7;if(this.$2F===2){$2=$D;$3=$7*$2;$4=$8*$2;if($3>$B){$2=$A.clientHeight/$8;$3=$7*$2;$4=$8*$2;}}else if(this.$2F===1){$2=$E;$3=$7*$2;$4=$8*$2;if($4>$C){$2=$A.clientWidth/$7;$3=$7*$2;$4=$8*$2;}}else if(this.$2F===3){$2=Math.min($E,$D);$3=$7*$2;$4=$8*$2;}}else{$3=$7*$2;$4=$8*$2;}this.$24[1]=$2*100;this.$32.get('#HtmlAjax > div').set('width',$3.toString()+'px').set('height',$4.toString()+'px').set('margin',(this.$34[0].get_renditionPageSpread()===3)?'auto':'');var $9='scale('+$2+')';if(!!$5){$9+=' rotate('+$5.toString()+'deg) translateY(-'+$7.toString()+'px)';}this.$32.get('#HtmlAjax > div > div').set('transform',$9);for(var $F=0;$F<this.$30.get_count();++$F){var $10=this.$30.getSizeAt($F);var $11=this.$30.getPositionAt($F);var $12=this.$2C.get_iFrames().eq($F);$12.css('left',$11.left+'px').css('top',$11.top+'px').css('width',$10.width+'px').css('height',$10.height+'px');if(!$F){$12.css('z-index','1');}}if($p2&&(($0!==this.$2F)||(this.$2F===4&&$1!==this.$24[1]))){this.onZoomChanged(ss.EventArgs.Empty);}},$47:function($p0,$p1){if($p0<BvD.BR$14.$1D){$p0=BvD.BR$14.$1D;}if($p0>BvD.BR$14.$1E){$p0=BvD.BR$14.$1E;}var $0=parseInt(this.$24[0]);this.$24[0]=$p0;var $1=this.$40();if(this.$2D===-1){this.$2D=BvD.MathUtils.parseDouble($1.css('font-size'),-2);}if(this.$2D<0){$1.css('font-size',$p0+'%');}else{if($p0===100){$1.css('font-size','');}else{var $2=(this.$2D*$p0)/100;$1.css('font-size',$2+'px');}}if($p1&&$0!==this.$24[0]){this.onZoomChanged(ss.EventArgs.Empty);}},$48:function($p0,$p1,$p2){if(this.get_isReady()){if($p0==null){$p0=this.$25;}if($p0.indexOf('/')===-1){return;}if($p1==null){$p1=this.$26;}var $0=this.$49($p0);if(!$0.length){return;}var $1=new BvD.QueryString();$1.set('xmlid',$0[0].get_xmlId());if($0.length>1){$1.set('xmlid2',$0[1].get_xmlId());}else if(BvD.Browser.isChrome&&$0[0].get_renditionLayout()===1){this.$2C.get_iFrames().attr('scrolling','auto');}$1.set('query',this.$27);if(!String.isNullOrEmpty($p1)){$1.set('__indexview',$p1);}if($p2){BvD.Ajax.prefetchLink($1,this.get_$1C().ajaxComponent);}else{this.onPageLoading(ss.EventArgs.Empty);BvD.Ajax.link($1,this.get_$1C().ajaxComponent);}}},$49:function($p0){var $0=this.get_tableOfContents().getByXmlId($p0);if($0==null){return new Array(0);}$0=this.$4A($0);var $1=$0.get_renditionSpread();var $2=$1===1;if(!$2&&$1===2&&this.$55()){$2=true;}if(!$2&&$1===3&&!this.$55()){$2=true;}if($2){return [$0];}var $3=null;if($0.get_spineIndex()%2===1){$3=this.get_contentsNavigator().following($0);if($3.get_renditionSpread()!==$0.get_renditionSpread()){$3=null;}}else{$3=this.get_contentsNavigator().preceding($0);if($3!=null){if($3.get_renditionSpread()!==$0.get_renditionSpread()){$3=null;}else{var $4=$0;$0=$3;$3=$4;}}}if($3==null){return [$0];}else{return [$0,$3];}},$4A:function($p0){if($p0==null||!$p0.get_isBvdPage()){return $p0;}if($p0.get_parent()!=null&&!$p0.get_parent().get_isRoot()){return $p0.get_parent();}return this.get_contentsNavigator().following($p0);},$4B:function($p0){try{var $0=$($p0.currentTarget);var $1=$0.attr('href');var $2=$0.attr('data-cfi-spatial-offset')||'';var $3=$0.attr('data-cfi-temporal-offset')||'';if($1.startsWith('#')){$p0.preventDefault();this.$52($1.substr(1),$2,$3);return;}if($1.indexOf('@')>-1){return;}if($1.startsWith('javascript:expandCodeSegments')){this.onLinkClicked(new BvD.LinkEventArgs($p0,$1));return;}if($1.startsWith('javascript:')){return;}var $4=BvD.BookSection.getBookId(this.get_currentTocEntry().get_xmlId()).toLowerCase();var $5=$1.toLowerCase();if($5.startsWith('/'+$4+'/')||$5.startsWith('/'+$4.replaceAll('-','')+'/')){$p0.preventDefault();this.$35=$2;this.$36=$3;var $6=new BvD.Uri($1,false);var $7=decodeURIComponent($6.anchor);if($7.length>0){$7='#'+$7;}var $8=BvD.QueryString.parse($6.query);if(!String.isNullOrEmpty($8.get('indexview'))){this.$4C($6.path.substr(1),$8.get('indexview'));}else{this.goTo($6.path.substr(1)+$7);}return;}this.onLinkClicked(new BvD.LinkEventArgs($p0,$1));}catch($9){BvD.ClientSideError.send('[HtmlReader] LinkIsClicked',$9);}},$4C:function($p0,$p1){this.$48($p0,$p1,false);},$4D:function(){if(this.get_isReady()){return;}this.$51(true);this.set_isReady(true);this.$2A=BvD.Uri.get_current().anchor;this.$2E=!this.$21&&this.get_currentTocEntry().get_renditionLayout()===2&&this.$41();this.$22.layoutStyle=(this.$2E)?'pre-paginated':'reflowable';this.$44(this.$24[(this.$2E)?1:0],this.$2F,false);var $0=false;var $1=this.get_currentQuery();if(BvD.Is.NullOrUndefined($1)){$1='';}$1=$1.trim();if(this.$27!=null&&this.$27!==$1){$0=true;}else{this.$27=$1;}this.$4F();this.onReaderReady(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);var $2=this.$49(this.get_currentTocEntry().get_xmlId());if($2.length>1&&this.$2C.get_count()===1){$0=true;}if($0){this.reload();}},$4E:function($p0,$p1){this.$2D=-1;var $0=$('#Reader_CurrentXmlId');var $1=$('#Reader_IndexPage');if(!$0.length){return;}this.$25=$0.val();this.$26=($1.length>0)?$1.val():'';this.$34=this.$49(this.$25);for(var $2=0;$2<this.$34.length;++$2){this.$2C.get_iFrames().eq($2).data('bowTocEntry',this.$34[$2]);}this.$3C();if(this.get_isReady()){this.$2E=!this.$21&&this.get_currentTocEntry().get_renditionLayout()===2&&this.$41();this.$22.layoutStyle=(this.$2E)?'pre-paginated':'reflowable';if(this.get_$1C().useHtmlIFrame){this.showSearchTerms(this.$2B);}$(document).scrollTop(0);if(this.get_$1C().useHtmlIFrame){BvD.Timer.setTimeout('readerAnchor',1,ss.Delegate.create(this,function(){
this.$51(false);}));}else{this.$51(false);}if(this.get_$1C().useHtmlIFrame){this.$44(this.$24[(this.$2E)?1:0],this.$2F,false);}this.$4F();this.onPageChanged(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);}else{this.$4D();}},$4F:function(){if(!String.isNullOrEmpty(this.get_iframeCSSPath())){var $0=this.$2C.get_documents().find('head');if($0.length>0){$0.append('<link type="text/css" rel="stylesheet" href="'+this.get_iframeCSSPath()+'"/>');}}},$50:function($p0,$p1){var $0='.bowEpubTrigger';for(var $2=0;$2<this.$23.length;++$2){this.$2C.off(this.$23[$2]+$0);}this.$23.clear();var $1=this.$2C.getElementByTagNameNS('epub','trigger');for(var $3=0;$3<$1.length;++$3){var $4=$1[$3];var $5=$4.getAttribute('ev:observer').toString();var $6=$4.getAttribute('ev:event').toString();var $7=$4.getAttribute('action').toString();var $8=$4.getAttribute('ref').toString();var $9=ss.Delegate.create(this,function($p1_0,$p1_1){
return ss.Delegate.create(this,function($p2_0){
try{var $2_0=this.$2C.get_documents().find('#'+$p1_0);var $2_1=$2_0[0];var $2_2=(typeof($2_1[$p1_1])==='function');if($2_2&&$p1_1!=='play'){$2_1[$p1_1]();}else{switch($p1_1){case 'mute':$2_1.muted=true;break;case 'unmute':$2_1.muted=false;break;case 'play':$2_1.currentTime=0;$2_1.play();break;case 'resume':$2_1.play();break;case 'show':$2_0.css('display','');break;case 'hide':$2_0.hide();break;}}}catch($2_3){}});});this.$2C.on($6+$0,'#'+$5,$9($8,$7));this.$23.add($6);}},$51:function($p0){var $0;if($p0){$0=BvD.Uri.get_current().anchor;}else{$0=this.$2A;}this.$52($0,this.$35,this.$36);this.$2A='';this.$35='';this.$36='';},$52:function($p0,$p1,$p2){if($p0==null){return;}$p0=$.trim($p0);try{if(this.get_$1C().useHtmlIFrame){var $0=this.$2C.get_documents();var $1=null;var $2=0;var $3=0;if($p0.length>0){$1=$0.find('#'+$p0);if(!$1.length){$1=$(($0[0]).getElementById($p0));}if(!$1.length){$1=$0.find('a[name="'+$p0+'"]');}if(!$1.length){return;}$2=$1.offset().top;this.get_mediaOverlay().goTo($p0);if($p1.length>0){var $4=$1[0].tagName.toLowerCase();if($4==='img'||$4==='video'){var $5=$p1.split(':');var $6=BvD.MathUtils.parseInt32($5[0],0);var $7=BvD.MathUtils.parseInt32($5[1],1);var $8=$1.width();var $9=$1.height();$3+=($8*$6/100);$2+=($9*$7/100);}}if($p2.length>0){var $A=$1[0].tagName.toLowerCase();if($A==='video'||$A==='audio'){try{var $B=$1[0];$B.play();$B.currentTime=BvD.MathUtils.parseInt32($p2,0);}catch($C){BvD.ClientSideError.send('[HtmlReader] Temporal Offset: '+$p2,$C);}}}}this.$2C.get_windows().scrollTop($2);this.$2C.get_windows().scrollLeft($3);}else if($p0.length>0){var $D;$D=$('#'+this.get_$1C().viewerId).find('#'+$p0);if(!$D.length){$D=$(document.getElementById($p0));}if(!$D.length){$D=$('#'+this.get_$1C().viewerId).find('a[name="'+$p0+'"]');}if(!$D.length){return;}$(window).scrollTop($D.offset().top);}}catch($E){BvD.ClientSideError.send('[HtmlReader] MoveToAnchor - '+$p0,$E);}},$53:function(){var $0=$('#Reader_PreviousIndex');return ($0.length>0)?$0.val():'';},$54:function(){var $0=$('#Reader_NextIndex');return ($0.length>0)?$0.val():'';},$55:function(){return window.innerHeight>window.innerWidth;},$56:function($p0){var $0=this.$34[0].get_renditionSpread();if($0===2||$0===3){this.reload();}}}
BvD.BR$17=function(reader,htmlHighlighter,text){BvD.BR$17.initializeBase(this);if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}if(htmlHighlighter==null){throw new Error(String.format(BvD.Errors.code16_1,'htmlHighlighter'));}this.$2=reader;this.$3=htmlHighlighter;this.$4=text;BvD.BR$17.callBaseMethod(this, 'set_className',[this.$3.get_highlightClass()]);}
BvD.BR$17.prototype={$2:null,$3:null,$4:null,get_className:function(){return BvD.BR$17.callBaseMethod(this, 'get_className');},set_className:function($p0){var $0=BvD.BR$17.callBaseMethod(this, 'get_className');var $1=$p0;if($1==null){$1='';}$1=$1.trim();if($1===$0){return;}BvD.BR$17.callBaseMethod(this, 'set_className',[$1]);var $2=this.$5();if($2!=null&&$2.length>0){$2.removeClass($0).addClass($1);}return $p0;},get_firstPosition:function(){var $0=this.$5().first();var $1=(this.$2.get_$1C().useHtmlIFrame)?BvD.Position.empty.tojQueryPosition():$('#'+this.$2.get_$1C().viewerId).offset();var $2=$0.offset();return new BvD.Position($2.left-$1.left,$2.top-$1.top);},get_lastPosition:function(){var $0=this.$5().last();var $1=(this.$2.get_$1C().useHtmlIFrame)?BvD.Position.empty.tojQueryPosition():$('#'+this.$2.get_$1C().viewerId).offset();var $2=$0.offset();var $3=$0.width();var $4=$0.height();return new BvD.Position(($2.left+$3)-$1.left,($2.top+$4)-$1.top);},get_boundingBox:function(){var $0=(this.$2.get_$1C().useHtmlIFrame)?BvD.Position.empty.tojQueryPosition():$('#'+this.$2.get_$1C().viewerId).offset();var $1=BvD.Rectangle.getBoundingBox(this.$5());return new BvD.Rectangle($1.top-$0.top,$1.left-$0.left,$1.width,$1.height);},get_text:function(){return this.$4;},$5:function(){return (this.get_linkedNote()!=null)?this.$3.getById(this.get_linkedNote().id):null;}}
BvD.BR$15=function(reader){this.$9=[];BvD.BR$15.initializeBase(this);if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}this.$A=reader;this.$B=[];if(this.$A.get_$1C().useHtmlIFrame){this.$E=BvD.IFrameProxy.of('#'+this.$A.get_$1C().viewerId);this.$E.on('selectionchange.bowHtmlSelectionManager',null,ss.Delegate.create(this,this.$13)).on('pointerdown.bowHtmlSelectionManager',null,ss.Delegate.create(this,this.$14)).on('click.bowHtmlSelectionManager','.bow_html_highlight',ss.Delegate.create(this,this.$17));}else{$(document).on2('selectionchange.bowHtmlSelectionManager',ss.Delegate.create(this,this.$13)).on2('pointerdown.bowHtmlSelectionManager','#'+this.$A.get_$1C().viewerId,ss.Delegate.create(this,this.$14)).on('click.bowHtmlSelectionManager','.bow_html_highlight',ss.Delegate.create(this,this.$17));}if(!('onselectionchange' in window.document)&&BvD.Pointer.get_isTouchEnabled()){this.$18();}this.$A.add_pageLoaded(ss.Delegate.create(this,this.$10));this.$A.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$11));}
BvD.BR$15.prototype={$A:null,$B:null,$C:null,$D:true,$E:null,get_list:function(){return this.$9;},$F:function(){if(this.$A.get_$1C().useHtmlIFrame){return this.$E.get_documents().find('body');}else{return $('#'+this.$A.get_$1C().viewerId);}},$10:function($p0,$p1){this.onSelectionCleared(ss.EventArgs.Empty);this.$B.clear();var $0=this.$F();for(var $1=0;$1<$0.length;++$1){this.$B.add(new BvD.HtmlHighlighter($0[$1],'bow_html_highlight','data-html-highlight-note-id'));}this.$12();},$11:function($p0,$p1){for(var $0=0;$0<this.$B.length;++$0){this.$B[$0].removeAll();this.$12();BvD.HtmlSelectedText.clearSelection(this.$F()[$0].ownerDocument);}},$12:function(){this.$9.clear();if(this.$B==null){return;}var $0=this.$A.get_displayedTocEntries();for(var $1=0;$1<$0.length;++$1){var $2=this.$A.get_notes().getNotesOnXmlId($0[$1].get_xmlId());var $3=this.$B[$1];for(var $4=0;$4<$2.length;++$4){var $5=$2[$4];if($5.type===BvD.NoteType.html){$3.add($5.offsets,$5.id,$5.color);var $6=new BvD.BR$17(this.$A,$3,$5.selection);$6.set_linkedNote($5);this.$9.add($6);}}}},$13:function($p0){if(this.$D){var $0=this.$F();for(var $1=0;$1<$0.length;++$1){if($0.eq($1).closest($p0.currentTarget).length>0){var $2=BvD.HtmlSelectedText.get($0[$1],false);if(BvD.HtmlSelectedText.areEquals($2,this.$C)){return;}this.$C=$2;if(this.$C!=null){this.$16(this.$C,$p0,$1);}else{this.onSelectionCleared(ss.EventArgs.Empty);}break;}}}},$14:function($p0){if(($p0).pointerType!=='mouse'){return;}if(this.$A.get_$1C().useHtmlIFrame){this.$E.on('mouseup.bowHtmlSelectionManager',null,ss.Delegate.create(this,this.$15));BvD.HtmlSelectedText.clearIframesSelection(this.$E);}else{$(document).on('mouseup.bowHtmlSelectionManager',ss.Delegate.create(this,this.$15));BvD.HtmlSelectedText.clearSelection(window.document);}this.$C=null;this.onSelectionCleared(ss.EventArgs.Empty);this.onSelectionStarted(ss.EventArgs.Empty);this.$D=false;},$15:function($p0){if(this.$A.get_$1C().useHtmlIFrame){this.$E.off('mouseup.bowHtmlSelectionManager');}else{$(document).off('mouseup.bowHtmlSelectionManager');}var $0=this.$F();for(var $1=0;$1<$0.length;++$1){if($0.eq($1).closest($p0.currentTarget).length>0){this.$C=BvD.HtmlSelectedText.get($0[$1],false);this.$16(this.$C,$p0,$1);this.$D=true;break;}}},$16:function($p0,$p1,$p2){if($p0!=null){try{var $0=$p0.absolutePositionEnd;if($p1!=null&&(BvD.Browser.isIE7||BvD.Browser.isIE8)){$0=BvD.Mouse.jQueryGetPosition($p1,BvD.PointerPositionType.page);}var $1=this.$A.get_displayedTocEntries()[$p2];this.onSelectionEnded(new BvD.SelectionEventArgs($1.get_xmlId(),BvD.NoteType.html,$p0.text,new BvD.Offsets($p0.offsetStart,$p0.offsetEnd),$p0.absolutePositionStart,$0,$p0.relativePositionStart,$p0.relativePositionEnd));}catch($2){BvD.ClientSideError.send('[HtmlSelectionManager] OnSelectionEnded',$2);}}},$17:function($p0){var $0=$($p0.currentTarget);var $1=$0.attr('data-html-highlight-note-id');for(var $2=0;$2<this.$9.length;++$2){var $3=this.$9[$2];var $4=$3.get_linkedNote();if($4!=null&&$4.id===BvD.MathUtils.parseInt32($1,-1)){this.onSelectionActivated(new BvD.Selection2EventArgs($3));}}},$18:function(){BvD.Timer.setInterval('bowHtmlSelectionManagerSelectionChange',100,ss.Delegate.create(this,function(){
this.$13(null);}));}}
BvD.HtmlContentsNavigator=function(toc){BvD.HtmlContentsNavigator.initializeBase(this);this.$0=toc;}
BvD.HtmlContentsNavigator.prototype={$0:null,get_first:function(){return (this.$0.get_hasSpines())?this.$0.get_spines()[0]:this.$0.get_root().get_children()[0];},preceding:function(tocEntry){if(tocEntry==null||tocEntry.get_isRoot()||tocEntry.get_isHidden()){return null;}do{tocEntry=(this.$0.get_hasSpines())?tocEntry.get_previousSpine():tocEntry.get_previous();}while(tocEntry!=null&&(tocEntry.get_isBvdPage()||tocEntry.get_isHidden()||tocEntry.get_unavailable()));return tocEntry;},following:function(tocEntry){if(tocEntry==null||tocEntry.get_isRoot()||tocEntry.get_isHidden()){return null;}do{tocEntry=(this.$0.get_hasSpines())?tocEntry.get_nextSpine():tocEntry.get_next();}while(tocEntry!=null&&(tocEntry.get_isBvdPage()||tocEntry.get_isHidden()||tocEntry.get_unavailable()));return tocEntry;}}
BvD.BR$11=function(reader){this.$0=reader;}
BvD.BR$11.prototype={$0:null,$1:null,$2:null,$3:0,$4:function(){$('#htmlthumbnail').show();this.$7();this.$6();this.$8(null);if(this.$3<this.$1.length){$(window).on('scroll.bowHtmlThumbnails',ss.Delegate.create(this,this.$8));}},$5:function(){$('#htmlthumbnail').hide();$(window).off('scroll.bowHtmlThumbnails');},$6:function(){if(this.$2!=null){$(window).scrollTop(this.$2.offset().top);}},$7:function(){if(this.$2!=null){this.$2.removeClass('selected');this.$2=null;}var $0=new RegExp('-','g');var $1=this.$0.get_currentTocEntry().get_xmlId();$1=$1.replace($0,'');var $2=$(document.getElementById('thumbnail-'+$1));if($2.length>0){this.$2=$2;$2.addClass('selected');}},$8:function($p0){if(this.$1==null){this.$1=$('#htmlthumbnail').find('.thumbnail');}if(this.$3===this.$1.length){$(window).off('scroll.bowHtmlThumbnails');return;}var $0=$(window).scrollTop();var $1=$0+$(window).height();for(var $2=0;$2<this.$1.length;++$2){var $3=this.$1.eq($2);if(!!$3.data('imageLoaded')){continue;}var $4=$3.offset().top;var $5=$4+205;if($4>$1||$5<$0){continue;}$3.data('imageLoaded',true);this.$3+=1;var $6=$3.prop('id').substr(10);var $7=$('<a href="/'+$6+'"></a>').on('click',ss.Delegate.create(this,this.$9));var $8=$('<img src="/gethtmlthumbnails/'+$6+'.png"/>').addClass('htmlthumbnail-image');$8.appendTo($7);$7.appendTo($3);}},$9:function($p0){$p0.preventDefault();var $0=$p0.currentTarget;var $1=new BvD.Uri($0.href,false).path.substr(1);this.$0.goTo($1);}}
BvD.HtmlViewport=function(sizes,isHorizontal,isRightToLeft){this.$0=[];this.$1=[];this.$0=sizes;var $0=0;var $1=0;if(isRightToLeft){for(var $2=this.$0.length-1;$2>=0;--$2){if(isHorizontal){this.$1.add(new BvD.Position($0,0));$0+=this.$0[$2].width;$1=Math.max($1,this.$0[$2].height);}else{this.$1.add(new BvD.Position(0,$1));$0=Math.max($0,this.$0[$2].width);$1+=this.$0[$2].height;}}this.$1.reverse();}else{for(var $3=0;$3<this.$0.length;++$3){if(isHorizontal){this.$1.add(new BvD.Position($0,0));$0+=this.$0[$3].width;$1=Math.max($1,this.$0[$3].height);}else{this.$1.add(new BvD.Position(0,$1));$0=Math.max($0,this.$0[$3].width);$1+=this.$0[$3].height;}}}this.$2=new BvD.Size($0,$1);}
BvD.HtmlViewport.prototype={$2:null,get_count:function(){return this.$0.length;},get_totalSize:function(){return this.$2;},getSizeAt:function(i){return this.$0[i];},getPositionAt:function(i){return this.$1[i];}}
BvD.BR$10=function(containerDivId,mouseDivId){this.$0=containerDivId;this.$1=mouseDivId;}
BvD.BR$10.prototype={$0:null,$1:null,$2:false,$3:false,$4:0,$5:0,$6:null,$7:null,$8:null,add_$9:function($p0){this.$A=ss.Delegate.combine(this.$A,$p0);},remove_$9:function($p0){this.$A=ss.Delegate.remove(this.$A,$p0);},$A:null,add_$B:function($p0){this.$C=ss.Delegate.combine(this.$C,$p0);},remove_$B:function($p0){this.$C=ss.Delegate.remove(this.$C,$p0);},$C:null,get_$D:function(){return this.$2;},set_$D:function($p0){if(this.$2!==$p0){this.$2=$p0;if(this.$2){this.$E();}else{this.$F();}}return $p0;},$E:function(){this.$8=$('#'+this.$1).on('mousedown.bowImagesGrab',ss.Delegate.create(this,this.$10));this.$7=$('#'+this.$0);},$F:function(){this.$8.off('mousedown.bowImagesGrab');this.$8=null;this.$7=null;},$10:function($p0){if(this.$3){return;}this.$3=true;$(document).on('mousemove.bowImagesGrab',ss.Delegate.create(this,this.$11)).on('mouseup.bowImagesGrab',ss.Delegate.create(this,this.$12));this.$6=BvD.Mouse.jQueryGetPosition($p0,BvD.PointerPositionType.page);this.$4=this.$7.scrollLeft();this.$5=this.$7.scrollTop();if(this.$A!=null){try{this.$A(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[ImagesGrab] OnMouseDown',$0);}}},$11:function($p0){if(!this.$3){return;}var $0=BvD.Mouse.jQueryGetPosition($p0,BvD.PointerPositionType.page);var $1=this.$4+this.$6.left-$0.left;var $2=this.$5+this.$6.top-$0.top;this.$7.scrollLeft($1).scrollTop($2);},$12:function($p0){if(!this.$3){return;}this.$3=false;$(document).off('mousemove.bowImagesGrab mouseup.bowImagesGrab');this.$6=null;if(this.$C!=null){try{this.$C(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[ImagesGrab] OnMouseUp',$0);}}}}
BvD.BR$12=function(rectangle,url){this.$0=rectangle;this.$1=url;}
BvD.BR$12.prototype={$0:null,$1:null}
BvD.BR$D=function(str){if(String.isNullOrEmpty(str)){return;}var $0=$.parseJSON(str);this.$0=[];for(var $1=0;$1<$0.length;$1+=5){var $2=$0[$1+0];var $3=$0[$1+1];var $4=$0[$1+2];var $5=$0[$1+3];var $6=$0[$1+4];try{if(!BvD.Is.Int32($2)||!BvD.Is.Int32($3)||!BvD.Is.Int32($4)||!BvD.Is.Int32($5)){throw new Error(String.format(BvD.Errors.code16_2,str));}if(!BvD.Is.String($6)){throw new Error(String.format(BvD.Errors.code16_3,str));}}catch($7){BvD.ClientSideError.send('[ImagesItems]',$7);}this.$0.add(new BvD.BR$12(new BvD.Rectangle($3,$2,$4,$5),$6));}}
BvD.BR$D.prototype={$0:null,get_$1:function(){return (this.$0==null)?0:this.$0.length;},get_item:function($p0){if(this.$0==null||$p0<0||$p0>=this.$0.length){throw new Error(String.format(BvD.Errors.code16_4,$p0));}return this.$0[$p0];}}
BvD.BR$9=function(objectType,rectangle,url){this.$0=objectType;this.$1=rectangle;this.$2=url;}
BvD.BR$9.prototype={$0:0,$1:null,$2:null}
BvD.BR$8=function(str){if(String.isNullOrEmpty(str)){return;}this.$0=[];var $0=$.parseJSON(str);for(var $1=0;$1<$0.length;$1+=6){var $2=$0[$1+0];var $3=$0[$1+1];var $4=$0[$1+2];var $5=$0[$1+3];var $6=$0[$1+4];var $7=$0[$1+5];var $8;switch($2){case 0:$8=0;break;case 1:$8=1;break;default:$8=1;BvD.ClientSideError.send('[ImagesObject] Unknown type',null);break;}this.$0.add(new BvD.BR$9($8,new BvD.Rectangle($5,$4,$6,$7),$3));}}
BvD.BR$8.prototype={$0:null,get_$1:function(){return (this.$0==null)?0:this.$0.length;},get_item:function($p0){if(this.$0==null||$p0<0||$p0>=this.$0.length){throw new Error(String.format(BvD.Errors.code16_4,$p0));}return this.$0[$p0];}}
BvD.BR$7=function(str){if(String.isNullOrEmpty(str)){return;}var $0=$.parseJSON(str);try{if(!BvD.Is.Int32($0[1])||!BvD.Is.Int32($0[2])||!BvD.Is.Int32($0[3])||!BvD.Is.Int32($0[4])||!BvD.Is.Int32($0[5])||!BvD.Is.Int32($0[6])||!BvD.Is.Int32($0[7])){throw new Error(String.format(BvD.Errors.code16_2,str));}}catch($1){BvD.ClientSideError.send('[ImagesPageInfo]',$1);}this.$0=$0[0]===1;this.$1=new BvD.Size($0[1],$0[2]);this.$2=new BvD.Position($0[3],$0[4]);this.$3=new BvD.Size($0[5],$0[6]);this.$4=$0[7];}
BvD.BR$7.prototype={$0:false,$1:null,$2:null,$3:null,$4:0}
BvD.BR$1A=function(config,tableOfContents,jsonId,pageContentDivId,pageDivId,pfContentDivId){BvD.BR$1A.initializeBase(this,[config,tableOfContents]);if(String.isNullOrEmpty(jsonId)){jsonId='bow_pf_json';}if(String.isNullOrEmpty(pfContentDivId)){pfContentDivId='pfcontent';}if(!$('#'+pfContentDivId).length){$('<div id="'+pfContentDivId+'"></div>').appendTo('#'+this.get_$1C().viewerId);}this.$27=6;this.$26=new BvD.BR$10(config.containerId,'mousediv');this.$26.add_$9(ss.Delegate.create(this,this.$51));this.$26.add_$B(ss.Delegate.create(this,this.$52));this.set_contentsNavigator(new BvD.ImagesContentsNavigator(this.get_tableOfContents()));$(document).on('click','#'+this.get_$1C().viewerId+' a',ss.Delegate.create(this,this.$4F));BvD.AjaxEngine.onPanelReady(this.get_$1C().ajaxComponent,ss.Delegate.create(this,this.$4A));this.$1F=(config.zoomConfig==null)?BvD.ReaderZoomConfig.$0:config.zoomConfig;this.$23=config.xmlId.xmlId;this.$21=config.zoom;this.$22=this.$4D(this.$21);this.$35=jsonId;this.$3F=1;var $0='none';var $1={};$1['-webkit-user-select']=$0;$1['-webkit-touch-callout']=$0;$1['-ms-touch-action']=$0;$1['-ms-touch-select']=$0;this.$28=$('#'+pageContentDivId).css($1);this.$29=$('#'+pageDivId);this.$2A=$('#'+pfContentDivId).css('-ms-touch-select',$0).css('-ms-touch-action',$0).css('overflow','visible').css('position','relative').css('min-width','0').addClass('pfv2_pfcontent').on('click touchstart contextmenu mousedown touchmove touchcancel','img',ss.Delegate.create(this,this.$54));this.$2B=this.$47().appendTo(this.$2A);this.$2C=this.$48().appendTo(this.$2A);this.$2D=null;if(this.get_$1C().pfReaderUseMouseDiv){this.$2D=this.$49().appendTo(this.$2A);this.$25=new BvD.BR$19(this,'mousediv','selectiondiv');}else{this.$25=new BvD.BR$19(this,'selectiondiv','selectiondiv');}this.$3D=new BvD.BR$C(this,this.$2B);}
BvD.BR$1A.prototype={$1F:null,$20:null,$21:0,$22:0,$23:null,$24:null,$25:null,$26:null,$27:0,$28:null,$29:null,$2A:null,$2B:null,$2C:null,$2D:null,$2E:null,$2F:null,$30:null,$31:null,$32:null,$33:null,$34:null,$35:null,$36:null,$37:null,$38:null,$39:null,$3A:null,$3B:null,$3C:null,$3D:null,$3E:null,$3F:0,$40:null,$41:null,get_mode:function(){return 2;},prefetchPrevious:function(){if(this.get_isReady()){var $0=this.get_contentsNavigator().preceding(this.get_currentTocEntry());if($0!=null){this.prefetchGoTo($0.get_xmlId());}}},previous:function(){if(this.get_isReady()){var $0=this.get_contentsNavigator().preceding(this.get_currentTocEntry());if($0!=null){this.goTo($0.get_xmlId());}}},prefetchNext:function(){if(this.get_isReady()){var $0=this.get_contentsNavigator().following(this.get_currentTocEntry());if($0!=null){this.prefetchGoTo($0.get_xmlId());}}},next:function(){if(this.get_isReady()){var $0=this.get_contentsNavigator().following(this.get_currentTocEntry());if($0!=null){this.goTo($0.get_xmlId());}}},prefetchGoTo:function($p0){if(!this.get_isReady()||$p0==null||$p0.indexOf('/')===-1){return;}if(!this.isOnThisXmlid($p0)){this.$4E($p0,true);}},goTo:function($p0){if(!this.get_isReady()||$p0==null||$p0.indexOf('/')===-1){return;}if(!this.isOnThisXmlid($p0)){this.set_view(6);this.$4E($p0,false);}},get_currentTocEntry:function(){return (this.get_isReady())?this.get_tableOfContents().getByXmlId(this.$23):null;},isOnThisXmlid:function($p0){return this.get_isReady()&&this.get_tableOfContents().isSamePage(this.$23,$p0);},get_isFirstPage:function(){return this.get_isReady()&&this.get_contentsNavigator().preceding(this.get_currentTocEntry())==null;},get_isLastPage:function(){return this.get_isReady()&&this.get_contentsNavigator().following(this.get_currentTocEntry())==null;},zoomIn:function(){if(this.get_isReady()){this.$4C(this.$21+this.$1F.zoomStep,true);}},zoomOut:function(){if(this.get_isReady()){this.$4C(this.$21-this.$1F.zoomStep,true);}},zoomPageWidth:function(){if(this.get_isReady()){this.$4C($('#'+this.get_$1C().viewerId).width()-4,true);}},get_zoomLevel:function(){return this.$21;},set_zoomLevel:function($p0){if(this.get_isReady()){this.$4C(Math.floor($p0),true);}return $p0;},get_zoomFit:function(){return 4;},get_isFixedLayout:function(){return true;},get_isFirstZoomLevel:function(){return this.get_isReady()&&this.$21<=this.$1F.minZoomLevel;},get_isLastZoomLevel:function(){return this.get_isReady()&&this.$21>=this.$1F.maxZoomLevel;},get_grab:function(){return this.$26.get_$D();},set_grab:function($p0){if(!this.get_isReady()||$p0!==this.$25.get_$6()){return;}this.$25.set_$6(!$p0);this.$26.set_$D($p0);this.onGrabChanged(ss.EventArgs.Empty);return $p0;},get_view:function(){return this.$27;},set_view:function($p0){if(this.$27===$p0||($p0!==6&&$p0!==2)){return;}var $0=this.$27;if($p0===2){this.get_thumbnails().$9();this.get_thumbnails().$E(this.get_currentTocEntry().get_xmlId());}this.$27=$p0;this.onViewChanged(new BvD.ReaderViewEventArgs($0,this.$27));return $p0;},reload:function(){this.$4E(null,false);},print:function(){if(this.get_isReady()){if(this.$20!=null){try{this.$20.close();this.$20=null;}catch($3){}}var $0=new BvD.QueryString().set('__displaygrbooks','1').set('xmlid',this.$23);var $1='/print?'+$0.toString();var $2='directories=no,menubar=no,status=no,location=no,scrollbars=yes,resizable=yes';this.$20=window.open($1,'Print',$2);}},print2:function($p0,$p1){if(this.get_isReady()){if(this.$20!=null){try{this.$20.close();this.$20=null;}catch($3){}}var $0=new BvD.QueryString().set('__displaygrbooks','1').set('xmlid',$p0).set('__pagestoprint',$p1.toString());var $1='/print?'+$0.toString();var $2='directories=no,menubar=no,status=no,location=no,scrollbars=yes,resizable=yes';this.$20=window.open($1,'Print',$2);}},setFocus:function($p0){if(this.get_view()!==2){var $0=$('#'+this.get_$1C().containerId);if($p0===2){$0.scrollTop(0);}else if($p0===3){var $1=$0.height();$0.scrollTop($1);}}else{switch($p0){case 9:this.get_thumbnails().$B();break;case 10:this.get_thumbnails().$C();break;case 5:this.get_thumbnails().$D(3);break;case 4:this.get_thumbnails().$D(1);break;case 6:this.get_thumbnails().$D(0);break;case 7:this.get_thumbnails().$D(2);break;case 8:this.get_thumbnails().$A();break;}}},setQuery:function($p0){if($p0==null){$p0='';}$p0=$p0.trim();if($p0===this.$24){return;}BvD.Cookies.setStateValueParameter('query',$p0);this.$24=$p0;this.reload();},showSearchTerms:function($p0){var $0=$('#'+this.get_$1C().containerId);if($p0){$0.addClass('showhighlights');}else{$0.removeClass('showhighlights');}},get_currentQuery:function(){return (this.get_isReady())?this.get_$4B():'';},get_selections:function(){return this.$25;},forceReload:function($p0){if($p0==null){$p0=this.get_$1C().xmlId.toString();}var $0=this.get_tableOfContents().getByXmlId($p0);if(!$0.get_isBvdPage()){$0=$0.getFirstDescendantOrFollowingBvdPage();if($0!=null){$p0=$0.get_xmlId();}}this.$23=$p0;var $1=new BvD.QueryString().set('xmlid',$p0).set('__imagepageresolution',this.$22.toString()).set('query',this.$24);BvD.Ajax.link($1,this.get_$1C().ajaxComponent);},get_$42:function(){return this.$3B;},get_$43:function(){return this.$3F;},get_$44:function(){return this.$3C;},get_$45:function(){return this.$37==null||this.$37.$0;},get_$46:function(){return this.$22.toString();},$47:function(){var $0={};$0['left']='0';$0['top']='0';$0['position']='absolute';$0['z-index']='1005';return this.$57($('<div></div>')).attr('id','highlightcontent').css($0).addClass('pfv2_highlightcontent');},$48:function(){var $0={};$0['left']='0';$0['top']='0';$0['position']='absolute';$0['z-index']='1010';return this.$57($('<div></div>')).attr('id','selectiondiv').css($0);},$49:function(){var $0={};$0['left']='0';$0['top']='0';$0['position']='absolute';$0['z-index']='1020';$0['opacity']='0';$0['background-color']='white';return this.$57($('<div></div>')).attr('id','mousediv').css($0);},$4A:function($p0,$p1){this.$56();this.$55();if(!String.isNullOrEmpty(this.$3E)){this.$23=this.$3E;}if(!this.get_isReady()){this.$50();return;}if(this.get_$1C().autoScrollTop){this.$2A[0].scrollIntoView(true);}this.onPageChanged(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);},get_$4B:function(){return $('#Reader_Query').val();},$4C:function($p0,$p1){$p0=parseInt(BvD.MathUtils.normalizeRange($p0,this.$1F.minZoomLevel,this.$1F.maxZoomLevel));if(this.$21!==$p0){this.$21=$p0;this.$55();this.$58();this.$59();this.$5B();this.onZoomChanged(ss.EventArgs.Empty);var $0=this.$4D(this.$21);if($0>this.$22){this.$22=$0;this.reload();}this.$22=$0;}},$4D:function($p0){$p0=parseInt(BvD.MathUtils.normalizeRange($p0,this.$1F.minZoomLevel,this.$1F.maxZoomLevel));if(this.$1F.imagesResolutions.contains($p0)){return $p0;}var $0=this.$1F.imagesResolutions.length;for(var $1=0;$1<$0;++$1){var $2=($1>0)?this.$1F.imagesResolutions[$1-1]:-90000;var $3=this.$1F.imagesResolutions[$1];var $4=$3-($3-$2)/2;if($p0<$3&&$p0<$4){if($1>0){return this.$1F.imagesResolutions[$1-1];}else{return this.$1F.imagesResolutions[$1];}}}return this.$1F.imagesResolutions[$0-1];},$4E:function($p0,$p1){if(this.get_isReady()){if($p0==null){$p0=this.$23;}if($p0.indexOf('/')===-1){return;}var $0=this.get_tableOfContents().getByXmlId($p0);if(!$0.get_isBvdPage()){$0=$0.getFirstDescendantOrFollowingBvdPage();if($0!=null){$p0=$0.get_xmlId();}}var $1=new BvD.QueryString().set('xmlid',$p0).set('__imagepageresolution',this.$22.toString()).set('query',this.$24);if($p1){BvD.Ajax.prefetchLink($1,this.get_$1C().ajaxComponent);}else{BvD.Ajax.link($1,this.get_$1C().ajaxComponent);}}},$4F:function($p0){try{var $0=$($p0.currentTarget);var $1=$0.attr('href');if($1.indexOf('@')>-1){return;}var $2=BvD.BookSection.getBookId(this.get_currentTocEntry().get_xmlId());if($1.startsWith('/'+$2+'/')){$p0.preventDefault();this.goTo($1.substr(1));return;}this.onLinkClicked(new BvD.LinkEventArgs($p0,$1));}catch($3){BvD.ClientSideError.send('[HtmlReader] OnLinkClicked',$3);}},$50:function(){if(this.get_isReady()){return;}this.set_isReady(true);var $0=false;var $1=this.get_currentQuery();if(BvD.Is.NullOrUndefined($1)){$1='';}$1=$1.trim();if(this.$24!=null&&this.$24!==$1){$0=true;}else{this.$24=$1;}this.onReaderReady(ss.EventArgs.Empty);this.onPageLoaded(ss.EventArgs.Empty);try{this.showSearchTerms(true);this.$4C(this.$21,false);}catch($2){BvD.ClientSideError.send('[ImagesReader] Initiate()',$2);}if($0){this.reload();}},$51:function($p0,$p1){this.onGrabStarted(ss.EventArgs.Empty);},$52:function($p0,$p1){this.onGrabEnded(ss.EventArgs.Empty);},$53:function($p0){$($p0.currentTarget).css('visibility','visible');},$54:function($p0){$p0.preventDefault();},$55:function(){if(this.$37!=null){this.$3F=this.get_zoomLevel()/this.$37.$1.width;this.$3F=Math.round(this.$3F*100)/100;}},$56:function(){var $0=$('#'+this.$35);if(!$0.length){return;}var $1=BvD.JsonUtils.decompress($0.val());var $2=$1.indexOf('"pos"');var $3=$1.indexOf('[',$2);var $4=$1.indexOf(']',$3);var $5=$1.substr($3,$4-$3+1);var $6=$1.indexOf('"imgs"');var $7=$1.indexOf('[',$6);var $8=$1.indexOf(']',$7);var $9=null;if($6!==-1){$9=$1.substr($7,$8-$7+1);}var $A=$1.indexOf('"objs"');var $B=$1.indexOf('[',$A);var $C=$1.indexOf(']',$B);var $D=null;if($A!==-1){$D=$1.substr($B,$C-$B+1);}var $E=$1.indexOf('"hl"');var $F=$1.indexOf('[',$E);var $10=$1.indexOf(']',$F);var $11=null;if($E!==-1){$11=$1.substr($F,$10-$F+1);}var $12=$1.indexOf('"xids"');var $13=$1.indexOf('[',$12);var $14=$1.indexOf(']',$13);var $15=$1.substr($13,$14-$13+1);var $16=$1.indexOf('"quads"');var $17=$1.indexOf('{',$16);var $18=null;if($17>-1){var $24=$1.indexOf('}',$17);$18=$1.substr($17,$24-$17+1);}var $19=$1.indexOf('"canvasimg"');var $1A=$1.indexOf(':',$19);$1A=$1.indexOf('"',$1A);var $1B=$1.indexOf('"',$1A+1);var $1C=null;if($19>-1){$1C=$1.substr($1A+1,$1B-$1A-1).trim();}var $1D=this.$2E!==$5;var $1E=this.$2F!==$9;var $1F=this.$30!==$D;var $20=this.$31!==$11;var $21=this.$33!==$15;var $22=this.$32!==$18;var $23=this.$34!==$1C;this.$2E=$5;this.$2F=$9;this.$30=$D;this.$31=$11;this.$33=$15;this.$32=$18;this.$34=$1C;if(this.$3A==null&&this.$40==null){if(!String.isNullOrEmpty($1C)){this.$5C();}else{this.$3A=[];}}if($1D){this.$37=new BvD.BR$7($5);this.$3F=this.get_zoomLevel()/this.$37.$1.width;this.$3F=Math.round(this.$3F*100)/100;this.$2C.attr('data-preview',(this.$37.$0)?'1':'0');}if($1E){this.$36=new BvD.BR$D($9);}if($1F){this.$38=new BvD.BR$8($D);}if($20){this.$3C=new BvD.BR$6($11);}if($22){this.$3B=new BvD.BR$B($18);}if($21){var $25=$.parseJSON($15);this.$3E=$25[0];}this.$58();this.$59();if($1F){this.$5A();this.$5B();}},$57:function($p0){var $0='none';$p0.css('outline-style',$0).css('-ms-user-select',$0).css('-ms-touch-select',$0).css('-webkit-user-select',$0).css('-moz-user-select','-moz-'+$0).css('-khtml-user-select',$0).css('user-select',$0).css('-webkit-touch-callout',$0);return $p0;},$58:function(){if(this.$3A!=null){var $0=this.$3A.length;var $1=this.$36.get_$1();var $2;for(var $3=0;$3<$1;++$3){if($3<$0){$2=this.$3A[$3];}else{$2=$('<img/>').on('load',ss.Delegate.create(this,this.$53)).css('z-index','1000').css('position','absolute').css('padding','0').css('margin','0').css('border','none').addClass('pfv2imgs').attr('alt','');this.$57($2);$2.insertBefore(this.$2B);this.$3A.add($2);$0++;}var $4=this.$36.get_item($3);var $5=$4.$1;if($2.attr('src')!==$5){$2.css('visibility','hidden').attr('src',$5);}}if($0>$1){for(var $6=$1;$6<$0;++$6){this.$3A[$6].off('load').remove();}this.$3A.removeRange($1,$0-$1);}}else if(this.$40!=null){var $7=$(this.$40);$7.css('visibility','hidden');$(new Image()).on('load',ss.Delegate.create(this,function($p1_0){
var $1_0=$p1_0.currentTarget;var $1_1=$1_0.width;var $1_2=$1_0.height;this.$40.width=$1_1;this.$40.height=$1_2;this.$41.drawImage($1_0,0,0);var $1_3=this.$41.getImageData(0,0,$1_1,$1_2);BvD.BR$A.$0($1_3.data,$1_1,$1_2);this.$41.putImageData($1_3,0,0);$7.css('visibility','');})).attr('src',this.$34);}},$59:function(){if(this.$37==null){return;}var $0;$0={};$0['width']=(this.$37.$1.width*this.$3F)+'px';$0['height']=(this.$37.$1.height*this.$3F)+'px';this.$28.css($0);$0={};$0['padding-left']=(this.$37.$2.left*this.$3F)+'px';$0['padding-top']=(this.$37.$2.top*this.$3F)+'px';this.$29.css($0);$0={};$0['width']=(this.$37.$3.width*this.$3F)+'px';$0['height']=(this.$37.$3.height*this.$3F)+'px';this.$2C.css($0);this.$2A.css($0);if(this.$2D!=null){this.$2D.css($0);}if(this.$3A!=null){for(var $1=0;$1<this.$36.get_$1();++$1){var $2=this.$36.get_item($1);$0={};$0['left']=($2.$0.left*this.$3F)+'px';$0['top']=($2.$0.top*this.$3F)+'px';$0['width']=($2.$0.width*this.$3F)+'px';$0['height']=($2.$0.height*this.$3F)+'px';this.$3A[$1].css($0);}}else if(this.$40!=null){$(this.$40).css($0);}},$5A:function(){if(this.$39!=null){for(var $0=0;$0<this.$39.length;++$0){this.$39[$0].remove();}this.$39=null;}if(this.$38==null||!this.$38.get_$1()){return;}this.$39=[];for(var $1=0;$1<this.$38.get_$1();++$1){var $2=this.$38.get_item($1);var $3=$2.$2;if(!$2.$0){$3='/'+this.get_tableOfContents().get_root().get_xmlId()+'/'+$3;}var $4={};$4['display']='block';$4['position']='absolute';$4['z-index']='1030';var $5=$('<a></a>').css($4).addClass('bow_object_url').attr('href',$3).attr('title',$3).appendTo(this.$2A);this.$39.add($5);}},$5B:function(){if(this.$39!=null){for(var $0=0;$0<this.$39.length;++$0){var $1=this.$38.get_item($0);var $2=$1.$1;var $3={};$3['left']=($2.left*this.$3F)+'px';$3['top']=($2.top*this.$3F)+'px';$3['width']=($2.width*this.$3F)+'px';$3['height']=($2.height*this.$3F)+'px';this.$39[$0].css($3);}}},$5C:function(){this.$40=document.createElement('canvas');this.$40.setAttribute('id','canvasContent');$(this.$40).insertBefore(this.$2B);this.$41=this.$40.getContext('2d');}}
BvD.BR$6=function(str){if(String.isNullOrEmpty(str)){return;}var $0=$.parseJSON(str);this.$0=[];var $1=$0.length;for(var $2=0;$2<$1;$2+=4){var $3=$0[$2+0];var $4=$0[$2+1];var $5=$0[$2+2];var $6=$0[$2+3];try{if(!BvD.Is.Int32($3)||!BvD.Is.Int32($4)||!BvD.Is.Int32($5)||!BvD.Is.Int32($6)){throw new Error(String.format(BvD.Errors.code16_2,str));}}catch($7){BvD.ClientSideError.send('[ImagesSearchHighlights]',$7);}this.$0.add(new BvD.Rectangle($4,$3,$5,$6));}}
BvD.BR$6.prototype={$0:null,get_$1:function(){return (this.$0==null)?0:this.$0.length;},get_item:function($p0){if(this.$0==null){return null;}if($p0<0||$p0>=this.$0.length){throw new Error(String.format(BvD.Errors.code16_4,$p0));}return this.$0[$p0];}}
BvD.BR$C=function(imagesReader,searchHighlightsDiv){if(imagesReader==null){throw new Error(String.format(BvD.Errors.code16_1,'imagesReader'));}if(searchHighlightsDiv==null){throw new Error(String.format(BvD.Errors.code16_1,'searchHighlightsDiv'));}this.$2=searchHighlightsDiv;this.$0=imagesReader;this.$0.add_pageLoaded(ss.Delegate.create(this,this.$3));this.$0.add_zoomChanged(ss.Delegate.create(this,this.$3));this.$1=[];}
BvD.BR$C.prototype={$0:null,$1:null,$2:null,$3:function($p0,$p1){var $0=this.$0.get_$44();var $1=this.$0.get_$43();var $2=($0==null)?0:$0.get_$1();for(var $4=0;$4<$2;++$4){var $5=false;if(this.$1.length<=$4){this.$1.add($('<div></div>'));$5=true;}var $6=this.$1[$4];var $7=$0.get_item($4);var $8={};$8['left']=($7.left*$1)+'px';$8['top']=($7.top*$1)+'px';$8['width']=($7.width*$1)+'px';$8['height']=($7.height*$1)+'px';$8['position']='absolute';$6.css($8);if($5){$6.appendTo(this.$2);}}var $3=this.$1.length;for(var $9=$2;$9<$3;++$9){this.$1[$9].remove();this.$1.removeAt($9);$9--;$3--;}}}
BvD.BR$18=function(manager,scale,quads,container){BvD.BR$18.initializeBase(this);if(quads==null){throw new Error(String.format(BvD.Errors.code16_1,'quads'));}if(container==null){throw new Error(String.format(BvD.Errors.code16_1,'container'));}this.$9=BvD.BR$18.$5;this.$7=quads;this.$8=container;this.$F=scale;this.$10=manager;this.$11=null;BvD.BR$18.$5++;var $0=this.$7.get_$1();this.$6=new Array($0);for(var $1=0;$1<this.$6.length;++$1){this.$6[$1]=null;}}
BvD.BR$18.prototype={$6:null,$7:null,$8:null,$9:0,$A:0,$B:null,$C:null,$D:null,$E:null,$F:0,$10:null,$11:null,get_className:function(){return BvD.BR$18.callBaseMethod(this, 'get_className');},set_className:function($p0){var $0=$p0;var $1=BvD.BR$18.callBaseMethod(this, 'get_className');if($0==null){$0='';}$0=$0.trim();if($0===$1){return;}BvD.BR$18.callBaseMethod(this, 'set_className',[$0]);if(this.$A>0){var $2=this.$6.length;for(var $3=0;$3<$2;++$3){var $4=this.$6[$3];if($4!=null){$4.removeClass($1).addClass($0);}}}return $p0;},get_firstPosition:function(){if(this.$A>0){var $0=this.$6.length;for(var $1=0;$1<$0;++$1){var $2=this.$6[$1];if($2!=null){var $3=parseInt($2.css('left'),10);var $4=parseInt($2.css('top'),10);return new BvD.Position($3,$4);}}}return null;},get_lastPosition:function(){if(this.$A>0){for(var $0=this.$6.length-1;$0>=0;--$0){var $1=this.$6[$0];if($1!=null){var $2=parseInt($1.css('left'),10);var $3=parseInt($1.css('top'),10);var $4=parseInt($1.css('width'),10);var $5=parseInt($1.css('height'),10);return new BvD.Position($2+$4,$3+$5);}}}return null;},get_boundingBox:function(){if(this.$B==null){this.$1A();}return this.$B;},get_text:function(){if(this.$11==null&&this.get_linkedNote()!=null){this.$11=this.$10.$7(this.get_linkedNote().xmlId,this.get_$14(),this.$10.$31());}return this.$11;},get_$12:function(){return this.$D;},set_$12:function($p0){if($p0==null){throw new Error('[ImagesSelection] StartPosition - Argument Null Exception');}this.$D=$p0;if(this.$E==null){this.$E=$p0;}this.$1C();return $p0;},get_$13:function(){return this.$E;},set_$13:function($p0){if($p0==null){throw new Error('[ImagesSelection] EndPosition - Argument Null Exception');}this.$E=$p0;if(this.$D==null){this.$D=$p0;}this.$1C();return $p0;},get_$14:function(){if(this.$C==null){this.$1A();}return this.$C;},set_$14:function($p0){this.$D=BvD.Position.empty;this.$E=BvD.Position.empty;this.$1C();if($p0!=null){this.$20();for(var $0=$p0.start;$0<=$p0.end;++$0){this.$1E($0,true);this.$D=this.get_$16();this.$E=this.get_$17();}}return $p0;},get_$15:function(){return this.$F;},set_$15:function($p0){if($p0!==this.$F){this.$F=$p0;this.$1B();}return $p0;},get_$16:function(){var $0=this.get_$14();if($0==null){return null;}var $1=this.$7.get_item($0.start);return new BvD.Position($1.left,parseInt((($1.top+$1.bottom)/2)));},get_$17:function(){var $0=this.get_$14();if($0==null){return null;}var $1=this.$7.get_item($0.end);return new BvD.Position($1.right,parseInt((($1.top+$1.bottom)/2)));},$18:function(){if(this.$D!=null){var $0=this.$1D(true,this.$D.left,this.$D.top,this.$D.left,this.$D.top);if($0>-1){this.set_$14(new BvD.Offsets($0,$0));}}},$19:function(){this.$20();this.$6=null;this.$7=null;this.$8=null;this.$B=null;this.$C=null;this.$D=null;this.$E=null;this.set_linkedNote(null);},$1A:function(){var $0=Number.MAX_VALUE;var $1=Number.NEGATIVE_INFINITY;var $2=Number.MAX_VALUE;var $3=Number.MAX_VALUE;var $4=Number.NEGATIVE_INFINITY;var $5=Number.NEGATIVE_INFINITY;var $6=true;for(var $7=0;$7<this.$6.length;++$7){var $8=this.$6[$7];if($8==null){continue;}if($7<$0){$0=$7;}if($7>$1){$1=$7;}var $9=parseInt($8.css('left'),10);var $A=parseInt($8.css('top'),10);var $B=parseInt($8.css('width'),10);var $C=parseInt($8.css('height'),10);var $D=$9+$B;var $E=$A+$C;if($9<$2){$2=$9;}if($A<$3){$3=$A;}if($D>$4){$4=$D;}if($E>$5){$5=$E;}$6=false;}if($6){this.$C=null;this.$B=BvD.Rectangle.empty;}else{this.$C=new BvD.Offsets($0,$1);this.$B=BvD.Rectangle.fromLTRB($2,$3,$4,$5);}},$1B:function(){this.$B=null;if(this.$A>0){var $0=this.$6.length;for(var $1=0;$1<$0;++$1){var $2=this.$6[$1];if($2!=null){var $3=$2.data('bow-selection-rect');var $4={};$4['left']=($3.left*this.$F)+'px';$4['top']=($3.top*this.$F)+'px';$4['width']=($3.width*this.$F)+'px';$4['height']=($3.height*this.$F)+'px';$2.css($4);}}}},$1C:function(){this.$C=null;this.$B=null;if(!this.$D.left&&!this.$D.top&&!this.$E.left&&!this.$E.top){return;}var $0=this.$D.left;var $1=this.$D.top;var $2=this.$E.left;var $3=this.$E.top;var $4=true;if($3<$1){var $5=$3;$3=$1;$1=$5;$5=$2;$2=$0;$0=$5;$4=false;}for(var $6=0;$6<this.$7.get_$1();++$6){var $7=$6;if(!$4){$7=this.$7.get_$1()-$6-1;}var $8=false;var $9=this.$7.get_item($7);var $A=$9.top;var $B=$9.bottom;var $C=$9.left;var $D=$9.right;var $E=$9.width;if($1>$B||$3<$A){$8=false;}else if($1<$A&&$3>$B){$8=true;}else if($1<$B&&$0<($C+$E/2)&&($2>($D-2*$E/3)||$3>$B)){$8=true;}else if($1<$A&&$3>$A&&$2>$C+$E/3){$8=true;}else{$8=false;}if($8){if(this.$6[$7]==null){if(this.$A>0){$8=false;if((this.$6[$7-1]!=null&&(this.$7.get_item($7-1).top-$9.top<50))||this.$6[$7+1]!=null){$8=true;}}else if($0>$9.right){$8=false;}if($8){this.$1E($7,$4);}}}else{this.$1F($7,$4);}}},$1D:function($p0,$p1,$p2,$p3,$p4){var $0=0;var $1=0;var $2=9000;var $3=($p0)?$p1:$p3;var $4=($p0)?$p2:$p4;for(var $5=0;$2>0&&$5<this.$7.get_$1();++$5){var $6=$5;if(!$p0){$6=this.$7.get_$1()-$5-1;}var $7=this.$7.get_item($6);var $8=0;if($3>$7.right){$8+=Math.pow($3-$7.right,2);}else if($3<$7.left){$8+=Math.pow($7.left-$3,2);}if($4>$7.bottom){$8+=Math.pow($4-$7.bottom,2);}else if($4<$7.top){$8+=Math.pow($7.top-$4,2);}var $9=Math.sqrt($8);if($9<$2){$2=$9;$0=$5;$1=$6;}}return $0;},$1E:function($p0,$p1){if(this.$6[$p0]!=null){return;}var $0=$p1&&$p0>0&&this.$6[$p0-1]!=null;var $1=!$p1&&$p0<this.$7.get_$1()-1&&this.$6[$p0+1]!=null;var $2=($0)?this.$7.get_item($p0-1):null;var $3=this.$7.get_item($p0);var $4=($1)?this.$7.get_item($p0+1):null;if($0&&$2.top===$3.top&&$2.bottom===$3.bottom){var $6=this.$6[$p0-1];var $7=this.$6[$p0+1];var $8=$6.data('bow-selection-rect');$8=BvD.Rectangle.fromLTRB($8.left,$8.top,$3.right,$8.bottom);if($7!=null){var $9=$7.data('bow-selection-rect');if($8.top-$9.top<50){$8=BvD.Rectangle.fromLTRB($8.left,$8.top,$9.left,$8.bottom);}}$6.css('width',($8.width*this.$F)+'px').data('bow-selection-rect',$8);this.$6[$p0]=$6;}else if($1&&$4.top===$3.top&&$4.bottom===$3.bottom){var $A=this.$6[$p0+1];var $B=$A.data('bow-selection-rect');$B=BvD.Rectangle.fromLTRB($3.left,$B.top,$B.right,$B.bottom);var $C={};$C['left']=($B.left*this.$F)+'px';$C['width']=($B.width*this.$F)+'px';$A.css($C).data('bow-selection-rect',$B);this.$6[$p0]=$A;}else{var $D={};$D['left']=($3.left*this.$F)+'px';$D['top']=($3.top*this.$F)+'px';$D['width']=($3.width*this.$F)+'px';$D['height']=($3.height*this.$F)+'px';$D['position']='absolute';var $E=$('<div></div>').data('bow-selection-rect',$3).data('bow-selection-count',0).data('bow-selection-object',this).css($D).addClass(this.get_className()).appendTo(this.$8);this.$6[$p0]=$E;}var $5=this.$6[$p0].data('bow-selection-count');this.$6[$p0].data('bow-selection-count',$5+1);this.$A++;},$1F:function($p0,$p1){if(this.$6[$p0]==null){return;}var $0=$p1&&$p0>0&&this.$6[$p0-1]!=null;var $1=!$p1&&$p0<this.$7.get_$1()-1&&this.$6[$p0+1]!=null;var $2=($0)?this.$7.get_item($p0-1):null;var $3=this.$7.get_item($p0);var $4=($1)?this.$7.get_item($p0+1):null;if($0&&$2.top===$3.top&&$2.bottom===$3.bottom){var $6=this.$6[$p0];var $7=$6.data('bow-selection-rect');if($7.right>$2.right){$7=BvD.Rectangle.fromLTRB($7.left,$7.top,$2.right,$7.bottom);$6.css('width',($7.width*this.$F)+'px').data('bow-selection-rect',$7);}}else if($1&&$4.top===$3.top&&$4.bottom===$3.bottom){var $8=this.$6[$p0+1];var $9=$8.data('bow-selection-rect');if($9.left<$4.left){$9=BvD.Rectangle.fromLTRB($4.left,$9.top,$9.right,$9.bottom);var $A={};$A['left']=($9.left*this.$F)+'px';$A['width']=($9.width*this.$F)+'px';$8.css($A).data('bow-selection-rect',$9);}}var $5=this.$6[$p0].data('bow-selection-count');if($5>1){this.$6[$p0].data('bow-selection-count',$5-1);}else{this.$6[$p0].removeData().remove();}this.$6[$p0]=null;this.$A--;},$20:function(){if(this.$A>0){var $0=this.$6.length;for(var $1=0;$1<$0;++$1){if(this.$6[$1]!=null){this.$6[$1].removeData().remove();this.$6[$1]=null;}}this.$A=0;}}}
BvD.BR$19=function(reader,mouseDivId,selectionId){this.$D=[];this.$E=[];BvD.BR$19.initializeBase(this);if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}this.$18=reader;this.$18.add_zoomChanged(ss.Delegate.create(this,this.$1E));this.$18.add_pageLoaded(ss.Delegate.create(this,this.$1F));this.$18.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$22));this.$1C=new BvD.Css('image_selection');this.$1C.appendTo($(document));this.$F=$('#'+mouseDivId);this.$10=$('#'+selectionId);this.$F.on2('pointerdown.bowImagesSelectionManager',ss.Delegate.create(this,this.$2E)).on2('pointermove.bowImagesSelectionManager',ss.Delegate.create(this,this.$2F)).on2('dblclick.bowImagesSelectionManager',ss.Delegate.create(this,this.$20)).onGesture('hold',ss.Delegate.create(this,this.$21));if(mouseDivId===selectionId){this.$10.on('click','.'+'bow_selection_image_highlight',ss.Delegate.create(this,function($p1_0){
var $1_0=$($p1_0.currentTarget);var $1_1=$1_0.data('bow-selection-object');this.onSelectionActivated(new BvD.Selection2EventArgs($1_1));}));}}
BvD.BR$19.prototype={$C:null,$F:null,$10:null,$11:null,$12:false,$13:false,$14:false,$15:null,$16:null,$17:5,$18:null,$19:0,$1A:null,$1B:false,$1C:null,addSearchSelection:function($p0){if(!this.$1B){var $0=new BvD.BR$18(this,this.$19,this.$11,this.$10);$0.set_className('bow_search_image_highlight');$0.set_$14(new BvD.Offsets($p0,$p0));this.$E.add($0);}},clearSearchSelections:function(){var $0=this.$E.length;if($0>0){for(var $1=0;$1<$0;++$1){this.$E[$1].$19();}this.$E.clear();}},touchClearSelection:function(){this.$23();},touchStopMoving:function(){if(this.$C!=null){this.$27();}},touchMoveSelection:function($p0,$p1){if(this.$C!=null){var $0=this.$10;var $1=$0.offset();var $2=this.$18.get_$43();var $3=new BvD.Position(Math.floor(($p0.left-$1.left)/$2),Math.floor(($p0.top-$1.top)/$2));if($p1){this.$C.set_$12($3);}else{this.$C.set_$13($3);}}},get_list:function(){return this.$D.clone();},$1D:function($p0){if(!this.get_$6()||this.$11==null||this.$1B){return;}if(this.$2B($p0)){this.$23();this.onSelectionStarted(ss.EventArgs.Empty);var $0=this.$10;var $1=$0.offset();var $2=this.$18.get_$43();this.$C=new BvD.BR$18(this,this.$19,this.$11,$0);this.$C.set_className('bow_selection_image_user');this.$C.set_$12(new BvD.Position(Math.floor(($p0.left-$1.left)/$2),Math.floor(($p0.top-$1.top)/$2)));this.$C.$18();this.$27();}},$1E:function($p0,$p1){var $0=this.$18.get_$43();if(this.$19===$0){return;}this.$19=$0;for(var $1=0;$1<this.$D.length;++$1){this.$D[$1].set_$15(this.$19);}for(var $2=0;$2<this.$E.length;++$2){this.$E[$2].set_$15(this.$19);}if(this.$C!=null){this.$C.set_$15(this.$19);}},$1F:function($p0,$p1){this.$1B=this.$18.get_$45();this.$11=this.$18.get_$42();this.$19=this.$18.get_$43();if(this.$C!=null){if(this.$1A!==this.$18.get_currentTocEntry().get_xmlId()){this.$23();}else{var $0=this.$C.get_$14();this.$23();this.$C=new BvD.BR$18(this,this.$19,this.$11,this.$10);this.$C.set_className('bow_selection_image_user');this.$C.set_$14($0);}}this.$1A=this.$18.get_currentTocEntry().get_xmlId();this.$24();this.clearSearchSelections();this.$29();this.$26();},$20:function($p0){this.$1D(BvD.Mouse.jQueryGetPosition($p0,BvD.PointerPositionType.page));},$21:function($p0){if($p0.get_pointerType()===BvD.PointerType.touch){this.$1D($p0.get_positionPage());}},$22:function($p0,$p1){this.$23();this.$24();this.$26();},$23:function(){if(this.$C!=null){this.$C.$19();this.$C=null;this.onSelectionCleared(ss.EventArgs.Empty);}},$24:function(){for(var $0=0;$0<this.$D.length;++$0){this.$D[$0].$19();}this.$D.clear();},$25:function($p0){var $0='.'+'bow_selection_image_highlight'+'_'+$p0;this.$1C.get($0).set('background-color','#'+$p0);},$26:function(){if(this.$11==null||this.$1B){return;}var $0=this.$18.get_notes().getNotesOnCurrentPage();for(var $1=0;$1<$0.length;++$1){var $2=$0[$1];if($2.type===BvD.NoteType.printFidelity){var $3=this.$10;var $4='';if(!String.isNullOrEmpty($2.color)){var $6=$2.color.substr(1);$4=' '+'bow_selection_image_highlight'+'_'+$6;this.$25($6);}var $5=new BvD.BR$18(this,this.$19,this.$11,$3);$5.set_className('bow_selection_image_highlight'+$4);$5.set_linkedNote($2);$5.set_$12(this.$28($3,new BvD.Position($2.coordinates.left,$2.coordinates.top),true));$5.$18();$5.set_$13(this.$28($3,new BvD.Position($2.coordinates.right,$2.coordinates.bottom),true));if($5.get_$14()!=null){this.$D.add($5);}}}},$27:function(){try{var $0=this.$10;var $1=$0.offset();var $2=$0.width();var $3=$0.height();var $4=this.$C.get_$14();if($4==null){this.onSelectionEnded(null);return;}var $5=this.$28($0,this.$C.get_$16(),false);var $6=this.$28($0,this.$C.get_$17(),false);var $7=new BvD.Position(Math.round(this.$C.get_$16().left*this.$19)+$1.left,Math.round(this.$C.get_$16().top*this.$19)+$1.top);var $8=new BvD.Position(Math.round(this.$C.get_$17().left*this.$19)+$1.left,Math.round(this.$C.get_$17().top*this.$19)+$1.top);var $9=this.$7(this.$18.get_currentTocEntry().get_xmlId(),this.$C.get_$14(),this.$31());this.onSelectionEnded(new BvD.SelectionEventArgs(this.$18.get_currentTocEntry().get_xmlId(),BvD.NoteType.printFidelity,$9,$4,$7,$8,$5,$6));}catch($A){BvD.ClientSideError.send('[ImagesSelectionManager] SelectionEnd',$A);}},$28:function($p0,$p1,$p2){var $0=$p0.width()/this.$19;var $1=$p0.height()/this.$19;var $2;var $3;if(!$p2){$2=Math.round(($p1.left/$0)*1000);$3=Math.round(($p1.top/$1)*1000);}else{$2=Math.round(($p1.left*$0)/1000);$3=Math.round(($p1.top*$1)/1000);}return new BvD.Position($2,$3);},$29:function(){if(this.$11==null||!this.$11.get_$1()){this.$16=null;return;}this.$16=[];var $0=null;for(var $1=0;$1<this.$11.get_$1();++$1){var $2=this.$11.get_item($1);if(!$1){$0=$2;}else{if(Math.abs($0.right-$2.left)<30&&Math.abs($0.top-$2.top)<20&&Math.abs($0.bottom-$2.bottom)<20){$0=BvD.Rectangle.fromLTRB($0.left,$0.top,$2.right,$0.bottom);}else{if(this.$16.length>0){var $3=this.$16[this.$16.length-1];if(Math.abs($0.top-$3.bottom)<30&&Math.abs($0.left-$3.left)<30&&Math.abs($0.right-$3.right)<30){var $4=Math.min($3.left,$0.left);var $5=Math.max($3.right,$0.right);this.$16[this.$16.length-1]=BvD.Rectangle.fromLTRB($4,$3.top,$5,$0.bottom);}else{this.$16.add($0);}}else{this.$16.add($0);}$0=$2;}}}this.$16.add($0);for(var $6=0;$6<this.$16.length;++$6){this.$16[$6]=this.$2A(this.$16[$6]);}},$2A:function($p0){return BvD.Rectangle.fromLTRB($p0.left-this.$17,$p0.top-this.$17,$p0.right+this.$17,$p0.bottom+this.$17);},$2B:function($p0){if(this.$16!=null){var $0=this.$10.offset();$p0=new BvD.Position(Math.round(($p0.left-$0.left)/this.$19),Math.round(($p0.top-$0.top)/this.$19));for(var $1=0;$1<this.$16.length;++$1){if(this.$16[$1].contains($p0)){return true;}}}return false;},$2C:function(){if(!this.$12){this.$12=true;this.$F.css('cursor','text');}},$2D:function(){if(this.$12){this.$12=false;this.$F.css('cursor','');}},$2E:function($p0){if(!this.get_$6()||this.$1B){return;}if(($p0).pointerType!=='mouse'){return;}this.$23();if(this.$11==null||this.$15!=null){return;}$p0.preventDefault();this.onSelectionStarted(ss.EventArgs.Empty);this.$15=BvD.Pointer.getPosition($p0);$(document).on2('pointerup.bowImagesSelectionManager',ss.Delegate.create(this,this.$30));this.$14=true;},$2F:function($p0){if(!this.get_$6()||this.$1B){this.$2D();return;}if(($p0).pointerType!=='mouse'){return;}var $0=BvD.Pointer.getPosition($p0);if(!this.$14){if(this.$2B($0)){this.$2C();}else{this.$2D();}return;}$p0.preventDefault();var $1=this.$10;var $2=$1.offset();var $3=this.$18.get_$43();if(this.$14&&!this.$13){var $4=Math.abs(this.$15.left-$0.left);var $5=Math.abs(this.$15.top-$0.top);if($4>5||$5>5){this.$13=true;this.$C=new BvD.BR$18(this,this.$19,this.$11,$1);this.$C.set_className('bow_selection_image_user');this.$C.set_$12(new BvD.Position(Math.floor((this.$15.left-$2.left)/$3),Math.floor((this.$15.top-$2.top)/$3)));this.onSelectionStarted(ss.EventArgs.Empty);this.$2C();}}if(this.$13){this.$C.set_$13(new BvD.Position(Math.floor(($0.left-$2.left)/$3),Math.floor(($0.top-$2.top)/$3)));}},$30:function($p0){if(!this.get_$6()||this.$1B){return;}if(this.$14){this.$2F($p0);this.$14=false;this.$15=null;$(document).off2('pointerup.bowImagesSelectionManager');if(this.$13){this.$27();}this.$13=false;}},$31:function(){return this.$18.get_$46();}}
BvD.ImagesContentsNavigator=function(toc){BvD.ImagesContentsNavigator.initializeBase(this);this.$0=toc;}
BvD.ImagesContentsNavigator.prototype={$0:null,get_first:function(){return this.$0.get_root().get_children()[0].getFirstDescendantOrFollowingBvdPage();},preceding:function(tocEntry){if(tocEntry==null||tocEntry.get_isRoot()||tocEntry.get_isHidden()){return null;}var $0=tocEntry.getFirstDescendantOrFollowingBvdPage();do{tocEntry=$0;$0=tocEntry.get_previous();}while($0!=null&&(!$0.get_isBvdPage()||$0.get_isHidden()||$0.get_unavailable()));return $0;},following:function(tocEntry){if(tocEntry==null||tocEntry.get_isRoot()||tocEntry.get_isHidden()){return null;}var $0=tocEntry.getFirstDescendantOrFollowingBvdPage();do{tocEntry=$0;$0=tocEntry.get_next();}while($0!=null&&(!$0.get_isBvdPage()||$0.get_isHidden()||$0.get_unavailable()));return $0;}}
BvD.BR$B=function(str){if(String.isNullOrEmpty(str)){return;}var $0=$.parseJSON(str);var $1=$0['x1'];var $2=$0['y1'];var $3=$0['x2'];var $4=$0['y2'];if(!BvD.Is.Array($1)||!BvD.Is.Array($2)||!BvD.Is.Array($3)||!BvD.Is.Array($4)){throw new Error(String.format(BvD.Errors.code11_2,str));}var $5=$1.length;if($5!==$2.length||$5!==$3.length||$5!==$4.length){throw new Error(String.format(BvD.Errors.code11_3,str));}this.$0=new Array($5);for(var $6=0;$6<$5;++$6){var $7=$1[$6];var $8=$2[$6];var $9=$3[$6];var $A=$4[$6];if(!BvD.Is.Int32($7)||!BvD.Is.Int32($8)||!BvD.Is.Int32($9)||!BvD.Is.Int32($A)){throw new Error(String.format(BvD.Errors.code11_4,$6,str));}this.$0[$6]=new BvD.Rectangle($8,$7,$9-$7,$A-$8);}}
BvD.BR$B.prototype={$0:null,get_$1:function(){return (this.$0==null)?0:this.$0.length;},get_item:function($p0){if(this.$0==null||$p0<0||$p0>=this.$0.length){throw new Error(String.format(BvD.Errors.code16_4,$p0));}return this.$0[$p0];}}
BvD.BR$A=function(){}
BvD.BR$A.$0=function($p0,$p1,$p2){if($p0==null){throw new Error(String.format(BvD.Errors.code16_1,'data'));}var $0=16;var $1=$p1%$0;var $2=$p2%$0;var $3=$p1-$1;var $4=$p2-$2;var $5=Math.floor($3/$0);var $6=Math.floor($4/$0);var $7=$5*$6;var $8=new Array($7);for(var $E=0;$E<$7;++$E){$8[$E]=$E;}var $9=Math.min($5,$6);for(var $F=0;$F<10;++$F){for(var $10=0;$10<$9;++$10){BvD.BR$A.$1($8,$5,$6,false,$10,20);BvD.BR$A.$1($8,$5,$6,true,$10,20);}}var $A=$p1*$p2*4;var $B=null;if(!BvD.Is.NullOrUndefined($p0.slice)){$B=$p0.slice(0,$p0.length);}else{$B=new Array($A);for(var $11=0;$11<$A;++$11){$B[$11]=$p0[$11];}}var $C=$p1*4;var $D=$0*4;for(var $12=0;$12<$6;++$12){var $13=$12*$0*$C;for(var $14=0;$14<$0;++$14){var $15=$12*$5;var $16=$13+($14*$C);for(var $17=0;$17<$5;++$17){var $18=$8[$15];var $19=Math.floor($18/$5);var $1A=$18-($19*$5);var $1B=($19*$0*$C)+($14*$C)+($1A*$D);var $1C=$16+($17*$D);for(var $1D=0;$1D<$0;++$1D){var $1E=$1D*4;var $1F=$1C+$1E;var $20=$1B+$1E;$p0[$1F+0]=$B[$20+0];$p0[$1F+1]=$B[$20+1];$p0[$1F+2]=$B[$20+2];$p0[$1F+3]=$B[$20+3];}$15++;}}}}
BvD.BR$A.$1=function($p0,$p1,$p2,$p3,$p4,$p5){var $0=($p3)?$p1:$p2;var $1=new Array($0);if($p3){var $2=$p4*$p1;for(var $3=0;$3<$0;++$3){$1[$3]=$p0[$2+(($3+$p5)%$0)];}for(var $4=0;$4<$0;++$4){$p0[$2+$4]=$1[$4];}}else{var $5=$p4;for(var $6=0;$6<$0;++$6){$1[$6]=$p0[$5+((($6+$p5)%$0)*$p1)];}for(var $7=0;$7<$0;++$7){$p0[$5+($7*$p1)]=$1[$7];}}}
BvD.MediaOverlay=function(reader){this.$5=false;this.$7=null;if(reader.get_mode()!==1||!reader.get_$1C().useHtmlIFrame){return;}this.$0=reader;this.$1=BvD.IFrameProxy.of('#'+this.$0.get_$1C().viewerId);this.$6=false;this.$2=null;this.$8=null;this.$9=null;this.$A=null;this.$3=new Array(0);this.$B=false;this.$C=null;this.$D=1;this.$E=1;this.$4=new BvD.BR$2(this);this.$4.add_$4(ss.Delegate.create(this,this.$1E));this.$4.add_$2(ss.Delegate.create(this,this.$1F));}
BvD.MediaOverlay.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:false,$6:false,$7:null,$8:null,$9:null,$A:null,$B:false,$C:null,$D:0,$E:0,add_enabledChanged:function(value){this.$F=ss.Delegate.combine(this.$F,value);},remove_enabledChanged:function(value){this.$F=ss.Delegate.remove(this.$F,value);},$F:null,add_volumeChanged:function(value){this.$10=ss.Delegate.combine(this.$10,value);},remove_volumeChanged:function(value){this.$10=ss.Delegate.remove(this.$10,value);},$10:null,add_rateChanged:function(value){this.$11=ss.Delegate.combine(this.$11,value);},remove_rateChanged:function(value){this.$11=ss.Delegate.remove(this.$11,value);},$11:null,add_playingChanged:function(value){this.$12=ss.Delegate.combine(this.$12,value);},remove_playingChanged:function(value){this.$12=ss.Delegate.remove(this.$12,value);},$12:null,add_escapabilityChanged:function(value){this.$13=ss.Delegate.combine(this.$13,value);},remove_escapabilityChanged:function(value){this.$13=ss.Delegate.remove(this.$13,value);},$13:null,setSmils:function(s){if(!String.isNullOrEmpty(s)){this.$7=new BvD.BR$5(s,this.$0.get_tableOfContents().get_root().get_xmlId());}},get_supported:function(){return this.$0!=null;},get_enabled:function(){return this.$5;},set_enabled:function(value){if(value!==this.$5&&this.get_supported()){this.$5=value;if(value){this.$15();}else{this.$16();}this.$2F(ss.EventArgs.Empty);}return value;},get_hasMediaOverlay:function(){return this.$7!=null;},get_skippableElements:function(){return this.$3;},set_skippableElements:function(value){if(value==null){value=new Array(0);}this.$3=value;return value;},get_isEscapable:function(){return this.$6;},get_volume:function(){return this.$D;},set_volume:function(value){value=BvD.MathUtils.normalizeRange(value,0,1);if(value!==this.$D){this.$D=value;if(this.$2!=null){this.$2.volume=value;}this.$30(ss.EventArgs.Empty);}return value;},get_rate:function(){return this.$E;},set_rate:function(value){value=BvD.MathUtils.normalizeRange(value,0.1,2);if(value!==this.$E){this.$E=value;if(this.$2!=null){this.$2.playbackRate=value;}this.$31(ss.EventArgs.Empty);}return value;},escape:function(){if(this.get_enabled()){var $0=this.$29();if($0!=null){this.$1D($0,true);}}},volumeUp:function(){var $0=this.get_volume();this.set_volume($0+0.1);},volumeDown:function(){var $0=this.get_volume();this.set_volume($0-0.1);},rateUp:function(){var $0=this.get_rate();this.set_rate($0+0.1);},rateDown:function(){var $0=this.get_rate();this.set_rate($0-0.1);},get_isPlaying:function(){return this.$B;},play:function(){if(this.get_enabled()){this.$2B();}},pause:function(){if(this.get_enabled()){this.$2C();}},toggle:function(){if(this.get_enabled()){if(this.get_isPlaying()){this.pause();}else{this.play();}}},previousPhrase:function(){if(this.get_enabled()&&this.$8!=null){var $0=this.$8.$A;if(this.$14($0)>-1){this.$1D($0,true);}}},nextPhrase:function(){if(this.get_enabled()&&this.$8!=null){var $0=this.$8.$B;if(this.$14($0)>-1){this.$1D($0,true);}}},goTo:function(id){if(this.$7==null){this.$C=id;}else{this.$1D(this.$1A(id),true);}},$14:function($p0){if($p0==null){return -1;}var $0=this.$0.get_displayedTocEntries();var $1=$p0.$3;for(var $2=0;$2<$0.length;++$2){if($1===$0[$2].get_xmlId()){return $2;}}return -1;},$15:function(){this.$1.onGesture('tap.bowMediaOverlay',ss.Delegate.create(this,this.$21));this.$1.on('click.bowMediaOverlay',null,ss.Delegate.create(this,this.$20));this.$0.add_pageLoaded(ss.Delegate.create(this,this.$19));this.$17();},$16:function(){this.$1.offGesture('tap.bowMediaOverlay',null);this.$1.off('click.bowMediaOverlay');this.$0.remove_pageLoaded(ss.Delegate.create(this,this.$19));this.$18();this.$24(false);this.$8=null;this.$A=null;this.$27();this.$7=null;this.$4.$8();},$17:function(){var $0=$('<audio id="BowMediaOverlay"></audio>').on('canplay.bowMediaOverlay',ss.Delegate.create(this,this.$2D)).on('ended.bowMediaOverlay',ss.Delegate.create(this,this.$2E)).appendTo(document.body);this.$2=$0[0];this.$2.volume=this.$D;this.$2.playbackRate=this.$E;this.$2.autoplay=false;this.$2.loop=false;},$18:function(){if(this.$2!=null){this.$2C();$(this.$2).off('.bowMediaOverlay').remove();this.$2=null;}},$19:function($p0,$p1){try{if(this.$14(this.$8)>=0){this.$26();}else{this.$2C();this.$8=null;this.$A=null;this.$27();this.$1B(false);var $0=this.$1.get_documents();for(var $1=0;$1<$0.length;++$1){$0.eq($1).find('body').addClass(this.$7.get_$9());}}}catch($2){BvD.ClientSideError.send('[MediaOverlay] PageLoaded',$2);}},$1A:function($p0){var $0=this.$0.get_displayedTocEntries();var $enum1=ss.IEnumerator.getEnumerator($0);while($enum1.moveNext()){var $1=$enum1.current;var $2=this.$7.$7($1.get_xmlId(),$p0);if($2!=null){return $2;}}return null;},$1B:function($p0){var $0=null;if(this.$8==null){if(this.$C!=null){$0=this.$1A(this.$C);}if($0==null){$0=this.$7.$6(this.$0.get_displayedTocEntries()[0].get_xmlId());}$p0=true;}else{$0=this.$1C(this.$8);}this.$1D($0,$p0);},$1C:function($p0){var $0=this.$0.get_displayedTocEntries();var $1=this.$0.get_contentsNavigator().following($0[$0.length-1]);var $2=$p0.$B;while($2!=null){var $3=this.$14($2);if($3===-1){return this.$7.$6($1.get_xmlId());}if(this.$2A($2)){$2=$2.$B;}else{break;}}return $2;},$1D:function($p0,$p1){this.$24(false);this.$4.$8();this.$8=$p0;this.$27();this.$28();if(this.$8==null){this.$2C();return;}var $0=false;var $1=this.$14(this.$8);if($1===-1){this.$0.goTo(this.$8.$3);$0=true;}var $2=this.$8.$7;if(!$2.length){if(!$0){this.$2.pause();this.$4.$7(this.$1.get_documents().eq($1).find('#'+this.$8.$2)[0]);}}else{if($2===this.$A){if($p1||this.$8.$8>this.$2.currentTime){this.$2.currentTime=this.$8.$8;}this.$2B();}else{this.$2.pause();this.$A=$2;this.$25(this.$2,this.$A);}}},$1E:function($p0,$p1){this.$1B(true);},$1F:function($p0,$p1){if(this.$4.get_$9()){this.$2B();}else{this.$2C();}},$20:function($p0){this.$22($p0.target);},$21:function($p0){if($p0.get_pointerType()===BvD.PointerType.touch){this.$22($p0.get_target());}},$22:function($p0){if(this.$7!=null){var $0=this.$1.get_documents();var $1=$($p0);for(var $2=0;$2<$0.length;++$2){if($1.closest($0.eq($2)).length>0){while($1.length>0){var $3=this.$1A($1.attr('id'));if($3!=null){this.$1D($3,true);break;}$1=$1.parent();}break;}}}},$23:function(){try{if(this.$8!=null){var $0=this.$2.currentTime;if(this.$8!=null&&!this.$8.$C($0)){this.$1B(false);}}}catch($1){this.$1B(false);}},$24:function($p0){if($p0){BvD.Timer.setInterval('BowMediaOverlay',16,ss.Delegate.create(this,this.$23));}else{BvD.Timer.stop('BowMediaOverlay');}},$25:function($p0,$p1){var $0=this.$1.get_documents().eq(0).find('head base').attr('href');var $1=$0+$p1;$($p0).empty().append('<source src="'+$1+'"></source>');$p0.load();},$26:function(){this.$9=null;this.$27();},$27:function(){if(this.$7!=null&&this.$8!==this.$9){var $0=this.$7.get_$8();var $1=this.$0.get_displayedTocEntries();var $2=0;var $3=this.$1.get_documents();if(this.$9!=null){$2=this.$14(this.$9);if($2>-1){$3.eq($2).find('#'+this.$9.$2).removeClass($0);}}this.$9=this.$8;if(this.$9!=null){$2=this.$14(this.$9);if($2>-1){$3.eq($2).find('#'+this.$9.$2).addClass($0);}}}},$28:function(){var $0=this.$29();var $1=$0!=null;if(this.$6!==$1){this.$6=$1;this.$33(ss.EventArgs.Empty);}},$29:function(){var $0=this.$8;while($0!=null){if($0.$1.length>0){$0=$0.$5;if($0!=null){return $0.get_$6();}break;}$0=$0.$0;}return null;},$2A:function($p0){while($p0!=null){if(this.$3.indexOf($p0.$1)>=0){return true;}$p0=$p0.$0;}return false;},$2B:function(){if(!this.$4.get_$6()){this.$2.play();this.$24(true);}if(!this.$B){this.$B=true;this.$32(ss.EventArgs.Empty);}},$2C:function(){if(!this.$4.get_$6()){this.$2.pause();this.$24(false);}if(this.$B){this.$B=false;this.$32(ss.EventArgs.Empty);}},$2D:function($p0){if(this.$8.$8>this.$2.currentTime){this.$2.currentTime=this.$8.$8;}this.$2B();},$2E:function($p0){this.$1B(false);},$2F:function($p0){if(this.$F!=null){try{this.$F(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlay] OnEnabledChange',$0);}}},$30:function($p0){if(this.$10!=null){try{this.$10(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlay] OnVolumeChange',$0);}}},$31:function($p0){if(this.$11!=null){try{this.$11(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlay] OnRateChanged',$0);}}},$32:function($p0){if(this.$12!=null){try{this.$12(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlay] OnPlayingChange',$0);}}},$33:function($p0){if(this.$13!=null){try{this.$13(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlay] OnEscapabilityChanged',$0);}}}}
BvD.MediaOverlayController=function(reader,obj){if(reader==null){throw new Error('');}if(obj==null){throw new Error('');}this.$0=reader;this.$1=reader.get_mediaOverlay();this.$2=obj;obj.on('click.bowMediaOverlayController','.BvDAC_Pause',ss.Delegate.create(this,this.$6)).on('click.bowMediaOverlayController','.BvDAC_Play',ss.Delegate.create(this,this.$7)).on('click.bowMediaOverlayController','.BvDAC_Previous',ss.Delegate.create(this,this.$8)).on('click.bowMediaOverlayController','.BvDAC_Next',ss.Delegate.create(this,this.$9)).on('click.bowMediaOverlayController','.BvDAC_Close',ss.Delegate.create(this,this.$A));this.$1.add_playingChanged(ss.Delegate.create(this,this.$3));this.$1.add_enabledChanged(ss.Delegate.create(this,this.$4));this.$0.add_pageLoaded(ss.Delegate.create(this,this.$5));}
BvD.MediaOverlayController.prototype={$0:null,$1:null,$2:null,dispose:function(){if(this.$2!=null){this.$2.off('.bowMediaOverlayController');this.$2=null;}if(this.$1!=null){this.$1.remove_playingChanged(ss.Delegate.create(this,this.$3));this.$1.remove_enabledChanged(ss.Delegate.create(this,this.$4));this.$0.remove_pageLoaded(ss.Delegate.create(this,this.$5));this.$1=null;}},$3:function($p0,$p1){this.$2.toggleClass('BvDACPlaying',this.$1.get_isPlaying());},$4:function($p0,$p1){this.$2.toggleClass('BvDACDisabled',!this.$1.get_enabled());},$5:function($p0,$p1){this.$2.toggleClass('BVDACNoMO',!this.$1.get_hasMediaOverlay());},$6:function($p0){$p0.preventDefault();this.$1.pause();},$7:function($p0){$p0.preventDefault();this.$1.play();},$8:function($p0){$p0.preventDefault();this.$1.previousPhrase();},$9:function($p0){$p0.preventDefault();this.$1.nextPhrase();},$A:function($p0){$p0.preventDefault();this.$1.set_enabled(false);}}
BvD.BR$2=function(mediaOverlay){this.$0=mediaOverlay;this.$0.add_volumeChanged(ss.Delegate.create(this,this.$E));this.$0.add_rateChanged(ss.Delegate.create(this,this.$F));this.$0.add_playingChanged(ss.Delegate.create(this,this.$10));}
BvD.BR$2.prototype={$0:null,$1:null,add_$2:function($p0){this.$3=ss.Delegate.combine(this.$3,$p0);},remove_$2:function($p0){this.$3=ss.Delegate.remove(this.$3,$p0);},$3:null,add_$4:function($p0){this.$5=ss.Delegate.combine(this.$5,$p0);},remove_$4:function($p0){this.$5=ss.Delegate.remove(this.$5,$p0);},$5:null,get_$6:function(){return this.$1!=null;},$7:function($p0){if(this.$1===$p0){return;}this.$8();if($p0==null){return;}this.$1=$p0;$($p0).on('canplay.bowEmbeddedMediaOverlay',ss.Delegate.create(this,this.$B)).on('play.bowEmbeddedMediaOverlay pause.bowEmbeddedMediaOverlay',ss.Delegate.create(this,this.$C)).on('ended.bowEmbeddedMediaOverlay',ss.Delegate.create(this,this.$D));$p0.load();$p0.play();},$8:function(){if(this.$1!=null){$(this.$1).off('.bowEmbeddedMediaOverlay');this.$1.pause();this.$1=null;}},get_$9:function(){return this.$1!=null&&!this.$1.paused;},$A:function(){if(this.$1!=null){this.$E(null,null);this.$F(null,null);this.$1.play();}},$B:function($p0){this.$A();},$C:function($p0){if(!this.$1.ended){this.$11(ss.EventArgs.Empty);}},$D:function($p0){this.$12(ss.EventArgs.Empty);},$E:function($p0,$p1){if(this.$1!=null){this.$1.volume=this.$0.get_volume();}},$F:function($p0,$p1){if(this.$1!=null){this.$1.playbackRate=this.$0.get_rate();}},$10:function($p0,$p1){if(this.$1!=null){if(this.$0.get_isPlaying()){this.$1.play();}else{this.$1.pause();}}},$11:function($p0){if(this.$3!=null){try{this.$3(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlayEmbeddedMedia] OnPlayingChanged',$0);}}},$12:function($p0){if(this.$5!=null){try{this.$5(this,$p0);}catch($0){BvD.ClientSideError.send('[MediaOverlayEmbeddedMedia] OnEnded',$0);}}}}
BvD.BR$5=function(str,fpid){var $0='';if(!String.isNullOrEmpty(str)){try{this.$3=fpid;$0=BvD.JsonUtils.decompress(str);var $1=$.parseJSON($0);this.$0=[];this.$1=[];this.$2=[];this.$A($1);}catch($2){BvD.ClientSideError.send('[MediaOverlaySmil]: '+$0,$2);}}}
BvD.BR$5.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,$6:function($p0){for(var $0=0;$0<this.$2.length;++$0){if(this.$2[$0].$3===$p0){return this.$2[$0];}}return null;},$7:function($p0,$p1){for(var $0=0;$0<this.$2.length;++$0){var $1=this.$2[$0];if($1.$3===$p0&&$1.$2===$p1){return $1;}}return null;},get_$8:function(){return this.$4;},get_$9:function(){return this.$5;},$A:function($p0){var $0=$p0;this.$4=BvD.Utils.objectToString($0[0]);this.$5=BvD.Utils.objectToString($0[1]);var $1=$0[2];var $2=$0[3];var $3=$p0;for(var $5=4;$5<$3.length;++$5){this.$0.add(this.$B($3[$5]['s'],null,$1,$2));}var $4=null;for(var $6=0;$6<this.$2.length;++$6){var $7=this.$2[$6];$7.$A=$4;if($4!=null){$4.$B=$7;}$4=$7;}},$B:function($p0,$p1,$p2,$p3){var $0=new BvD.BR$1C();$0.$0=$p1;$0.$1=this.$E($p0[0])||'';var $1=this.$D($p0[1],-1);$0.$3=($1>-1)?this.$3+'/'+$p2[$1].toLowerCase():'';$0.$2=this.$E($p0[2])||'';var $2=null;for(var $3=3;$3<$p0.length;++$3){var $4=null;var $5=$p0[$3];if(Object.keyExists($5,'s')){$4=this.$B($5['s'],$0,$p2,$p3);}else if(Object.keyExists($5,'p')){$4=this.$C($5['p'],$0,$p2,$p3);}$4.$4=$2;if($2!=null){$2.$5=$4;}$2=$4;$0.$7.add($4);}this.$1.add($0);return $0;},$C:function($p0,$p1,$p2,$p3){var $0=new BvD.BR$13();$0.$0=$p1;$0.$1=this.$E($p0[0])||'';$0.$3=this.$3+'/'+$p2[this.$D($p0[1],0)].toLowerCase();$0.$2=this.$E($p0[2])||'';$0.$7='';var $1=this.$D($p0[3],-1);if($1>-1){$0.$7=$p3[$1];var $2=this.$D($p0[4],-1);$0.$8=($2<0)?0:($2)/1000;var $3=this.$D($p0[5],-1);$0.$9=($3<0)?BvD.MathUtils.maxInt32:($3)/1000;}this.$1.add($0);this.$2.add($0);return $0;},$D:function($p0,$p1){return BvD.MathUtils.parseInt32(BvD.Utils.objectToString($p0),$p1);},$E:function($p0){return BvD.Utils.objectToString($p0);}}
BvD.BR$3=function(){}
BvD.BR$3.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,get_$6:function(){if(Type.canCast(this,BvD.BR$13)){return this;}var $0=(this).$7;for(var $1=0;$1<$0.length;++$1){var $2=$0[$1].get_$6();if($2!=null){return $2;}}return null;}}
BvD.BR$1C=function(){this.$7=[];BvD.BR$1C.initializeBase(this);}
BvD.BR$13=function(){BvD.BR$13.initializeBase(this);}
BvD.BR$13.prototype={$7:null,$8:0,$9:0,$A:null,$B:null,$C:function($p0){return this.$9>=$p0;}}
BvD.Note=function(id,userId,xmlId,offsets,coordinates,isHighlightOnly,type,title,comment,date,selection,color){this.id=id;this.userId=userId;this.xmlId=xmlId.toLowerCase();this.offsets=offsets;this.coordinates=coordinates;this.isHighlightOnly=isHighlightOnly;this.type=type;this.title=title;this.comment=comment;this.date=date;this.selection=selection||'';this.color=color||'';}
BvD.Note.areEqual=function(note1,note2){if(note1===note2){return true;}if(note1==null||note2==null){return false;}return note1.id===note2.id&&note1.userId===note2.userId&&String.equals(note1.xmlId,note2.xmlId,false)&&BvD.Offsets.areEqual(note1.offsets,note2.offsets)&&BvD.Rectangle.areEqual(note1.coordinates,note2.coordinates)&&note1.isHighlightOnly===note2.isHighlightOnly&&note1.type===note2.type&&note1.title===note2.title&&note1.comment===note2.comment&&BvD.BowDate.areEqual(note1.date,note2.date)&&note1.selection===note2.selection&&note1.color===note2.color;}
BvD.Note.prototype={id:0,userId:0,xmlId:null,offsets:null,coordinates:null,isHighlightOnly:false,type:0,title:null,comment:null,date:null,selection:null,color:null,equals:function(other){return BvD.Note.areEqual(this,other);}}
BvD.BR$4=function(){this.$0={};this.$1={};this.$2=[];}
BvD.BR$4.prototype={add_$3:function($p0){this.$4=ss.Delegate.combine(this.$4,$p0);},remove_$3:function($p0){this.$4=ss.Delegate.remove(this.$4,$p0);},$4:null,$5:function(){return this.$2.clone();},$6:function($p0){return this.$1[$p0];},$7:function($p0){var $0=[];if($p0!=null){for(var $1=0;$1<$p0.length;++$1){var $2=this.$6($p0[$1]);if($2!=null){$0.add($2);}}}return $0;},$8:function($p0){if(!String.isNullOrEmpty($p0)){var $0=this.$0[$p0.toLowerCase()];if($0!=null){return $0.clone();}}return [];},$9:function($p0){var $0=[];if($p0!=null){for(var $1=0;$1<$p0.length;++$1){var $2=this.$8($p0[$1]);if($2.length>0){$0.addRange($2);}}}return $0;},$A:function($p0){if($p0!=null){for(var $0=0;$0<$p0.length;++$0){var $1=this.$8($p0[$0]);if($1.length>0){return true;}}}return false;},$B:function($p0){if(!this.$2.length&&($p0==null||!$p0.length)){return;}if($p0==null){$p0=[];}var $0=this.$C();var $1=[];var $2=[];var $3=null;for(var $4=0;$4<$p0.length;++$4){var $5=$p0[$4];if($0.contains($5.id)){if(!BvD.Note.areEqual($5,this.$6($5.id))){$2.add($5);}$0.remove($5.id);}else{$1.add($5);}}$3=this.$7($0);if(!$1.length&&!$3.length&&!$2.length){return;}this.$2.clear();Object.clearKeys(this.$0);Object.clearKeys(this.$1);if($p0.length>0){this.$2.addRange($p0);var $6=$p0.length;for(var $7=0;$7<$6;++$7){var $8=$p0[$7];this.$1[$8.id]=$8;var $9=this.$0[$8.xmlId];if($9==null){$9=[];this.$0[$8.xmlId]=$9;}$9.add($8);}}this.$D(new BvD.CollectionChangedEventArgs($1,$3,$2));},$C:function(){var $0=[];for(var $1=0;$1<this.$2.length;++$1){$0.add(this.$2[$1].id);}$0.sort();return $0;},$D:function($p0){if(this.$4!=null){try{this.$4(this,$p0);}catch($0){BvD.ClientSideError.send('[Notes] OnCollectionChanged',$0);}}}}
BvD.NotesManager=function(reader){if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}this.$1=reader;this.$3=this.$1.get_$1C().allowNotes;this.$2=new BvD.BR$4();this.$2.add_$3(ss.Delegate.create(this,this.$7));}
BvD.NotesManager.prototype={$0:null,$1:null,$2:null,$3:false,add_collectionChanged:function(value){this.$4=ss.Delegate.combine(this.$4,value);},remove_collectionChanged:function(value){this.$4=ss.Delegate.remove(this.$4,value);},$4:null,add_enabledChanged:function(value){this.$5=ss.Delegate.combine(this.$5,value);},remove_enabledChanged:function(value){this.$5=ss.Delegate.remove(this.$5,value);},$5:null,add_flashNotesSelected:function(value){this.$6=ss.Delegate.combine(this.$6,value);},remove_flashNotesSelected:function(value){this.$6=ss.Delegate.remove(this.$6,value);},$6:null,get_enabled:function(){return this.$3;},set_enabled:function(value){if(this.$3!==value){this.$3=value;this.reload();this.$9(ss.EventArgs.Empty);}return value;},get_list:function(){return this.$2.$5();},getById:function(id){return (this.get_enabled())?this.$2.$6(id):null;},getByIds:function(ids){return (this.get_enabled())?this.$2.$7(ids):null;},get_currentPageHasNotes:function(){return this.getNotesOnCurrentPage().length>0;},get_countPageNoteOnCurrentPage:function(){var $0=0;if(this.get_enabled()){var $1=this.getNotesOnCurrentPage();for(var $2=0;$2<$1.length;++$2){if($1[$2].type===BvD.NoteType.page){$0++;}}}return $0;},getPageNoteOnCurrentPage:function(){var $0=this.getNotesOnCurrentPage();for(var $1=0;$1<$0.length;++$1){if($0[$1].type!==BvD.NoteType.page){$0.removeAt($1--);}}return $0;},getNotesOnCurrentPage:function(){var $0=this.$1.get_currentTocEntry();return this.getNotesOnXmlId(($0==null)?null:$0.get_xmlId());},getNotesOnXmlId:function(xmlid){if(String.isNullOrEmpty(xmlid)||!this.get_enabled()){return [];}var $0=(this.$1.get_mode()===1)?this.$1.get_tableOfContents().getSectionEntries(xmlid):this.$1.get_tableOfContents().getPageEntries(xmlid);if($0==null||!$0.length){return [];}var $1=[];for(var $2=0;$2<$0.length;++$2){$1.add($0[$2].get_xmlId());}return this.$2.$9($1);},getOrphanNotes:function(){var $0=[];var $1=this.$2.$5();for(var $2=0;$2<$1.length;++$2){var $3=$1[$2];var $4=$3.xmlId;if(this.$1.get_tableOfContents().getByXmlId($4)==null){$0.add($3);}}return $0;},hasNote:function(xmlid){if(String.isNullOrEmpty(xmlid)||!this.get_enabled()){return false;}var $0=(this.$1.get_mode()===1)?this.$1.get_tableOfContents().getSectionEntries(xmlid):this.$1.get_tableOfContents().getPageEntries(xmlid);if($0==null||!$0.length){return false;}var $1=[];for(var $2=0;$2<$0.length;++$2){$1.add($0[$2].get_xmlId());}return this.$2.$A($1);},get_readerWriter:function(){return this.$0;},set_readerWriter:function(value){if(this.$0!==value){this.$0=value;this.reload();}return value;},reload:function(){if(this.get_readerWriter()==null||!this.get_enabled()){this.$2.$B(null);return;}try{var $0=this.get_readerWriter().$0();if($0!=null){this.$2.$B($0);}}catch($1){BvD.ClientSideError.send('[NotesManager] Reload',$1);}},$7:function($p0,$p1){if(this.$4!=null){try{this.$4(this,$p1);}catch($0){BvD.ClientSideError.send('[NotesManager] ListChanged',$0);}}},$8:function($p0,$p1){if(this.$6!=null){try{this.$6(this,new BvD.FlashNotesListEventArgs($p0,$p1));}catch($0){BvD.ClientSideError.send('[NotesManager] NotesSelected',$0);}}},$9:function($p0){if(this.$5!=null){try{this.$5(this,$p0);}catch($0){BvD.ClientSideError.send('[NotesManager] OnEnabledChanged',$0);}}},$A:function($p0){var $0='';var $1=this.getNotesOnXmlId($p0);for(var $2=0;$2<$1.length;++$2){var $3=$1[$2];$0+=$3.id+',';$0+=$3.type+',';if($3.type===BvD.NoteType.html){$0+=$3.offsets.start+',';$0+=$3.offsets.end+',';}else if($3.type===BvD.NoteType.printFidelity){$0+=$3.coordinates.left+',';$0+=$3.coordinates.top+',';$0+=$3.coordinates.right+',';$0+=$3.coordinates.bottom+',';}}return $0;},$B:function($p0){var $0='[';var $1=true;var $2=this.getNotesOnXmlId($p0);for(var $3=0;$3<$2.length;++$3){var $4=$2[$3];if(!$1){$0+=',';}$1=false;$0+='{';$0+='"id":'+$4.id+',';$0+='"type":'+$4.type+',';if($4.type!==BvD.NoteType.page){$0+='"coord":';if($4.type===BvD.NoteType.html){$0+='['+$4.offsets.start+','+$4.offsets.end+'],';}else if($4.type===BvD.NoteType.printFidelity){$0+='['+$4.coordinates.left+','+$4.coordinates.top+','+$4.coordinates.right+','+$4.coordinates.bottom+'],';}}$0+='"shared":'+(($4.userId===BvD.Xsl.get_userId())?'false':'true');$0+='}';}$0+=']';return $0;}}
BvD.NotesParser=function(){}
BvD.NotesParser.parse=function(str){if(!String.isNullOrEmpty(str)){try{return BvD.NotesParser.$0(str);}catch($0){BvD.ClientSideError.send('[NotesParser] Parse',$0);}}return [];}
BvD.NotesParser.$0=function($p0){var $0=[];var $1=$.parseJSON($p0);var $dict1=$1;for(var $key2 in $dict1){var $2={key:$key2,value:$dict1[$key2]};var $3=$2.key;var $dict3=$2.value['notes'];for(var $key4 in $dict3){var $4={key:$key4,value:$dict3[$key4]};var $5=BvD.MathUtils.parseInt32($4.key,0);var $6=0;var $7=false;var $8='';var $9='';var $A=BvD.ServerDateTime.get_nowUtc();var $B='';var $C=BvD.NoteType.html;var $D=null;var $E=null;var $F=null;var $dict5=$4.value;for(var $key6 in $dict5){var $10={key:$key6,value:$dict5[$key6]};var $11=$10.key;var $12=$10.value;switch($11){case 'userid':$6=BvD.MathUtils.parseInt32(BvD.Utils.objectToString($12.toString()),0);break;case 'ishighlight':$7=!!$12;break;case 'comment':$8=$12.toString();break;case 'title':$9=$12.toString();break;case 'selection':$B=$12.toString();break;case 'date':$A=BvD.ServerDateTime.parse($12.toString());break;case 'color':$F=$12.toString();break;case 'coord':var $13=$12;switch($13[0]){case 0:$C=BvD.NoteType.page;break;case 2:$C=BvD.NoteType.html;break;case 3:$C=BvD.NoteType.printFidelity;break;}if($C===BvD.NoteType.html){$E=new BvD.Offsets($13[1],$13[2]);}else if($C===BvD.NoteType.printFidelity){$D=BvD.Rectangle.fromLTRB($13[1],$13[2],$13[3],$13[4]);}break;}}$0.add(new BvD.Note($5,$6,$3,$E,$D,$7,$C,$9,$8,new BvD.BowDate($A),$B,$F));}}return $0;}
BvD.NotesReaderWriter=function(){}
BvD.NotesReaderWriter.prototype={$0:function(){return this.reload();}}
BvD.Reader=function(config,toc){if(config==null){throw new Error(String.format(BvD.Errors.code16_1,'config'));}if(toc==null){throw new Error(String.format(BvD.Errors.code16_1,'toc'));}$(window).unload(function($p1_0){
});this.$12=config;this.$16=toc;this.$14=new BvD.BookmarksManager(this);this.$15=new BvD.NotesManager(this);this.$17=new BvD.ThumbnailsManager(this);this.$19=new BvD.MediaOverlay(this);}
BvD.Reader.create=function(mode,config,toc){switch(mode){case 3:return new BvD.BR$1B(config,toc);case 1:return new BvD.BR$14(config,toc);case 2:return new BvD.BR$1A(config,toc,null,null,null,null);}return null;}
BvD.Reader.createJsonReader=function(config,toc,jsonId,pageContentId,pageDivId,pfContentDivId){return new BvD.BR$1A(config,toc,jsonId,pageContentId,pageDivId,pfContentDivId);}
BvD.Reader.prototype={add_pageChanged:function(value){this.$0=ss.Delegate.combine(this.$0,value);},remove_pageChanged:function(value){this.$0=ss.Delegate.remove(this.$0,value);},$0:null,add_onReady:function(value){this.$1=ss.Delegate.combine(this.$1,value);},remove_onReady:function(value){this.$1=ss.Delegate.remove(this.$1,value);},$1:null,add_zoomChanged:function(value){this.$2=ss.Delegate.combine(this.$2,value);},remove_zoomChanged:function(value){this.$2=ss.Delegate.remove(this.$2,value);},$2:null,add_pageLoading:function(value){this.$3=ss.Delegate.combine(this.$3,value);},remove_pageLoading:function(value){this.$3=ss.Delegate.remove(this.$3,value);},$3:null,add_pageLoaded:function(value){this.$4=ss.Delegate.combine(this.$4,value);},remove_pageLoaded:function(value){this.$4=ss.Delegate.remove(this.$4,value);},$4:null,add_viewChanged:function(value){this.$5=ss.Delegate.combine(this.$5,value);},remove_viewChanged:function(value){this.$5=ss.Delegate.remove(this.$5,value);},$5:null,add_linkClicked:function(value){this.$6=ss.Delegate.combine(this.$6,value);},remove_linkClicked:function(value){this.$6=ss.Delegate.remove(this.$6,value);},$6:null,add_grabChanged:function(value){this.$7=ss.Delegate.combine(this.$7,value);},remove_grabChanged:function(value){this.$7=ss.Delegate.remove(this.$7,value);},$7:null,add_grabStarted:function(value){this.$8=ss.Delegate.combine(this.$8,value);},remove_grabStarted:function(value){this.$8=ss.Delegate.remove(this.$8,value);},$8:null,add_grabEnded:function(value){this.$9=ss.Delegate.combine(this.$9,value);},remove_grabEnded:function(value){this.$9=ss.Delegate.remove(this.$9,value);},$9:null,add_keyPressed:function(value){this.$A=ss.Delegate.combine(this.$A,value);},remove_keyPressed:function(value){this.$A=ss.Delegate.remove(this.$A,value);},$A:null,add_noFlashDetected:function(value){this.$B=ss.Delegate.combine(this.$B,value);},remove_noFlashDetected:function(value){this.$B=ss.Delegate.remove(this.$B,value);},$B:null,add_redirected:function(value){this.$C=ss.Delegate.combine(this.$C,value);},remove_redirected:function(value){this.$C=ss.Delegate.remove(this.$C,value);},$C:null,add_somPanelStateChanged:function(value){this.$D=ss.Delegate.combine(this.$D,value);},remove_somPanelStateChanged:function(value){this.$D=ss.Delegate.remove(this.$D,value);},$D:null,add_noteAdded:function(value){this.$E=ss.Delegate.combine(this.$E,value);},remove_noteAdded:function(value){this.$E=ss.Delegate.remove(this.$E,value);},$E:null,add_noteRemoved:function(value){this.$F=ss.Delegate.combine(this.$F,value);},remove_noteRemoved:function(value){this.$F=ss.Delegate.remove(this.$F,value);},$F:null,add_allNotesSelected:function(value){this.$10=ss.Delegate.combine(this.$10,value);},remove_allNotesSelected:function(value){this.$10=ss.Delegate.remove(this.$10,value);},$10:null,add_logHit:function(value){this.$11=ss.Delegate.combine(this.$11,value);},remove_logHit:function(value){this.$11=ss.Delegate.remove(this.$11,value);},$11:null,$12:null,$13:false,$14:null,$15:null,$16:null,$17:null,$18:null,$19:null,$1A:'',$1B:'',get_$1C:function(){return this.$12;},get_tableOfContents:function(){return this.$16;},get_isReady:function(){return this.$13;},set_isReady:function(value){this.$13=value;return value;},get_iframeCSSPath:function(){return this.$1A;},set_iframeCSSPath:function(value){this.$1A=value||'';return value;},get_anchor:function(){return this.$1B;},set_anchor:function(value){this.$1B=value||'';return value;},start:function(){},get_is508Enabled:function(){return false;},smartPageDown:function(){},smartPageUp:function(){},prefetchPrevious:function(){},previous:function(){},prefetchNext:function(){},next:function(){},prefetchGoTo:function(destination){},goTo:function(destination){},get_currentTocEntry:function(){return null;},get_displayedTocEntries:function(){return null;},isOnThisXmlid:function(xmlid){return false;},get_isFirstPage:function(){return false;},get_isLastPage:function(){return false;},zoomIn:function(){},zoomOut:function(){},zoomPageWidth:function(){},zoomPageHeight:function(){},zoomPageScreen:function(){},get_zoomLevel:function(){return -1;},set_zoomLevel:function(value){return value;},get_isFirstZoomLevel:function(){return false;},get_isLastZoomLevel:function(){return false;},get_grab:function(){return false;},set_grab:function(value){return value;},get_view:function(){return 0;},set_view:function(value){return value;},reload:function(){},print:function(){},print2:function(fromXmlid,countPages){},setFocus:function(focusType){},get_currentQuery:function(){return '';},setSearchTerms:function(terms){},setQuery:function(query){},showSearchTerms:function(val){},get_selectionMode:function(){return -1;},set_selectionMode:function(value){return value;},get_bookmarks:function(){return this.$14;},get_notes:function(){return this.$15;},get_thumbnails:function(){return this.$17;},get_mediaOverlay:function(){return this.$19;},get_contentsNavigator:function(){return this.$18;},set_contentsNavigator:function(value){if(value==null){throw new Error(String.format(BvD.Errors.code16_1,'value'));}this.$18=value;return value;},forceReload:function(xmlid){},setFlashToc:function(flashToc){},get_touchScrollingEnabled:function(){return false;},set_touchScrollingEnabled:function(value){return value;},createConfig:function(controlerConfig,currentViewConfig,allViewsConfig){return null;},loadConfig:function(st,controlerConfig,currentViewConfig,allViewsConfig){return null;},getExtraURLParameter:function(name){return null;},setExtraURLParameter:function(name,value){},readPage:function(){},getIdealHeight:function(width){return 0;},emulateMouseWheel:function(delta){},onReaderReady:function(e){if(this.$1!=null){try{this.$1(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnReaderReady',$0);}}},onPageChanged:function(e){if(this.$0!=null){try{this.$0(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnPageChanged',$0);}}},onZoomChanged:function(e){if(this.$2!=null){try{this.$2(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnZoomChanged',$0);}}},onPageLoading:function(e){if(this.$3!=null){try{this.$3(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnLoadingPage',$0);}}},onPageLoaded:function(e){if(this.$4!=null){try{this.$4(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnPageLoaded',$0);}}},onViewChanged:function(e){if(this.$5!=null){try{this.$5(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnViewChanged',$0);}}},onLinkClicked:function(e){if(this.$6!=null){try{this.$6(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnLinkClicked',$0);}}},onGrabChanged:function(e){if(this.$7!=null){try{this.$7(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnGrabChanged',$0);}}},onGrabStarted:function(e){if(this.$8!=null){try{this.$8(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnGrabStarted',$0);}}},onGrabEnded:function(e){if(this.$9!=null){try{this.$9(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnGrabEnded',$0);}}},onKeyPressed:function(e){if(this.$A!=null){try{this.$A(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnKeyPressed',$0);}}},onNoFlashDetected:function(e){if(this.$B!=null){try{this.$B(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnNoFlashDetected',$0);}}},onRedirected:function(e){if(this.$C!=null){try{this.$C(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnRedirected',$0);}}},onSomPanelStateChanged:function(e){if(this.$D!=null){try{this.$D(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnSomPanelStateChanged',$0);}}},onNoteAdded:function(e){if(this.$E!=null){try{this.$E(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnNoteAdded',$0);}}},onNoteRemoved:function(e){if(this.$F!=null){try{this.$F(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnNoteRemoved',$0);}}},onAllNotesSelected:function(e){if(this.$10!=null){try{this.$10(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnAllNotesSelected',$0);}}},onLogHit:function(e){if(this.$11!=null){try{this.$11(this,e);}catch($0){BvD.ClientSideError.send('[Reader] OnLogHit',$0);}}},showNotes:function(val){}}
BvD.ReaderConfig=function(){this.accessKey='';this.somState='';this.flashFile='';this.flashPreviewMessage='';this.flashPrintHeader='';this.flashPrintFooter='';this.flashInitialConfig='';this.link='';}
BvD.ReaderConfig.prototype={containerId:null,viewerId:null,ajaxComponent:null,xmlId:null,is508Enabled:false,allowBookmarks:false,allowNotes:false,allowHighlights:false,showSoms:false,useHtmlIFrame:false,flashSearchHighlightHeuristicEnabled:false,flashOfflineVersion:null,zoom:0,autoScrollTop:true,zoomConfig:null,pfReaderUseMouseDiv:true,$0:function(){var $0=new BvD.ReaderConfig();$0.containerId=this.containerId;$0.viewerId=this.viewerId;$0.ajaxComponent=this.ajaxComponent;$0.xmlId=this.xmlId;$0.is508Enabled=this.is508Enabled;$0.accessKey=this.accessKey;$0.allowBookmarks=this.allowBookmarks;$0.allowNotes=this.allowNotes;$0.allowHighlights=this.allowHighlights;$0.showSoms=this.showSoms;$0.somState=this.somState;$0.useHtmlIFrame=this.useHtmlIFrame;$0.flashFile=this.flashFile;$0.flashPreviewMessage=this.flashPreviewMessage;$0.flashPrintHeader=this.flashPrintHeader;$0.flashPrintFooter=this.flashPrintFooter;$0.flashInitialConfig=this.flashInitialConfig;$0.flashSearchHighlightHeuristicEnabled=this.flashSearchHighlightHeuristicEnabled;$0.flashOfflineVersion=this.flashOfflineVersion;$0.link=this.link;$0.zoom=this.zoom;$0.autoScrollTop=this.autoScrollTop;$0.zoomConfig=this.zoomConfig;$0.pfReaderUseMouseDiv=this.pfReaderUseMouseDiv;return $0;}}
BvD.ReaderSelection=function(){this.$1='';}
BvD.ReaderSelection.prototype={$0:null,get_linkedNote:function(){return this.$0;},set_linkedNote:function(value){this.$0=value;return value;},get_className:function(){return this.$1;},set_className:function(value){this.$1=value;return value;},get_boundingBox:function(){return null;},get_text:function(){return null;}}
BvD.ReaderZoomConfig=function(minZoomLevel,maxZoomLevel,zoomStep,imagesResolutions){this.minZoomLevel=minZoomLevel;this.maxZoomLevel=maxZoomLevel;this.zoomStep=zoomStep;if(imagesResolutions!=null){this.imagesResolutions=imagesResolutions;}else{this.imagesResolutions=[800,1000];}}
BvD.ReaderZoomConfig.prototype={minZoomLevel:0,maxZoomLevel:0,zoomStep:0,imagesResolutions:null}
BvD.SelectionsManager=function(){}
BvD.SelectionsManager.$8=function($p0,$p1,$p2){var $0={};$0.async=false;$0.cache=false;$0.data='imagepage=&xmlid='+encodeURIComponent($p0)+'&imagepageselection='+$p1.start+'-'+$p1.end+'&imagepageresolution='+encodeURIComponent($p2);$0.url='/bareprintfidelity';$0.type='GET';$0.dataType='xml';var $1='';$.ajax($0).success(function($p1_0){
var $1_0=$p1_0;if($1_0==null){return;}var $1_1=$1_0.getElementsByTagName('selectiontext');if($1_1==null){return;}var $1_2=$1_1[0];if($1_2==null){return;}var $1_3=$1_2.firstChild;if($1_3==null){return;}$1=$1_3.nodeValue;});return $1;}
BvD.SelectionsManager.prototype={$0:true,$1:null,add_selectionStarted:function(value){this.$2=ss.Delegate.combine(this.$2,value);},remove_selectionStarted:function(value){this.$2=ss.Delegate.remove(this.$2,value);},$2:null,add_selectionEnded:function(value){this.$3=ss.Delegate.combine(this.$3,value);},remove_selectionEnded:function(value){this.$3=ss.Delegate.remove(this.$3,value);},$3:null,add_cleared:function(value){this.$4=ss.Delegate.combine(this.$4,value);},remove_cleared:function(value){this.$4=ss.Delegate.remove(this.$4,value);},$4:null,add_selectionActivated:function(value){this.$5=ss.Delegate.combine(this.$5,value);},remove_selectionActivated:function(value){this.$5=ss.Delegate.remove(this.$5,value);},$5:null,addSearchSelection:function(position){},clearSearchSelections:function(){},touchClearSelection:function(){},touchStopMoving:function(){},touchMoveSelection:function(position,isLeft){},get_list:function(){return new Array(0);},get_loadTextFunction:function(){return this.$1;},set_loadTextFunction:function(value){this.$1=value;return value;},get_$6:function(){return this.$0;},set_$6:function($p0){this.$0=$p0;return $p0;},$7:function($p0,$p1,$p2){try{if(this.$1!=null){return this.$1($p0,$p1,$p2);}return BvD.SelectionsManager.$8($p0,$p1,$p2);}catch($0){BvD.ClientSideError.send('[SelectionsManager] LoadText',$0);}return '';},onSelectionStarted:function(e){if(this.$2!=null){try{this.$2(this,e);}catch($0){BvD.ClientSideError.send('[SelectionsManager] OnSelectionStarted',$0);}}},onSelectionEnded:function(e){if(this.$3!=null){try{this.$3(this,e);}catch($0){BvD.ClientSideError.send('[SelectionsManager] OnSelectionEnded',$0);}}},onSelectionCleared:function(e){if(this.$4!=null){try{this.$4(this,e);}catch($0){BvD.ClientSideError.send('[SelectionsManager] OnSelectionCleared',$0);}}},onSelectionActivated:function(e){if(this.$5!=null){try{this.$5(this,e);}catch($0){BvD.ClientSideError.send('[SelectionsManager] OnSelectionClicked',$0);}}}}
BvD.EpubAnchor=function(tocEntry,label,anchor){this.tocEntry=tocEntry;this.label=label;this.anchor=anchor;}
BvD.EpubAnchor.prototype={tocEntry:null,label:null,anchor:null}
BvD.TocEntry=function(){this.$F=[];this.$14=0;this.$15=0;this.$16=0;this.$17=0;}
BvD.TocEntry.prototype={$0:0,$1:0,$2:null,$3:0,$4:0,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:null,$D:null,$E:false,$10:0,$11:null,$12:null,$13:false,$18:false,$19:null,$1A:false,$1B:false,$1C:null,$1D:null,get_isRoot:function(){return this.$E;},set_isRoot:function(value){this.$E=value;return value;},get_bvDPagePosition:function(){return this.$0;},set_bvDPagePosition:function(value){this.$0=value;return value;},get_position:function(){return this.$1;},set_position:function(value){this.$1=value;return value;},get_xmlId:function(){return this.$2;},set_xmlId:function(value){this.$2=value;return value;},get_tokens:function(){return this.$4;},set_tokens:function(value){this.$4=value;return value;},get_childIndex:function(){return this.$3;},set_childIndex:function(value){this.$3=value;return value;},get_title:function(){return this.$5;},set_title:function(value){this.$5=value;return value;},get_prefix:function(){return this.$6;},set_prefix:function(value){this.$6=value;return value;},get_role:function(){return this.$7;},set_role:function(value){this.$7=value;return value;},get_isBvdPage:function(){return this.$7==='bvdpage';},get_isHidden:function(){return this.$7==='hidden';},get_isHiddenToc:function(){return this.$7==='hidden_toc';},get_isIndex:function(){return !this.$E&&this.$2.endsWith('index');},get_elementName:function(){return this.$8;},set_elementName:function(value){this.$8=value;return value;},get_page:function(){return this.$9;},set_page:function(value){this.$9=value;return value;},get_pageLabel:function(){return this.$A;},set_pageLabel:function(value){this.$A=value;return value;},get_parent:function(){return this.$B;},set_parent:function(value){this.$B=value;return value;},get_previousSibling:function(){return this.$C;},set_previousSibling:function(value){this.$C=value;return value;},get_nextSibling:function(){return this.$D;},set_nextSibling:function(value){this.$D=value;return value;},get_spineIndex:function(){return this.$10;},set_spineIndex:function(value){this.$10=value;return value;},get_previousSpine:function(){return this.$12;},set_previousSpine:function(value){this.$12=value;return value;},get_nextSpine:function(){return this.$11;},set_nextSpine:function(value){this.$11=value;return value;},get_previous:function(){if(!this.$1A){this.$1A=true;if(!this.get_isRoot()){var $0=this.get_previousSibling();if($0==null){var $1=this.get_parent();if($1!=null&&!$1.get_isRoot()){this.$1C=$1;}}else{var $2=$0.get_children();while($2!=null&&$2.length>0){$0=$2[$2.length-1];$2=$0.get_children();}this.$1C=$0;}}}return this.$1C;},get_next:function(){if(!this.$1B){this.$1B=true;if(!this.get_isRoot()){var $0=this.get_children();if($0!=null&&$0.length>0){this.$1D=$0[0];}else{var $1=this.get_nextSibling();if($1!=null){this.$1D=$1;}else{var $2=this;var $3=$2.get_parent();while($3!=null&&!$3.get_isRoot()){$2=$3;$3=$2.get_parent();if($2.get_nextSibling()!=null){this.$1D=$2.get_nextSibling();break;}}}}}}return this.$1D;},get_children:function(){return (this.$F);},getFirstDescendantOrFollowingBvdPage:function(){if(this.$18){return this.$19;}var $0=null;if(this.get_isBvdPage()){$0=this;}else if(this.get_next()!=null){$0=this.get_next().getFirstDescendantOrFollowingBvdPage();}this.$18=true;this.$19=$0;return $0;},get_unavailable:function(){return this.$13;},set_unavailable:function(value){this.$13=value;return value;},get_renditionLayout:function(){return this.$14;},set_renditionLayout:function(value){this.$14=value;return value;},get_renditionSpread:function(){return this.$15;},set_renditionSpread:function(value){this.$15=value;return value;},get_renditionOrientation:function(){return this.$16;},set_renditionOrientation:function(value){this.$16=value;return value;},get_renditionPageSpread:function(){return this.$17;},set_renditionPageSpread:function(value){this.$17=value;return value;},$1E:function($p0){this.$F.add($p0);}}
BvD.TableOfContents=function(str){this.$0={};this.$1={};this.$2={};this.$3=[];this.$8=0;this.$9=0;this.$A=0;if(!String.isNullOrEmpty(str)){var $0='';var $1;try{$0=BvD.JsonUtils.decompress(str);$1=$.parseJSON($0);this.$4=this.$B($1,[],[],null,true);this.$4.set_isRoot(true);this.$C(this.$4);this.$D(this.$4);this.$E();}catch($2){BvD.ClientSideError.send('[TableOfContents]: '+str,$2);}}}
BvD.TableOfContents.prototype={$4:null,$5:0,$6:0,$7:'ltr',get_pageProgressionDirection:function(){return this.$7;},get_root:function(){return this.$4;},get_hasSpines:function(){return this.$3.length>0;},get_spines:function(){return this.$3.clone();},getByXmlId:function(xmlid){if(!String.isNullOrEmpty(xmlid)){xmlid=xmlid.toLowerCase();if(Object.keyExists(this.$0,xmlid)){return this.$0[xmlid];}}return null;},getByBooKSection:function(bookSection){return (bookSection==null)?null:this.getByXmlId(bookSection.xmlId);},getByPage:function(page){if(!String.isNullOrEmpty(page)){page=page.toLowerCase();if(Object.keyExists(this.$1,page)){return this.$1[page].clone();}}return null;},getPageEntries:function(xmlid){var $0=null;var $1=this.getByXmlId(xmlid);if($1!=null){$0=this.getByPage($1.get_page());if($0==null){$0=[];$0.add($1);}}return $0;},getSectionEntries:function(xmlid){var $0=this.getByXmlId(xmlid);if($0==null){return null;}var $1=[];$1.add($0);for(var $2=0;$2<$0.get_children().length;++$2){var $3=$0.get_children()[$2];if($3.get_isBvdPage()){$1.add($3);}}return $1;},getEpubAnchor:function(label){if(!String.isNullOrEmpty(label)){label=label.toLowerCase();if(Object.keyExists(this.$2,label)){return this.$2[label];}}return null;},get_hasEpubAnchors:function(){return Object.getKeyCount(this.$2)>0;},isSamePage:function(xmlid1,xmlid2){if(String.isNullOrEmpty(xmlid1)||String.isNullOrEmpty(xmlid2)){return false;}var $0=this.getPageEntries(xmlid1);if($0!=null){xmlid2=xmlid2.toLowerCase();for(var $1=0;$1<$0.length;++$1){if($0[$1].get_xmlId()===xmlid2){return true;}}}return false;},isSameSection:function(xmlid1,xmlid2){if(String.isNullOrEmpty(xmlid1)||String.isNullOrEmpty(xmlid2)){return false;}return String.equals(xmlid1,xmlid2,true);},$B:function($p0,$p1,$p2,$p3,$p4){if($p0==null||!BvD.Is.Array($p0)){return null;}var $0=new BvD.TocEntry();$0.set_position(this.$5);this.$5+=1;var $1=$p0;if($p4){$p3=BvD.Utils.objectToString($1[5]).toLowerCase();var $3=$1[$1.length-1];var $4=BvD.Utils.objectToString($3[0]);var $5=$3[1];if(BvD.Is.Array($5)){for(var $8=0;$8<$5.length;++$8){$p1.add(BvD.Utils.objectToString($5[$8]));}}var $6=$1[2];if(BvD.Is.Array($6)){for(var $9=0;$9<$6.length;++$9){$p2.add(BvD.Utils.objectToString($6[$9]));}}var $7=BvD.Utils.objectToString($3[3]);this.$7=BvD.Utils.objectToString($3[4]).toLowerCase();if(this.$7!=='rtl'){this.$7='ltr';}this.$8=this.$F(BvD.MathUtils.parseInt32(BvD.Utils.objectToString($3[5]),-1));if(!this.$8){this.$8=1;}this.$9=this.$10(BvD.MathUtils.parseInt32(BvD.Utils.objectToString($3[6]),-1));if(!this.$9){this.$9=1;}this.$A=this.$12(BvD.MathUtils.parseInt32(BvD.Utils.objectToString($3[7]),-1));if(!this.$A){this.$A=3;}}var $2=null;for(var $A=0;$A<$1.length;++$A){if(!!$A&&$A!==7&&$A!==8&&$A!==9){$2=BvD.Utils.objectToString($1[$A]);}switch($A){case 0:if(!BvD.Is.Array($1[$A])){break;}var $B=$1[$A];var $C=$B.length;for(var $11=0;$11<$C;++$11){var $12=this.$B($B[$11],$p1,$p2,$p3,false);$12.set_parent($0);$12.set_childIndex($11);$0.$1E($12);}break;case 1:$0.set_title($2);break;case 2:$0.set_prefix($2);break;case 3:var $D=BvD.MathUtils.parseInt32($2,-1);if($D>-1){$0.set_role($p1[$D]);}if($0.get_isBvdPage()){$0.set_bvDPagePosition(this.$6);this.$6+=1;}break;case 4:var $E=BvD.MathUtils.parseInt32($2,-1);if($E>-1){$0.set_elementName($p2[$E]);}break;case 5:if($p4){var $13=$2.toLowerCase();$0.set_xmlId($13);this.$0[$13]=$0;}else{var $14=$2.toLowerCase();var $15=$p3+'/'+$14;$0.set_xmlId($15);this.$0[$15]=$0;if($0.get_isBvdPage()){$0.set_pageLabel($2);$0.set_page($14);if(!Object.keyExists(this.$1,$14)){this.$1[$14]=[];}this.$1[$14].add($0);}}break;case 6:$0.set_tokens(BvD.MathUtils.parseInt32($2,-1));break;case 7:break;case 8:if(!BvD.Is.Array($1[$A])){break;}var $F=$1[$A];var $10=$F.length;for(var $16=0;$16<$10;++$16){var $17=$F[$16];var $18=$17[0];var $19=$17[1];if(!String.isNullOrEmpty($18)&&!String.isNullOrEmpty($19)){this.$2[$18.toLowerCase()]=new BvD.EpubAnchor($0,$18,$19);}}break;case 9:if(BvD.Is.Array($1[$A])){var $1A=$1[$A];for(var $1B=0;$1B<$1A.length;++$1B){var $1C=BvD.Utils.objectToString($1A[$1B]);if(!$1B){$0.set_spineIndex(BvD.MathUtils.parseInt32($1C,-1));if($0.get_spineIndex()!==-1){this.$3.add($0);}}else if($1B===1){$0.set_renditionLayout(this.$F(BvD.MathUtils.parseInt32($1C,-1)));}else if($1B===2){$0.set_renditionSpread(this.$10(BvD.MathUtils.parseInt32($1C,-1)));}else if($1B===3){$0.set_renditionPageSpread(this.$11(BvD.MathUtils.parseInt32($1C,-1)));}else if($1B===4){$0.set_renditionOrientation(this.$12(BvD.MathUtils.parseInt32($1C,-1)));}}}if(!$0.get_renditionLayout()){$0.set_renditionLayout(this.$8);}if(!$0.get_renditionSpread()){$0.set_renditionSpread(this.$9);}if(!$0.get_renditionOrientation()){$0.set_renditionOrientation(this.$A);}if($0.get_renditionLayout()===1){$0.set_renditionSpread(1);$0.set_renditionOrientation(3);}if($0.get_renditionPageSpread()===3){$0.set_renditionSpread(1);}break;case 10:$0.set_unavailable(BvD.MathUtils.parseInt32($2,0)===1);break;default:break;}}return $0;},$C:function($p0){var $0=$p0.get_children();var $1=$0.length;var $2=null;for(var $3=0;$3<$1;++$3){var $4=$0[$3];if($2!=null){$4.set_previousSibling($2);$2.set_nextSibling($4);}$2=$4;this.$C($4);}},$D:function($p0){if($p0.get_isBvdPage()){return;}var $0=$p0.getFirstDescendantOrFollowingBvdPage();if($0!=null){var $3=$0.get_page();$p0.set_page($3);$p0.set_pageLabel($0.get_pageLabel());this.$1[$3].add($p0);}var $1=$p0.get_children();var $2=$1.length;for(var $4=0;$4<$2;++$4){this.$D($1[$4]);}},$E:function(){if(this.$3.length>0){this.$3.sort(function($p1_0,$p1_1){
var $1_0=$p1_0.get_spineIndex();var $1_1=$p1_1.get_spineIndex();if($1_0<$1_1){return -1;}if($1_0>$1_1){return 1;}return 0;});var $0=null;for(var $1=0;$1<this.$3.length;++$1){var $2=this.$3[$1];if($2.get_spineIndex()===-1){continue;}if($0!=null){$0.set_nextSpine($2);}$2.set_previousSpine($0);$0=$2;}}},$F:function($p0){switch($p0){case 0:return 1;case 1:return 2;default:return 0;}},$10:function($p0){switch($p0){case 0:return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 5;default:return 0;}},$11:function($p0){switch($p0){case 0:return 1;case 1:return 2;case 2:return 3;default:return 0;}},$12:function($p0){switch($p0){case 0:return 1;case 1:return 2;case 2:return 3;default:return 0;}}}
BvD.ContentsNavigator=function(){}
BvD.ThumbnailsDefaultInfoProvider=function(reader){BvD.ThumbnailsDefaultInfoProvider.initializeBase(this);this.$0=reader.get_tableOfContents();this.$1=reader.get_mode();}
BvD.ThumbnailsDefaultInfoProvider.prototype={$0:null,$1:0,getTocEntries:function(){if(this.$0.get_hasSpines()){return this.$0.get_spines();}else{var $0=[];var $1=this.$0.get_root();if(this.$1===2){this.$2($0,$1);}else{this.$3($0,$1);}return $0;}},$2:function($p0,$p1){if($p1.get_isBvdPage()){$p0.add($p1);}else{var $0=$p1.get_children();for(var $1=0;$1<$0.length;++$1){this.$2($p0,$0[$1]);}}},$3:function($p0,$p1){var $0=$p1.get_children();var $1=$0.length;for(var $2=0;$2<$1;++$2){var $3=$0[$2];if($3.get_isBvdPage()){continue;}$p0.add($3);this.$3($p0,$3);}},getThumbnailUrlInfo:function(mode,xmlid){if(mode===2){return new BvD.ThumbnailUrlInfo('/getflashthumbnails/'+xmlid+'/strip{1}.jpg',true);}else{return new BvD.ThumbnailUrlInfo('/gethtmlthumbnails/{0}.png',false);}}}
BvD.ThumbnailsInfoProvider=function(){}
BvD.ThumbnailsManager=function(reader){if(reader==null){throw new Error(String.format(BvD.Errors.code16_1,'reader'));}this.$6=false;this.$3=null;this.$5=new BvD.ThumbnailsDefaultInfoProvider(reader);this.$2=reader;this.$2.get_bookmarks().add_collectionChanged(ss.Delegate.create(this,this.$10));this.$2.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$11));this.$4=$('#'+'t_block_list');if(!this.$4.length){this.$4=$('#'+'readerThumbnails');}}
BvD.ThumbnailsManager.prototype={$2:null,$3:null,$4:null,$5:null,$6:false,$7:false,$8:false,get_infoProvider:function(){return this.$5;},set_infoProvider:function(value){this.$5=value;return value;},get_useDataSrc:function(){return this.$8;},set_useDataSrc:function(value){this.$8=value;return value;},getThumbnailStyle:function(xmlid){var $0=this.$2.get_tableOfContents().getByXmlId(xmlid);if($0==null){return null;}var $1=this.$5.getThumbnailUrlInfo(this.$2.get_mode(),this.$2.get_tableOfContents().get_root().get_xmlId());xmlid=$0.get_xmlId();var $2;var $3;var $4;var $5=false;if(this.$2.get_mode()===2||this.$2.get_mode()===3){$3=100;$4=130;$2='{0}';}else{$3=150;$4=195;$2='{1}';$5=true;}var $6=0;var $7=0;if($1.isStrip){$6=-($0.get_bvDPagePosition()%40)*$3;$7=Math.floor($0.get_bvDPagePosition()/40);}var $8=String.format($1.url,this.$16(xmlid),$7,xmlid);if($5){return $8;}return "background:url('"+$8+"');background-position:"+$6+'px 0px;';},$9:function(){if(!this.$7){this.$7=true;this.$15();this.$4.on('click','.thumbnail',ss.Delegate.create(this,this.$19)).on('mousedown','.thumbnail',ss.Delegate.create(this,this.$18));}},$A:function(){if(this.$6&&this.$3!=null&&this.$3.length>0){this.$2.goTo(this.$3.attr('data-thumbnail-xmlid'));}},$B:function(){this.$F(this.$4.find('.thumbnail').first());},$C:function(){this.$F(this.$4.find('.thumbnail').last());},$D:function($p0){if(!this.$6||this.$3==null){return;}switch($p0){case 0:this.$F(this.$3.prev());break;case 2:this.$F(this.$3.next());break;case 1:var $0=this.$3.offset();var $1=this.$3.prev();while($1.length>0){var $2=$1.offset();if($2.top<$0.top&&$2.left<=$0.left){this.$F($1);break;}$1=$1.prev();}break;case 3:var $3=this.$3.offset();var $4=this.$3.next();var $5=false;var $6=this.$3;while($4.length>0){var $7=$4.offset();if($7.top>$3.top&&$7.left>=$3.left){this.$F($4);$5=true;break;}$6=$4;$4=$4.next();}if(!$5&&$6.offset().top>$3.top){this.$F($6);}break;}},$E:function($p0){this.$F(this.$4.find('.thumbnail[data-thumbnail-xmlid="'+$p0.toLowerCase()+'"]'));},$F:function($p0){this.$14($p0);},$10:function($p0,$p1){if(this.$6){var $0=$p1.addedItems;var $1=$p1.updatedItems;var $2=$p1.removedItems;if($0!=null){var $enum1=ss.IEnumerator.getEnumerator($0);while($enum1.moveNext()){var $3=$enum1.current;this.$12($3.xmlId);}}if($1!=null){var $enum2=ss.IEnumerator.getEnumerator($1);while($enum2.moveNext()){var $4=$enum2.current;this.$12($4.xmlId);}}if($2!=null){var $enum3=ss.IEnumerator.getEnumerator($2);while($enum3.moveNext()){var $5=$enum3.current;this.$12($5.xmlId);}}}},$11:function($p0,$p1){if(this.$6){var $0=$p1.addedItems;var $1=$p1.updatedItems;var $2=$p1.removedItems;if($0!=null){var $enum1=ss.IEnumerator.getEnumerator($0);while($enum1.moveNext()){var $3=$enum1.current;this.$13($3.xmlId);}}if($1!=null){var $enum2=ss.IEnumerator.getEnumerator($1);while($enum2.moveNext()){var $4=$enum2.current;this.$13($4.xmlId);}}if($2!=null){var $enum3=ss.IEnumerator.getEnumerator($2);while($enum3.moveNext()){var $5=$enum3.current;this.$13($5.xmlId);}}}},$12:function($p0){this.$4.find('.thumbnail[data-thumbnail-xmlid="'+$p0.toLowerCase()+'"]').toggleClass('thumbnail_hasbookmark',this.$2.get_bookmarks().isBookmarked($p0));},$13:function($p0){this.$4.find('.thumbnail[data-thumbnail-xmlid="'+$p0.toLowerCase()+'"]').toggleClass('thumbnail_hasnote',this.$2.get_notes().hasNote($p0));},$14:function($p0){if($p0!=null&&$p0.length>0&&$p0.is('.thumbnail')){if(this.$3!=null){this.$3.removeClass('thumbnail_selected');}this.$3=$p0.addClass('thumbnail_selected');this.$3[0].scrollIntoView();}},$15:function(){if(this.$5==null){return;}var $0=this.$5.getTocEntries();var $1=this.$5.getThumbnailUrlInfo(this.$2.get_mode(),this.$2.get_tableOfContents().get_root().get_xmlId());var $2;var $3;var $4;var $5=false;if(this.$2.get_mode()===2||this.$2.get_mode()===3){$3=100;$4=130;$2='{0}';}else{$3=150;$4=195;$2='{1}';$5=true;}var $6=$0.length;var $7='';for(var $8=0;$8<$6;++$8){var $9=0;var $A=0;if($1.isStrip){$9=-($8%40)*$3;$A=Math.floor($8/40);}var $B=$0[$8];var $C=$B.get_xmlId();var $D=this.$2.get_bookmarks().isBookmarked($C);var $E=this.$2.get_notes().hasNote($C);$7+=this.$17($B,$1.url,$3,$4,$9,$A,$2,$5,$D,$E);}this.$4.append($7);this.$6=true;},$16:function($p0){var $0=BvD.BookSection.parse($p0);return $0.bookId.replaceAll('-','')+'/'+$0.sectionId;},$17:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7,$p8,$p9){$p7=$p7&&!$p4;var $0=$p0.get_xmlId();var $1=$p0.get_page();var $2=$p0.get_title();var $3=$p0.get_prefix();if(!String.isNullOrEmpty($3)){$2=$3+$2;}$2=String.format($p6,$1,$2);if($2.length>0){var $9=10;if($2.length>$9){$2=$2.substr(0,$9)+'...';}$2='<span class="thumbnail_label">'+BvD.HtmlUtils.escapeTagsAndEntities($2)+'</span>';}var $4=String.format($p1,this.$16($0),$p5,$0.toUpperCase());var $5='';var $6='';if(!$p7){$5="background:url('"+$4+"');background-position:"+$p4+'px 0px;';}else{$6='<img class="timgcontent" src="'+((this.$8)?'':$4)+'"'+((this.$8)?' data-src="'+$4+'"':'')+' width="'+$p2+'" height="'+$p3+'"/>';}var $7=($p8)?' thumbnail_hasbookmark':'';var $8=($p9)?' thumbnail_hasnote':'';return '<a href="/'+$0+'" style="width:'+$p2+'px;height:'+$p3+'px;'+$5+'" class="thumbnail'+$7+$8+'" data-thumbnail-xmlid="'+$0+'">'+$6+$2+'<span class="thumbnail_bookmark"></span><span class="thumbnail_note"></span><span class="thumbnail_selection"></span></a>';},$18:function($p0){$p0.preventDefault();this.$2.prefetchGoTo($($p0.currentTarget).attr('data-thumbnail-xmlid'));},$19:function($p0){$p0.preventDefault();this.$2.goTo($($p0.currentTarget).attr('data-thumbnail-xmlid'));}}
BvD.ThumbnailUrlInfo=function(url,isStrip){this.url=url;this.isStrip=isStrip;}
BvD.ThumbnailUrlInfo.prototype={url:null,isStrip:false}
BvD.Bookmark.registerClass('BvD.Bookmark');BvD.BR$F.registerClass('BvD.BR$F');BvD.BookmarksManager.registerClass('BvD.BookmarksManager');BvD.BookmarksParser.registerClass('BvD.BookmarksParser');BvD.BookmarksReaderWriter.registerClass('BvD.BookmarksReaderWriter');BvD.CollectionChangedEventArgs.registerClass('BvD.CollectionChangedEventArgs',ss.EventArgs);BvD.FlashAddNoteEventArgs.registerClass('BvD.FlashAddNoteEventArgs',ss.EventArgs);BvD.FlashKeyEventArgs.registerClass('BvD.FlashKeyEventArgs',ss.EventArgs);BvD.FlashLogHitEventArgs.registerClass('BvD.FlashLogHitEventArgs',ss.EventArgs);BvD.FlashNotesListEventArgs.registerClass('BvD.FlashNotesListEventArgs',ss.EventArgs);BvD.FlashRedirectEventArgs.registerClass('BvD.FlashRedirectEventArgs',ss.EventArgs);BvD.FlashRemoveNoteEventArgs.registerClass('BvD.FlashRemoveNoteEventArgs',ss.EventArgs);BvD.FlashSelectNotesEventArgs.registerClass('BvD.FlashSelectNotesEventArgs',ss.EventArgs);BvD.FlashSomPanelStateEventArgs.registerClass('BvD.FlashSomPanelStateEventArgs',ss.EventArgs);BvD.LinkEventArgs.registerClass('BvD.LinkEventArgs',ss.EventArgs);BvD.ReaderViewEventArgs.registerClass('BvD.ReaderViewEventArgs',ss.EventArgs);BvD.Selection2EventArgs.registerClass('BvD.Selection2EventArgs',ss.EventArgs);BvD.SelectionEventArgs.registerClass('BvD.SelectionEventArgs',ss.EventArgs);BvD.Reader.registerClass('BvD.Reader');BvD.BR$1B.registerClass('BvD.BR$1B',BvD.Reader);BvD.SelectionsManager.registerClass('BvD.SelectionsManager');BvD.BR$16.registerClass('BvD.BR$16',BvD.SelectionsManager);BvD.epubReadingSystem.registerClass('BvD.epubReadingSystem');BvD.BR$14.registerClass('BvD.BR$14',BvD.Reader);BvD.ReaderSelection.registerClass('BvD.ReaderSelection');BvD.BR$17.registerClass('BvD.BR$17',BvD.ReaderSelection);BvD.BR$15.registerClass('BvD.BR$15',BvD.SelectionsManager);BvD.ContentsNavigator.registerClass('BvD.ContentsNavigator');BvD.HtmlContentsNavigator.registerClass('BvD.HtmlContentsNavigator',BvD.ContentsNavigator);BvD.BR$11.registerClass('BvD.BR$11');BvD.HtmlViewport.registerClass('BvD.HtmlViewport');BvD.BR$10.registerClass('BvD.BR$10');BvD.BR$12.registerClass('BvD.BR$12');BvD.BR$D.registerClass('BvD.BR$D');BvD.BR$9.registerClass('BvD.BR$9');BvD.BR$8.registerClass('BvD.BR$8');BvD.BR$7.registerClass('BvD.BR$7');BvD.BR$1A.registerClass('BvD.BR$1A',BvD.Reader);BvD.BR$6.registerClass('BvD.BR$6');BvD.BR$C.registerClass('BvD.BR$C');BvD.BR$18.registerClass('BvD.BR$18',BvD.ReaderSelection);BvD.BR$19.registerClass('BvD.BR$19',BvD.SelectionsManager);BvD.ImagesContentsNavigator.registerClass('BvD.ImagesContentsNavigator',BvD.ContentsNavigator);BvD.BR$B.registerClass('BvD.BR$B');BvD.BR$A.registerClass('BvD.BR$A');BvD.MediaOverlay.registerClass('BvD.MediaOverlay');BvD.MediaOverlayController.registerClass('BvD.MediaOverlayController',null,ss.IDisposable);BvD.BR$2.registerClass('BvD.BR$2');BvD.BR$5.registerClass('BvD.BR$5');BvD.BR$3.registerClass('BvD.BR$3');BvD.BR$1C.registerClass('BvD.BR$1C',BvD.BR$3);BvD.BR$13.registerClass('BvD.BR$13',BvD.BR$3);BvD.Note.registerClass('BvD.Note');BvD.BR$4.registerClass('BvD.BR$4');BvD.NotesManager.registerClass('BvD.NotesManager');BvD.NotesParser.registerClass('BvD.NotesParser');BvD.NotesReaderWriter.registerClass('BvD.NotesReaderWriter');BvD.ReaderConfig.registerClass('BvD.ReaderConfig');BvD.ReaderZoomConfig.registerClass('BvD.ReaderZoomConfig');BvD.EpubAnchor.registerClass('BvD.EpubAnchor');BvD.TocEntry.registerClass('BvD.TocEntry');BvD.TableOfContents.registerClass('BvD.TableOfContents');BvD.ThumbnailsInfoProvider.registerClass('BvD.ThumbnailsInfoProvider');BvD.ThumbnailsDefaultInfoProvider.registerClass('BvD.ThumbnailsDefaultInfoProvider',BvD.ThumbnailsInfoProvider);BvD.ThumbnailsManager.registerClass('BvD.ThumbnailsManager');BvD.ThumbnailUrlInfo.registerClass('BvD.ThumbnailUrlInfo');BvD.BR$1B.$1D=null;BvD.BR$14.$1D=80;BvD.BR$14.$1E=240;BvD.BR$14.$1F=20;BvD.BR$18.$5=0;BvD.ReaderZoomConfig.$0=new BvD.ReaderZoomConfig(800,1000,200,null);})(jQuery);// This script was generated using Script# v0.7.4.0
