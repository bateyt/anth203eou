// CourseSmartReader.js
(function($){
Type.registerNamespace('CourseSmartReader');CourseSmartReader.CReader$2=function(){};CourseSmartReader.CReader$2.registerInterface('CourseSmartReader.CReader$2');CourseSmartReader.CReader$0=function(){};CourseSmartReader.CReader$0.registerInterface('CourseSmartReader.CReader$0');CourseSmartReader.CReader$1=function(){};CourseSmartReader.CReader$1.registerInterface('CourseSmartReader.CReader$1');window.InsertMobileStyle=function($p0,$p1){if(CourseSmartReader.CReader$F.get_$2()){var $0=document.createElement('link');$0.rel='stylesheet';$0.media=$p0;$0.href=$p1;var $1=document.getElementById('metaViewport');$1.parentNode.insertBefore($0,$1);}}
window.SubscriptionPackAddToBookshelf=function($p0){alert('It seems there is something missing here...');}
window.SwitchSmartReaderMode=function(){alert('Mmmm... not yet.');}
window.SmartReaderPopupToggle=function($p0,$p1,$p2){}
CourseSmartReader.CReader$22=function(domElm){CourseSmartReader.CReader$22.initializeBase(this,['DeleteConfirmModal',CourseSmartReader.CReader$22.$1_2(domElm)]);this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_3));}
CourseSmartReader.CReader$22.$1_2=function($p0){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(400);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.staticId='DeleteConfirmModalLayer';return $0;}
CourseSmartReader.CReader$22.prototype={add_$1_0:function($p0){this.$1_1=ss.Delegate.combine(this.$1_1,$p0);},remove_$1_0:function($p0){this.$1_1=ss.Delegate.remove(this.$1_1,$p0);},$1_1:null,$1_3:function($p0,$p1){this.get_rootElement().find('#deleteconfirm-ok').on('click',ss.Delegate.create(this,this.$1_4));},$1_4:function($p0){$p0.preventDefault();if(this.$1_1!=null){try{this.$1_1(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[DeleteConfirmLayer] OnDelete',$0);}}this.close();}}
CourseSmartReader.CReader$23=function(){CourseSmartReader.CReader$23.initializeBase(this,['VSMigrationInProgress',CourseSmartReader.CReader$23.$1_0()]);}
CourseSmartReader.CReader$23.$1_0=function(){var $0=new BvD.LayerConfig();$0.width=600;$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.className='migrationinprogresspopup';return $0;}
CourseSmartReader.CReader$1E=function(domElm,xmlid,userId){CourseSmartReader.CReader$1E.initializeBase(this,['SharedNotesPopup',CourseSmartReader.CReader$1E.$1_2(domElm,xmlid,userId)]);this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_3));this.$1_0=xmlid;this.$1_1=userId;}
CourseSmartReader.CReader$1E.$1_2=function($p0,$p1,$p2){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(560);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.className='sharednotespopup';$0.urlParameter.set('__sharexmlid',$p1).set('__shareuserid',$p2.toString(10));return $0;}
CourseSmartReader.CReader$1E.prototype={$1_0:null,$1_1:0,$1_3:function($p0,$p1){var $0=this.get_rootElement();$0.find('#subscribesharednotes').on('click',ss.Delegate.create(this,this.$1_4));$0.find('#subscribepasscode').on('click',ss.Delegate.create(this,this.$1_6));$0.find('#sharestopped').on('click',ss.Delegate.create(this,this.$1_5));$0.find('#cancelsetpasscode').on('click',ss.Delegate.create(this,this.$1_7));},$1_4:function($p0){$p0.preventDefault();var $0=new BvD.QueryString().set('__sharexmlid',this.$1_0).set('__shareuserid',this.$1_1.toString(10)).set('__sharednotesaction','subscribe');this.call($0,null,true);},$1_5:function($p0){$p0.preventDefault();var $0=new BvD.QueryString().set('__sharexmlid',this.$1_0).set('__shareuserid',this.$1_1.toString(10)).set('__sharednotesaction','stoppedview');this.call($0,null,true);},$1_6:function($p0){$p0.preventDefault();var $0=this.get_rootElement().find('#enter-password').val();var $1=new BvD.QueryString().set('__sharexmlid',this.$1_0).set('__shareuserid',this.$1_1.toString(10)).set('__sharepasscode',$0).set('__sharednotesaction','setpasscode');this.call($1,null,true);},$1_7:function($p0){$p0.preventDefault();var $0=new BvD.QueryString().set('__sharexmlid',this.$1_0).set('__shareuserid',this.$1_1.toString(10)).set('__sharednotesaction','unsubscribe');this.call($0,null,true);}}
CourseSmartReader.CReader$20=function(domElm,xmlid,sharingNoteUser){CourseSmartReader.CReader$20.initializeBase(this,['StopViewingModal',CourseSmartReader.CReader$20.$1_1(domElm,xmlid,sharingNoteUser)]);this.$1_0=sharingNoteUser;this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_2));}
CourseSmartReader.CReader$20.$1_1=function($p0,$p1,$p2){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(560);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.className='stopviewingpopup';$0.urlParameter.set('__sharexmlid',$p1).set('__shareuserid',$p2.userid.toString(10));return $0;}
CourseSmartReader.CReader$20.prototype={$1_0:null,$1_2:function($p0,$p1){var $0='';if(this.$1_0.accountrole==='Instructor'){$0='Professor '+this.$1_0.lastname;}else{$0=this.$1_0.firstname+' '+this.$1_0.lastname;}$('#shareusername').html($0);}}
CourseSmartReader._BBCode=function(){var $0='strong|br|b|em|i|u|strike|sub|sup|ol|ul|li|div|span|blockquote|p';var $1='font-weight|font-style|text-align|background-color|text-decoration|border|border-top|border-bottom|border-left|border-right|margin|margin-top|margin-bottom|margin-left|margin-right|padding|padding-top|padding-bottom|padding-left|padding-right';this.$3=new RegExp('\\[','ig');this.$4=new RegExp('\\]','ig');this.$5=new RegExp('<','ig');this.$6=new RegExp('>','ig');this.$7=new RegExp('&#91;','ig');this.$8=new RegExp('&#93;','ig');this.$9=new RegExp('style="([^"]*)"','ig');this.$A=new RegExp('<('+$0+')(\\s+[^>]*)?>','ig');this.$B=new RegExp('</('+$0+')>','ig');this.$C=new RegExp('\\[('+$0+')(\\s+[^\\]]*)?\\]','ig');this.$D=new RegExp('\\[/('+$0+')\\]','ig');this.$E=new RegExp('(?:^|;)[\\s]*('+$1+')[\\s]*:[\\s]*([a-z\\-0-9]+)','ig');}
CourseSmartReader._BBCode.$1=function($p0){if(CourseSmartReader._BBCode.$0==null){CourseSmartReader._BBCode.$0=new CourseSmartReader._BBCode();}return CourseSmartReader._BBCode.$0.$F($p0);}
CourseSmartReader._BBCode.$2=function($p0){if(CourseSmartReader._BBCode.$0==null){CourseSmartReader._BBCode.$0=new CourseSmartReader._BBCode();}return CourseSmartReader._BBCode.$0.$10($p0);}
CourseSmartReader._BBCode.prototype={$3:null,$4:null,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:null,$D:null,$E:null,$F:function($p0){if(!String.isNullOrEmpty($p0)){try{$p0=$p0.replace(this.$3,'&#91;').replace(this.$4,'&#93;').replace(this.$A,ss.Delegate.create(this,this.$11)).replace(this.$B,ss.Delegate.create(this,this.$12)).replace(this.$5,'&lt;').replace(this.$6,'&gt;');}catch($0){BvD.ClientSideError.send('[BBCode] Encode',$0);}}return $p0;},$10:function($p0){if(!String.isNullOrEmpty($p0)){try{$p0=$p0.replace(this.$5,'&lt;').replace(this.$6,'&gt;').replace(this.$C,'<$1$2>').replace(this.$D,'</$1>').replace(this.$7,'[').replace(this.$8,']');}catch($0){BvD.ClientSideError.send('[BBCode] Decode',$0);}}return $p0;},$11:function($p0,$p1,$p2){$p2=(BvD.Is.NullOrUndefined($p2))?'':$p2.toLowerCase().replace(this.$9,ss.Delegate.create(this,this.$13));return '['+$p1.toLowerCase()+$p2+']';},$12:function($p0,$p1){return '[/'+$p1.toLowerCase()+']';},$13:function($p0,$p1){var $0='';$p1=$p1.replace(this.$E,function($p1_0,$p1_1,$p1_2){
$0+=$p1_1+':'+$p1_2+';';return '';});if($0.length>0){return 'style="'+$0+'"';}return '';}}
CourseSmartReader.CReader$18=function(smartReaderUI){if(smartReaderUI.$2.$0.get_mode()===BvD.ReaderMode.flash){return;}this.$2=smartReaderUI;this.$1=this.$2.$2;this.$0=this.$1.$0;this.$3=[];this.$0.add_pageLoaded(ss.Delegate.create(this,this.$5));this.$0.add_zoomChanged(ss.Delegate.create(this,this.$6));this.$0.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$5));}
CourseSmartReader.CReader$18.prototype={$0:null,$1:null,$2:null,$3:null,$4:function(){this.$7();},$5:function($p0,$p1){$('#togglesharednotes').toggle(this.$1.$3.get_$1_4()!=null&&this.$1.$3.get_$1_4().get_$2()>0);this.$8();},$6:function($p0,$p1){this.$7();},$7:function(){try{var $0=this.$3.length;for(var $1=0;$1<$0;++$1){var $2=this.$3[$1];var $3=$2.data('bow_selection');var $4=0;var $5=0;if(this.$0.get_mode()===BvD.ReaderMode.images){var $7=$3.get_lastPosition();$4=$7.top;$5=$7.left;}else if(this.$0.get_mode()===BvD.ReaderMode.html){var $8=$3.get_firstPosition();var $9=$3.get_lastPosition();var $A=$8.top;var $B=$9.top;var $C=($A+$B)/2;$4=$C+34;$5=35;}var $6={};$6['top']=$4+'px';$6['left']=$5+'px';$2.css($6);}}catch($D){}},$8:function(){this.$A();var $0=this.$0.get_selections().get_list();var $1=$0.length;if($1>0){var $2=$((this.$0.get_mode()===BvD.ReaderMode.images)?'#pfcontent':'#refhtmlcontent');if(this.$0.get_mode()===BvD.ReaderMode.html&&this.$1.$1.useHtmlIFrame){$2=BvD.IFrameProxy.getIFramesDocumentFromObject($2).find('body');}for(var $3=0;$3<$1;++$3){var $4=$0[$3];var $5=$4.get_linkedNote().userId!==BvD.Xsl.get_userId();if($5){if(this.$0.get_mode()===BvD.ReaderMode.images){$4.set_className('bow_selection_image_highlight_shared');}else{$4.set_className('bow_html_highlight_shared');}}var $6=0;var $7=0;if(this.$0.get_mode()===BvD.ReaderMode.images){var $9=$4.get_lastPosition();$6=$9.top;$7=$9.left;}else if(this.$0.get_mode()===BvD.ReaderMode.html){var $A=$4.get_firstPosition();var $B=$4.get_lastPosition();var $C=$A.top;var $D=$B.top;var $E=($C+$D)/2;$6=$E+34;$7=35;}var $8=$('<div></div>').addClass('selection_unique').data('bow_selection',$4).css('position','absolute').css('top',$6+'px').css('left',$7+'px').css('z-index','1030').on('click',ss.Delegate.create(this,this.$9));if($5){$8.addClass('selection_shared');}this.$3.add($8);$2.append($8);}}},$9:function($p0){$p0.preventDefault();this.$2.$7.$10();var $0=$($p0.currentTarget).data('bow_selection');this.$2.$7.$11($0);},$A:function(){var $0=this.$3.length;if($0>0){for(var $1=0;$1<$0;++$1){this.$3[$1].remove();}this.$3.clear();}}}
CourseSmartReader.CReader$16=function(smartReaderUI){if(smartReaderUI.$2.$0.get_mode()===BvD.ReaderMode.flash){return;}this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$1.$3;this.$3=this.$0.$0;if(!this.$0.$1.allowBookmarks&&!this.$0.$1.allowNotes){this.$2.get_$68().addClass('hideelem');return;}this.$2.get_$68().removeClass('hideelem');this.$2.get_$6F().on('click',ss.Delegate.create(this,this.$12));this.$2.get_$70().on('click',ss.Delegate.create(this,this.$13));this.$2.get_$6A().on('click',ss.Delegate.create(this,this.$14));this.$2.get_$6B().on('click',ss.Delegate.create(this,this.$15));this.$3.add_pageLoaded(ss.Delegate.create(this,this.$16));this.$3.add_pageLoaded(ss.Delegate.create(this,this.$17));this.$3.add_pageLoaded(ss.Delegate.create(this,this.$18));this.$3.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$18));this.$3.get_bookmarks().add_collectionChanged(ss.Delegate.create(this,this.$17));this.$3.get_selections().add_selectionStarted(ss.Delegate.create(this,this.$1A));this.$3.get_selections().add_selectionEnded(ss.Delegate.create(this,this.$19));this.$3.get_selections().add_cleared(ss.Delegate.create(this,this.$1A));this.$16(null,null);this.$18(null,null);this.$17(null,null);}
CourseSmartReader.CReader$16.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:null,$D:null,$E:null,$F:null,$10:function(){this.$21(true,false,false);this.$21(false,false,false);},$11:function($p0){if($p0==null){return;}var $0=this.$0.$3.get_$1_4().$1($p0.get_linkedNote().userId);this.$21(false,true,$0!=null);var $1=this.$C;var $2=$1.width();var $3=0;var $4=0;if(this.$3.get_mode()===BvD.ReaderMode.html){var $5=$p0.get_firstPosition();var $6=$p0.get_lastPosition();$4=5;$3=($5.top+$6.top)/2+25;if(this.$0.$1.useHtmlIFrame){var $7=BvD.IFrameProxy.getIFramesDocumentFromObject(this.$2.get_$3A());$3-=$7.scrollTop();}}else{var $8=$p0.get_lastPosition();$4=$8.left-($2/2)+8;$3=$8.top;}$1.css('left',$4+'px');$1.css('top',($3+26)+'px');$1.data('bow_selection',$p0);},$12:function($p0){$p0.preventDefault();this.$1.$17();},$13:function($p0){$p0.preventDefault();if(this.$3.get_isReady()){this.$1A(null,null);this.$1.$18($p0.currentTarget,this.$3.get_currentTocEntry().get_xmlId(),true,null,BvD.NoteType.page);}},$14:function($p0){$p0.preventDefault();this.$1.$A.$7();},$15:function($p0){$p0.preventDefault();this.$1.$5.$C();},$16:function($p0,$p1){if(!this.$3.get_isReady()){return;}this.$7=$('#popupcontainer');this.$8=(this.$3.get_mode()===BvD.ReaderMode.html)?this.$7:$('#popupdivpf');if(this.$3.get_mode()===BvD.ReaderMode.images){this.$2.get_$62().toggleClass('pfdisabled',!this.$0.$1.allowNotes);this.$2.get_$61().toggleClass('pfdisabled',!this.$0.$1.allowBookmarks);var $2=this.$8;var $3=this.$7;var $4=$2.length>0&&$2.attr('data-copy')==='1';if($4){var $7=$3.html();$7=$7.replaceAll('template_','');$2.html($7);}$2.attr('data-copy','1');var $5=this.$6;if(!$4&&$2.length>0&&$5.parent().is($3)){$5.remove();$2.append($5);}var $6=this.$C;if(!$4&&$2.length>0&&$6.parent().is($3)){$6.remove();$2.append($6);}}this.$6=this.$8.find('#popupselect');this.$9=this.$6.find('#popupaddnotebut');this.$A=this.$6.find('#popupcopytext');this.$B=this.$6.find('#popuphighlight');this.$C=this.$8.find('#editpopupselect');this.$D=this.$C.find('#editpopupeditnote');this.$E=this.$C.find('#editpopupcopytext');this.$F=this.$C.find('#editpopupdelete');this.$9.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$1B));this.$B.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$1D));this.$A.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$1C));this.$D.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$1E));this.$E.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$1F));this.$F.off('click touchstart').on('click touchstart',ss.Delegate.create(this,this.$20));var $0=!this.$0.$1.allowNotes;this.$9.toggleClass('disabled',$0);this.$B.toggleClass('disabled',$0);this.$D.toggleClass('disabled',$0);this.$F.toggleClass('disabled',$0);var $1=this.$3.get_currentTocEntry().get_xmlId();if($1!==this.$4){this.$10();this.$4=$1;}},$17:function($p0,$p1){var $0=this.$3.get_bookmarks().get_currentPageIsBookmarked();var $1=($0)?this.$2.get_$6D().attr('data-str-removebookmark'):this.$2.get_$6D().attr('data-str-addbookmark');this.$2.get_$6D().find('a').attr('title',$1).html($1);this.$2.get_$6D().find('label span').html(($0)?'Remove Bookmark':'Bookmark');this.$2.get_$6D().toggleClass('marked',$0);},$18:function($p0,$p1){var $0=this.$3.get_notes().getNotesOnCurrentPage();var $1=($0==null)?0:$0.length;var $2=this.$2.get_$69();if($1>0){$2.removeClass('pfdisabled');var $3='View Note'+(($1>1)?'s':'');this.$2.get_$6A().html($1.toString()).attr('title',$3+' ('+$1+')');this.$2.get_$6C().html($3);}else{$2.addClass('pfdisabled');}},$19:function($p0,$p1){this.$10();this.$5=$p1;if(this.$5==null){return;}var $0=this.$5.positionStart;var $1=this.$5.positionEnd;if($0==null||$1==null){return;}this.$21(true,true,false);var $2=this.$6;var $3=$2.width();var $4=$2.height();var $5=this.$2.get_$3A().offset();var $6=$(window).height()-this.$2.get_$39().offset().top;var $7=0;var $8=40;var $9=0;var $A=0;if(this.$3.get_mode()===BvD.ReaderMode.html){if(CourseSmartReader.CReader$F.get_$2()){$7=-40;$8=0;if(BvD.Browser.isIPad){$7=-65;}}$9=0;$A=$7+$1.top+10-$5.top;if(CourseSmartReader.CReader$F.get_$2()){$9=Math.floor(($1.left+$0.left)/2)-($3/2)-$5.left;}else{$9=$1.left-($3/2)-$5.left;}if(this.$0.$1.useHtmlIFrame){var $B=BvD.IFrameProxy.getIFramesDocumentFromObject(this.$2.get_$3A());$9+=$8;$A=$A-$B.scrollTop()+120;}if(CourseSmartReader.CReader$F.get_$2()){var $C=$A+$4+$('.grtoolbar').height();if(BvD.Browser.isIPad){$C-=$(document).scrollTop();}var $D=-Math.min($6-$C,0);$A-=$D;}else{var $E=$A+$4;var $F=-Math.min($6-$E,0);$A-=$F;}}else{if(CourseSmartReader.CReader$F.get_$2()){$7=20;$8=0;}var $10=$('#pfcontent').offset();$9=$1.left-($3/2)-$10.left;$A=$7+$1.top+10-$10.top;}$2.css('left',$9+'px');$2.css('top',$A+'px');},$1A:function($p0,$p1){this.$5=null;this.$10();},$1B:function($p0){$p0.preventDefault();if(this.$5!=null){var $0=this.$5;var $1=(this.$0.get_isPageMode())?BvD.NoteType.printFidelity:BvD.NoteType.html;this.$1.$18(null,$0.xmlId,true,$0,$1);}this.$1A(null,null);},$1C:function($p0){$p0.preventDefault();if(this.$5!=null){this.$1.$1B(this.$5.text);}this.$1A(null,null);},$1D:function($p0){$p0.preventDefault();if(this.$5!=null){var $0=this.$5;var $1=(this.$0.get_isPageMode())?BvD.NoteType.printFidelity:BvD.NoteType.html;this.$1.$18(null,$0.xmlId,false,$0,$1);}this.$1A(null,null);},$1E:function($p0){$p0.preventDefault();var $0=this.$C.data('bow_selection');this.$10();this.$1.$19($p0.currentTarget,$0.get_linkedNote());},$1F:function($p0){$p0.preventDefault();var $0=this.$C.data('bow_selection');this.$10();this.$1.$1B($0.get_text());},$20:function($p0){$p0.preventDefault();var $0=this.$C.data('bow_selection');var $1=$0.get_linkedNote();this.$1.$1C($1);this.$10();},$21:function($p0,$p1,$p2){var $0=($p0)?this.$6:this.$C;if($0==null||!$0.length){return;}var $1=($p0)?'selpopupshown':'editpopupshown';if($p1){$0.removeClass('hideelem');this.$2.get_$68().parent().addClass($1);if($p2){$0.find('.deletenote').hide();$0.find('.copy').addClass('last');$0.find('#editpopupeditnote').children().html('View Note');}else{$0.find('.deletenote').css('display','');$0.find('.copy').removeClass('last');$0.find('#editpopupeditnote').children().html('Edit Note');}}else{$0.addClass('hideelem');this.$2.get_$68().parent().removeClass($1);}}}
CourseSmartReader.CReader$2D=function(smartReader,toc){CourseSmartReader.CReader$2D.initializeBase(this,[toc]);this.$2_0=smartReader;}
CourseSmartReader.CReader$2D.prototype={$2_0:null,following:function($p0){do{$p0=CourseSmartReader.CReader$2D.callBaseMethod(this, 'following',[$p0]);}while($p0!=null&&this.$2_0.$6.$5($p0));return $p0;},preceding:function($p0){do{$p0=CourseSmartReader.CReader$2D.callBaseMethod(this, 'preceding',[$p0]);}while($p0!=null&&this.$2_0.$6.$5($p0));return $p0;}}
CourseSmartReader.CReader$2E=function(smartReader,toc){CourseSmartReader.CReader$2E.initializeBase(this,[toc]);this.$2_0=smartReader;}
CourseSmartReader.CReader$2E.prototype={$2_0:null,following:function($p0){do{$p0=CourseSmartReader.CReader$2E.callBaseMethod(this, 'following',[$p0]);}while($p0!=null&&this.$2_0.$6.$5($p0));return $p0;},preceding:function($p0){do{$p0=CourseSmartReader.CReader$2E.callBaseMethod(this, 'preceding',[$p0]);}while($p0!=null&&this.$2_0.$6.$5($p0));return $p0;}}
CourseSmartReader.CReader$1A=function(pageSize,tocEntry){this.$0=pageSize;this.$1=tocEntry;}
CourseSmartReader.CReader$1A.prototype={$0:null,$1:null}
CourseSmartReader.CReader$1C=function(){}
CourseSmartReader.CReader$1C.prototype={$0:0,$1:0,$2:null,$3:function($p0){while(this.$1<$p0){if(this.$0>=this.$2.length-1){this.$0=this.$2.length;this.$1=654556;break;}this.$1+=this.$2[++this.$0];}return this.$1>=$p0;}}
CourseSmartReader.CReader$19=function(smartReader){this.$0=smartReader;}
CourseSmartReader.CReader$19.prototype={$0:null,$1:null,$2:function(){var $0=this.$0.$0.get_tableOfContents().get_root().get_xmlId();if(CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($0).get_isExpired()){return null;}if(this.$1==null){this.$1=CourseSmartLocalStorage.OfflineCache.getEPubIndex($0);}return this.$1;},getQueryTerms:function($p0){$p0=$p0.toUpperCase();var $0='[^a-z0-9\\-\ufffd\ufffd\ufffd\ufffd]';var $1=$p0.split(new RegExp($0,'gi'));if($1.length>0&&!$1[$1.length-1]){$1.removeAt($1.length-1);}return $1;},getSimpleSearch:function($p0,$p1,$p2){if($p0==null){return null;}var $0=this.getQueryTerms($p0);if(!$0.length){return null;}var $1=this.$0.$0.get_tableOfContents().get_root().get_xmlId();var $2=this.$2();var $3=$2.sec;var $4=$2.ct;if($3==null||$4==null){return null;}var $5=[];var $6=null;for(var $B=0;$B<$0.length;++$B){var $C=$0[$B];var $D=$4[$C];if($D==null){return null;}var $E=new CourseSmartReader.CReader$1C();$E.$0=0;$E.$1=0;$E.$2=(BvD.Is.Array($D))?$D:new Array($D);$5.add($E);$E.$1=$E.$2[0];if($6==null||$6.$1<$E.$1){$6=$E;}}var $7=[];this.$3($p1,$p2,$3,$7);if(!$7.length){return null;}var $8=false;var $9=-1;var $A=[];while(true){$9=Math.max($6.$1,$9);var $F=true;for(var $10=0;$10<$5.length;++$10){var $11=$5[$10].$3($9);if(!$11){$8=true;break;}if($6==null||$6.$1<$5[$10].$1){$6=$5[$10];}if(!$10){$9=$5[$10].$1;}$F=$F&&$5[$10].$1===$9;}if($8){break;}if($F&&$7.indexOf($9)>=0){var $12=$1+'/'+$3[$9];$A.add($12);}$9++;}return $A;},$3:function($p0,$p1,$p2,$p3){if(!$p0.get_isRoot()&&(this.$0.$6.$5($p0)||$p0.get_isBvdPage())){return;}if($p0.get_parent()!=null){var $0=BvD.BookSection.getSectionId($p0.get_xmlId()).toUpperCase();var $1=-1;for(var $2=0;$1<0&&$2<$p2.length;++$2){if($0===$p2[$2].toUpperCase()){$1=$2;}}if($1>=0){$p3.add($1);}}for(var $3=0;$p1&&$3<$p0.get_children().length;++$3){this.$3($p0.get_children()[$3],$p1,$p2,$p3);}}}
CourseSmartReader.CReader$15=function(smartReader){this.$0=smartReader;}
CourseSmartReader.CReader$15.prototype={$0:null,$1:null,$2:function(){var $0=this.$0.$0.get_tableOfContents().get_root().get_xmlId();if(CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($0).get_isExpired()){return null;}if(this.$1==null){this.$1=CourseSmartLocalStorage.OfflineCache.getSearches($0);}return this.$1;},getSimpleSearch:function($p0,$p1,$p2){if($p0==null){return null;}var $0=this.getQueryTerms($p0);if(!$0.length){return null;}var $1=this.$0.$0.get_tableOfContents().get_root().get_xmlId();var $2=this.$2();if($2==null){return null;}var $3=$2.all_words;var $4=[];for(var $8=0;$8<$3.length;++$8){var $9=$3[$8].toLowerCase();for(var $A=0;$A<$0.length;++$A){var $B=$0[$A];if($9.startsWith($B)&&$B.length>=$9.length-1){if($4[$A]==null){$4[$A]=[];}$4[$A].add(BvD.BaseConverter.encodeNumber($8,BvD.BaseConverter.alphabet64));break;}}}for(var $C=0;$C<$4.length;++$C){if($4[$C]==null){return null;}}var $5=[];this.$5($p1,$5);var $6=$2.pages;var $7=[];for(var $D=0;$D<$5.length;++$D){var $E=$5[$D];var $F=$E.get_xmlId();var $10=BvD.BookSection.getSectionId($F);if(!String.isNullOrEmpty($E.get_page())){$10=$E.get_page();}var $11=$6[$10];if($11==null){continue;}var $12=true;for(var $13=0;$12&&$13<$4.length;++$13){var $14=$4[$13];var $15=false;for(var $16=0;!$15&&$16<$14.length;++$16){var $17=$14[$16];$15=$11.indexOf(','+$17+',')>=0||$11===$17||$11.indexOf(','+$17)===($11.length-$17.length-1);}$12=$15;}if($12){$7.add($F);}}return $7;},$3:function($p0,$p1,$p2){var $0=$p1.start;var $1=$p1.end;var $2=this.$2();var $3=this.$0.$0.get_tableOfContents().getByXmlId($p0);var $4=$3.getFirstDescendantOrFollowingBvdPage();$3=$4||$3;$p0=$3.get_xmlId();var $5=BvD.BookSection.getSectionId($p0);if(!String.isNullOrEmpty($3.get_page())){$5=$3.get_page();}var $6=$2.all_words;var $7=$2.pages;var $8=$7[$5];if($8==null){return null;}var $9=0;var $A=0;var $B=0;var $C=$8.split(',');for(var $E=0;$E<$C.length;$E+=2){if($9===$0){$A=$E;}if($9===$1){$B=$E;}var $F=$C[$E+1];if(!$F){$F='1';}$9+=parseInt($F,10);}var $D='';for(var $10=$A;$10<=$B;$10+=2){var $11=$C[$10];var $12=BvD.BaseConverter.decodeNumber($11,BvD.BaseConverter.alphabet64);$D+=$6[$12]+' ';}return $D;},$4:function($p0,$p1){var $0=[];var $1=this.$0.$0.get_tableOfContents().get_root().get_xmlId();if(CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($1).get_isExpired()){return $0;}if($p0==null){return $0;}var $2=this.getQueryTerms($p0);if(!$2.length){return $0;}var $3=this.$0.$0.get_tableOfContents().getByXmlId($p1);var $4=$3.getFirstDescendantOrFollowingBvdPage();$3=$4||$3;$p1=$3.get_xmlId();var $5=BvD.BookSection.getSectionId($p1);if(!String.isNullOrEmpty($3.get_page())){$5=$3.get_page();}var $6=this.$2();var $7=$6.all_words;var $8=$6.pages;var $9=$8[$5];if($9==null||$7==null){return $0;}var $A=[];for(var $E=0;$E<$7.length;++$E){var $F=$7[$E].toLowerCase();for(var $10=0;$10<$2.length;++$10){var $11=$2[$10];if($F.startsWith($11)){$A.add(BvD.BaseConverter.encodeNumber($E,BvD.BaseConverter.alphabet64));}}}if(!$A.length){return $0;}var $B=$9.split(',');var $C=[];var $D=0;for(var $12=0;$12<$B.length;$12+=2){var $13=$D;var $14=$D+parseInt($B[$12+1],10);if($A.contains($B[$12])){$C.add($13);}$D=$14;}for(var $15=0;$15<$C.length;++$15){$0.add($C[$15]);}return $0;},getQueryTerms:function($p0){$p0=$p0.toLowerCase();var $0=$p0.split(new RegExp('\\s+','gi'));if($0.length>0&&!$0[$0.length-1]){$0.removeAt($0.length-1);}return $0;},$5:function($p0,$p1){if(!$p0.get_isRoot()&&this.$0.$6.$5($p0)){return;}if($p0.get_isBvdPage()){$p1.add($p0);}else{for(var $0=0;$0<$p0.get_children().length;++$0){this.$5($p0.get_children()[$0],$p1);}}}}
CourseSmartReader.CReader$14=function(smartReader){this.$0=smartReader;this.$1=smartReader.$0;this.$1.add_pageLoaded(ss.Delegate.create(this,this.$8));}
CourseSmartReader.CReader$14.prototype={$0:null,$1:null,$2:null,get_$3:function(){return (this.$0.get_isPageMode())?this.$0.$9:this.$0.$A;},$4:function($p0){this.$1.get_selections().clearSearchSelections();var $0=this.$0.$9;$0.$4(this.$2,this.$1.get_currentTocEntry().get_xmlId());var $1=this.get_$3();},$5:function($p0,$p1){this.$2=$p0;var $0;var $1=true;if($p1==='page'){$1=false;$0=this.$0.$0.get_currentTocEntry();}else if($p1==='chapter'){$0=this.$0.$6.$7(this.$0.$0.get_currentTocEntry());}else{$0=this.$0.$0.get_tableOfContents().get_root();}if($0==null){return null;}this.$8(null,null);return this.get_$3().getSimpleSearch($p0,$0,$1);},$6:function($p0){var $0=this.get_$3().getQueryTerms($p0);if($0!=null){return $0.join(';');}return '';},$7:function($p0){return this.get_$3().getQueryTerms($p0);},$8:function($p0,$p1){if(this.$1.get_mode()===BvD.ReaderMode.html){var $0=$('#'+this.$0.$1.viewerId);$0=BvD.IFrameProxy.getIFramesDocumentFromObject($0);var $1=new BvD.HtmlHighlighter($0[0],'htmlsearchh','bow_html_search_id');$1.removeAll();var $2=this.$2;if(String.isNullOrEmpty($2)){return;}var $3='';var $4=this.$7($2);for(var $8=0;$8<$4.length;++$8){if($3.length>0){$3+='|';}$3+='('+BvD.Utils.regexEscape($4[$8])+')';}$3='\\b('+$3+')\\b';var $5=$0.text();var $6=new BvD.RegExpHelper($3,'gi');var $7=$6.exec($5).getEnumerator();while($7.moveNext()){$1.add($7.get_current().offsets,0,null);}}else if(this.$1.get_mode()===BvD.ReaderMode.images){this.$1.get_selections().clearSearchSelections();var $9=this.$0.$9;var $A=$9.$4(this.$2,this.$1.get_currentTocEntry().get_xmlId());for(var $B=0;$B<$A.length;++$B){this.$1.get_selections().addSearchSelection($A[$B]);}}}}
CourseSmartReader.CReader$17=function(smartReader){this.$0=smartReader;this.$1=false;}
CourseSmartReader.CReader$17.prototype={$0:null,$1:false,get_$2:function(){return this.$1;},set_$2:function($p0){this.$1=$p0;return $p0;},$3:function($p0,$p1){if(BvD.Browser.isIPad){window.setTimeout(ss.Delegate.create(this,this.$4),500);}else{this.$4();}},$4:function(){try{var $0=$('#readerquery');var $1=$('#viewerterms');var $2=$('#search-noresult');var $3=($0.length>0)?$0.val():'';var $4=($1.length>0)?$1.val():'';var $5=$1.length>0;if($3.length>0&&$4.length>0&&$5){this.$5($3,$4);}else{this.$5('','');}this.$1=true;}catch($6){}},$5:function($p0,$p1){this.$0.$0.setSearchTerms($p1);this.$0.$0.setQuery($p0);}}
CourseSmartReader.CReader$2C=function(smartReader){CourseSmartReader.CReader$2C.initializeBase(this);this.$1_0=smartReader;}
CourseSmartReader.CReader$2C.prototype={$1_0:null,getTocEntries:function(){var $0=[];var $1=this.$1_0.$0.get_tableOfContents().get_root();if(this.$1_0.$0.get_mode()===BvD.ReaderMode.images){this.$1_1($0,$1);}else{this.$1_2($0,$1);}return $0;},$1_1:function($p0,$p1){if($p1.get_isBvdPage()&&!this.$1_0.$6.$5($p1)){$p0.add($p1);}else{var $0=$p1.get_children();for(var $1=0;$1<$0.length;++$1){this.$1_1($p0,$0[$1]);}}},$1_2:function($p0,$p1){var $0=$p1.get_children();var $1=$0.length;for(var $2=0;$2<$1;++$2){var $3=$0[$2];if($3.get_isBvdPage()||this.$1_0.$6.$5($3)){continue;}$p0.add($3);this.$1_2($p0,$3);}},getThumbnailUrlInfo:function($p0,$p1){var $0=!this.$1_0.get_isOffline();if($p0===BvD.ReaderMode.images||$p0===BvD.ReaderMode.flash){if($0){return new BvD.ThumbnailUrlInfo('/getflashthumbnails/'+$p1+'/strip{1}.jpg',true);}else{return new BvD.ThumbnailUrlInfo('/getofflineflashthumbnails?pagexmlid={2}',false);}}else{if($0){return new BvD.ThumbnailUrlInfo('/gethtmlthumbnails/{0}.png',false);}else{var $1=CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($p1).get_versions().htmlthumb.toString();return new BvD.ThumbnailUrlInfo('/getofflinehtmlthumbnails/{2}.png?offline='+$1,false);}}}}
CourseSmartReader.CReader$1B=function(json){this.$0=[];try{if(!String.isNullOrEmpty(json)){this.$0=$.parseJSON(json);}}catch($0){BvD.ClientSideError.send('[SharingNoteUsers] Constructor',$0);}}
CourseSmartReader.CReader$1B.prototype={$0:null,$1:function($p0){for(var $0=0;$0<this.$0.length;++$0){var $1=this.$0[$0];if($1.userid===$p0){return $1;}}return null;},get_$2:function(){return this.$0.length;}}
CourseSmartReader._WebApp=function(smartReaderUI){this.$0=smartReaderUI;if(!CourseSmartReader._WebApp.$7()){return;}this.$3();this.$4();}
CourseSmartReader._WebApp.$2=function($p0){if(!CourseSmartReader._WebApp.$7()||$p0==null||!$p0.length||$p0.attr('data-hammered')!=null){return;}CourseSmartReader._WebApp.$6($p0);$p0.attr('data-hammered','true');}
CourseSmartReader._WebApp.$6=function($p0){$p0.onGesture('drag',function($p1_0){
if($p1_0.get_pointerType()===BvD.PointerType.touch){$p0[0].scrollTop-=$p1_0.get_distanceY();$p0[0].scrollLeft-=$p1_0.get_distanceX();}});}
CourseSmartReader._WebApp.$7=function(){var $0=$('#smartviewer');return $0!=null&&$0.attr('data-webappenabled')==='1'&&BvD.Pointer.get_isTouchEnabled();}
CourseSmartReader._WebApp.$8=function(){return CourseSmartReader._WebApp.$9('overflow-scrolling')||CourseSmartReader._WebApp.$9('-webkit-overflow-scrolling')||CourseSmartReader._WebApp.$9('-moz-overflow-scrolling')||CourseSmartReader._WebApp.$9('-o-overflow-scrolling');}
CourseSmartReader._WebApp.$9=function($p0){if(window.self.getComputedStyle!=null){return (window.self.getComputedStyle(document.body,null))[$p0]!=null;}else{return document.body.currentStyle[$p0]!=null;}}
CourseSmartReader._WebApp.prototype={$0:null,$1:null,$3:function(){this.$1=(this.$0.$3.get_$3A()==null||!this.$0.$3.get_$3A().length)?this.$0.$3.get_$39():this.$0.$3.get_$3A();if(this.$1==null||!this.$1.length){return;}if(this.$0.$2.$0.get_mode()===BvD.ReaderMode.html&&this.$0.$2.$1.useHtmlIFrame){BvD.IFrameProxy.of('#HtmlView').onGesture('swipe',ss.Delegate.create(this,function($p1_0){
if($p1_0.get_pointerType()===BvD.PointerType.touch){if($p1_0.get_direction()===BvD.GestureDirection.left){this.$0.$2.$0.next();}else if($p1_0.get_direction()===BvD.GestureDirection.right){this.$0.$2.$0.previous();}}})).onGesture('transform',ss.Delegate.create(this,function($p1_0){
if($p1_0.get_pointerType()===BvD.PointerType.touch){var $1_0=this.$0.$2.$0.get_zoomLevel();$1_0*=$p1_0.get_scale();this.$0.$2.$0.set_zoomLevel($1_0);}}));}},$4:function(){CourseSmartReader._WebApp.$6($('#SearchReader'));},$5:function(){if(CourseSmartReader._WebApp.$7()){CourseSmartReader._WebApp.$6($('#toc-root-container'));}}}
CourseSmartReader.CReader$29=function(domElm,text){CourseSmartReader.CReader$29.initializeBase(this,['CopyModal',CourseSmartReader.CReader$29.$1_1(domElm)]);this.add_onLoad(ss.Delegate.create(this,this.$1_2));this.$1_0=text;}
CourseSmartReader.CReader$29.$1_1=function($p0){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(390);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.staticId='CopyModalLayer';return $0;}
CourseSmartReader.CReader$29.prototype={$1_0:null,$1_2:function($p0,$p1){this.get_rootElement().find('#textcopy').val(this.$1_0);}}
CourseSmartReader.CReader$2B=function(domElm,note,sharingNoteUser){CourseSmartReader.CReader$2B.initializeBase(this,['HighlightModal',CourseSmartReader.CReader$2B.$1_5(domElm)]);this.$1_0=note;this.$1_1=sharingNoteUser;this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_6));}
CourseSmartReader.CReader$2B.$1_5=function($p0){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(560);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.staticId='HighlightModalLayer';return $0;}
CourseSmartReader.CReader$2B.prototype={$1_0:null,$1_1:null,get_$1_2:function(){return this.$1_0;},add_$1_3:function($p0){this.$1_4=ss.Delegate.combine(this.$1_4,$p0);},remove_$1_3:function($p0){this.$1_4=ss.Delegate.remove(this.$1_4,$p0);},$1_4:null,$1_6:function($p0,$p1){CourseSmartReader._Layers.$2(this.get_rootElement());var $0=this.get_rootElement();$0.find('#highlight-delete').on('click',ss.Delegate.create(this,this.$1_7));$0.find('#textcopy').val(CourseSmartReader.CReader$24.$1_6(this.$1_0.id));if(this.$1_1!=null){$0.find('#highlight-delete').hide();}},$1_7:function($p0){$p0.preventDefault();if(this.$1_4!=null){try{this.$1_4(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[HighlightLayer]',$0);}}this.close();}}
CourseSmartReader._Layers=function(){}
CourseSmartReader._Layers.$1=function($p0){return (window.screen.width>320)?$p0:320;}
CourseSmartReader._Layers.$2=function($p0){var $0=$p0.find('.modal');if($0.length>0&&$0.attr('data-hammer')==='true'){CourseSmartReader._WebApp.$2($p0);}}
CourseSmartReader.CReader$1F=function(domElm,noteId,title,comment,currentNoteData,selection,type,sharingNoteUser,allowStopViewing){CourseSmartReader.CReader$1F.initializeBase(this,['NoteModal',CourseSmartReader.CReader$1F.$1_18(domElm)]);this.$1_0=noteId;this.$1_1=title||'';this.$1_2=comment||'';this.$1_5=currentNoteData;this.$1_6=selection;this.$1_7=type;this.$1_8=sharingNoteUser;this.$1_9=allowStopViewing;this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_19));this.add_closed(ss.Delegate.create(this,this.$1_1B));}
CourseSmartReader.CReader$1F.$1_18=function($p0){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(560);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.staticId='NoteModalLayer';return $0;}
CourseSmartReader.CReader$1F.prototype={$1_0:0,$1_1:null,$1_2:null,$1_3:null,$1_4:false,$1_5:null,$1_6:null,$1_7:0,$1_8:null,$1_9:false,get_$1_A:function(){return this.$1_0;},get_$1_B:function(){return this.$1_1;},get_$1_C:function(){return this.$1_2;},get_$1_D:function(){return this.$1_5;},get_$1_E:function(){return this.$1_6;},get_$1_F:function(){return this.$1_7;},get_$1_10:function(){return this.$1_8;},get_$1_11:function(){return this.$1_9;},add_$1_12:function($p0){this.$1_13=ss.Delegate.combine(this.$1_13,$p0);},remove_$1_12:function($p0){this.$1_13=ss.Delegate.remove(this.$1_13,$p0);},$1_13:null,add_$1_14:function($p0){this.$1_15=ss.Delegate.combine(this.$1_15,$p0);},remove_$1_14:function($p0){this.$1_15=ss.Delegate.remove(this.$1_15,$p0);},$1_15:null,add_$1_16:function($p0){this.$1_17=ss.Delegate.combine(this.$1_17,$p0);},remove_$1_16:function($p0){this.$1_17=ss.Delegate.remove(this.$1_17,$p0);},$1_17:null,$1_19:function($p0,$p1){CourseSmartReader._Layers.$2(this.get_rootElement());var $0=this.get_rootElement();var $1=this.$1_8!=null;if($1){$0.find('#note-close').show();$0.find('#noteeditboxes,#deletenote,#note-save,#note-cancel').hide();if(this.$1_5.isHighlightOnly){$0.find('#nonote').show();}else{$0.find('#notereadonly').show();$0.find('#notereadonlytitle').html(this.$1_1);$0.find('#notereadonlycontent').html(CourseSmartReader.CReader$F.$4(this.$1_2||''));}if(this.$1_9){$0.find('#sharednoteuser').show();var $2;if(this.$1_8.accountrole==='Instructor'){$2='Professor '+this.$1_8.lastname;}else{$2=this.$1_8.firstname+' '+this.$1_8.lastname;}$0.find('#sharednoteusername').html($2);$0.find('#stopviewingbtn').on('click',ss.Delegate.create(this,this.$1_1D));}}else{$0.find('#note-close').hide();if(!BvD.Browser.isAndroid&&!BvD.Browser.isIPhone&&!BvD.Browser.isIpod&&!BvD.Browser.isIPad){this.$1_3=new CourseSmartReader.CReader$A(this.get_rootElement().find('#notecomment'),'html, body { padding: 3px; font-size: 13px; font-family: Lucida Sans Unicode, Lucida Grande, sans-serif; background-color: #FFF;  }',$1);this.$1_3.$5(this.$1_2);this.$1_3.add_$3(ss.Delegate.create(this,this.$1_1A));}else{var $3=CourseSmartReader.CReader$F.$4(this.$1_2||'');$0.find('#notecomment').val($3);}$0.find('#note-save').on('click',ss.Delegate.create(this,this.$1_1C)).closest('form').on('submit',ss.Delegate.create(this,this.$1_1C)).find('#notetag').val(this.$1_1);if(this.$1_0!==-1&&this.$1_5.type===BvD.NoteType.page){$0.find('#deletenote').css('display','inline').on('click',ss.Delegate.create(this,this.$1_1F));}}},$1_1A:function($p0){if($p0.which!==9){return;}$p0.preventDefault();if($p0.shiftKey){$('a[data-command=indent]').focus();}else{$('#note-save').focus();}},$1_1B:function($p0,$p1){this.$1_4=false;},$1_1C:function($p0){$p0.preventDefault();if(this.$1_4){this.$1_4=true;}this.$1_2=(this.$1_3!=null)?this.$1_3.$6():this.get_rootElement().find('#notecomment').val();if(!String.isNullOrEmpty(this.$1_2)){this.$1_2=this.$1_2.replaceAll('http://','http ://');}this.$1_1=this.get_rootElement().find('#notetag').val();if(this.$1_13!=null){try{this.$1_13(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[NoteLayer]',$0);}}if(BvD.Browser.isIE){this.get_rootElement().find('#page-jump').select();}},$1_1D:function($p0){$p0.preventDefault();if(this.$1_17!=null){try{this.$1_17(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[NoteLayer]',$0);}}this.close();},$1_1E:function($p0,$p1){this.$1_4=false;if($p0){this.close();return;}this.get_rootElement().find('#ErrorList').show();if($p1==null){this.get_rootElement().find('#GeneralError').show();return;}var $0=this.get_rootElement().find('#ErrorDescriptions').show();$0.html('');var $1=$p1.childNodes;var $2=$1.length;for(var $7=0;$7<$2;++$7){var $8=$('<div></div>').addClass('error');var $9=$1[$7];for(var $A=0;$A<$9.childNodes.length;++$A){var $B=$9.childNodes[$A];if($B.nodeName.toLowerCase()==='description'){if(!String.isNullOrEmpty($B.text)){$8.append(document.createTextNode($B.text));}else{$8.append(document.createTextNode($($B).text()));}}}$0.append($8);}var $3=this.get_rootElement().find('#notecomment');var $4=this.get_rootElement().find('#notetag');var $5=this.get_rootElement().find('label[for=notecomment] > span');var $6=this.get_rootElement().find('label[for=notetag] > span');$5.removeClass('error');$6.removeClass('error');$3.next().remove();$3.next().remove();$4.next().remove();$4.next().remove();if(String.isNullOrEmpty($3.val())){this.get_rootElement().find('label[for=notecomment] > span').addClass('error');$3.after('<br/><span class="error">Required field</span>');$3.focus();}if(String.isNullOrEmpty($4.val())){this.get_rootElement().find('label[for=notetag] > span').addClass('error');$4.after('<br/><span class="error">Required field</span>');$4.focus();}},$1_1F:function($p0){$p0.preventDefault();if(this.$1_4){return;}this.$1_4=true;if(this.$1_15!=null){try{this.$1_15(this,ss.EventArgs.Empty);}catch($0){BvD.ClientSideError.send('[NoteLayer]',$0);}}this.$1_4=false;this.close();}}
CourseSmartReader.CReader$27=function(domElm,pageNo){CourseSmartReader.CReader$27.initializeBase(this,['PageErrorModal',CourseSmartReader.CReader$27.$1_1(domElm,pageNo)]);this.$1_0=pageNo;this.add_onLoad(ss.Delegate.create(this,this.$1_2));}
CourseSmartReader.CReader$27.$1_1=function($p0,$p1){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(320);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.staticId='PageErrorModalLayer';$0.domObj=$p0;return $0;}
CourseSmartReader.CReader$27.prototype={$1_0:null,$1_2:function($p0,$p1){this.get_rootElement().find('#pageno').html(this.$1_0);}}
CourseSmartReader.CReader$28=function(domElm,pageNo){CourseSmartReader.CReader$28.initializeBase(this,['PageUnavailableModal',CourseSmartReader.CReader$28.$1_1(domElm,pageNo)]);this.$1_0=pageNo;this.add_onLoad(ss.Delegate.create(this,this.$1_2));}
CourseSmartReader.CReader$28.$1_1=function($p0,$p1){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(350);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.staticId='PageUnavailableModalLayer';$0.domObj=$p0;return $0;}
CourseSmartReader.CReader$28.prototype={$1_0:null,$1_2:function($p0,$p1){this.get_rootElement().find('#pageno').html(this.$1_0);}}
CourseSmartReader.CReader$25=function(domElm,xmlid,startingPage){CourseSmartReader.CReader$25.initializeBase(this,['PrintModal',CourseSmartReader.CReader$25.$1_7(domElm,xmlid)]);this.set_$1_3(startingPage);this.set_$1_4(1);this.add_loadedOrUpdated(ss.Delegate.create(this,this.$1_8));this.add_onUpdate(ss.Delegate.create(this,this.$1_9));}
CourseSmartReader.CReader$25.$1_7=function($p0,$p1){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(450);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.className='PrintPopup';$0.domObj=$p0;$0.urlParameter.set('xmlid',$p1);return $0;}
CourseSmartReader.CReader$25.prototype={$1_0:false,$1_1:null,$1_2:0,get_$1_3:function(){return this.$1_1;},set_$1_3:function($p0){this.$1_1=$p0;return $p0;},get_$1_4:function(){return this.$1_2;},set_$1_4:function($p0){this.$1_2=$p0;return $p0;},add_$1_5:function($p0){this.$1_6=ss.Delegate.combine(this.$1_6,$p0);},remove_$1_5:function($p0){this.$1_6=ss.Delegate.remove(this.$1_6,$p0);},$1_6:null,$1_8:function($p0,$p1){CourseSmartReader._Layers.$2(this.get_rootElement());this.get_rootElement().find('#startingpage').val(this.get_$1_3()).focus().select();var $0=this.get_rootElement().find('#print-submit');var $1=$0.closest('form').on('submit',ss.Delegate.create(this,this.$1_A));$0.on('click',function($p1_0){
$p1_0.preventDefault();$1.submit();});},$1_9:function($p0,$p1){var $0=this.get_rootElement();this.set_$1_3($0.find('#startingpage').val());if($0.find('#printcheckok').val()==='true'){this.set_$1_4(BvD.MathUtils.parseInt32($0.find('#pagestoprint').val(),1));if(this.$1_6!=null){try{this.$1_6(this,ss.EventArgs.Empty);}catch($1){BvD.ClientSideError.send('[PrintLayer] Update',$1);}}}},$1_A:function($p0){if(this.$1_0){return;}this.$1_0=true;$p0.preventDefault();var $0=BvD.Form.extractInfo($p0.currentTarget);this.call($0.query,null,true);this.$1_0=false;}}
CourseSmartReader.CReader$26=function(domElm,xmlid){CourseSmartReader.CReader$26.initializeBase(this,['ShareModal',CourseSmartReader.CReader$26.$1_2(domElm,xmlid)]);this.add_onLoad(ss.Delegate.create(this,this.$1_3));this.add_onUpdate(ss.Delegate.create(this,this.$1_4));this.$1_0=xmlid;}
CourseSmartReader.CReader$26.$1_2=function($p0,$p1){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(560);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.className='sharepopup';$0.urlParameter.set('xmlid',$p1);return $0;}
CourseSmartReader.CReader$26.prototype={$1_0:null,$1_1:false,$1_3:function($p0,$p1){this.$1_5(false);},$1_4:function($p0,$p1){this.$1_5(true);},$1_5:function($p0){var $0=this.get_rootElement();CourseSmartReader._Layers.$2($0);var $1=$0.find('#share-submit');var $2=$1.closest('form');$2.on('submit',ss.Delegate.create(this,this.$1_7));$1.on('click',function($p1_0){
$p1_0.preventDefault();$2.submit();});if($0.find('#ShareNotesContainer').attr('data-setpasscode')==='1'){this.$1_E(null);}$0.find('#ShareLinkUrl,#ShareNotesUrl').on('focus',ss.Delegate.create(this,this.$1_8)).on('mouseup',function($p1_0){
$p1_0.preventDefault();});$0.find('#ShareLinkTab,#ShareEmailTab,#ShareNotesTab').on('click',ss.Delegate.create(this,this.$1_9));$0.find('#StartSharingNotes').on('click',ss.Delegate.create(this,this.$1_B));$0.find('#stopsharing,#cancelstopsharing').on('click',ss.Delegate.create(this,this.$1_C));$0.find('#confirmstopsharing').on('click',ss.Delegate.create(this,this.$1_D));$0.find('#setpasscode,#changepasscode').on('click',ss.Delegate.create(this,this.$1_E));$0.find('#savepasscode').on('click',ss.Delegate.create(this,this.$1_10));$0.find('#cancelpasscode').on('click',ss.Delegate.create(this,this.$1_F));this.$1_A(this.$1_6());if(!$p0){$0.find('#sharelinkmenu li.active a').focus();}},$1_6:function(){var $0=this.get_rootElement().find('#sharelinkmenu');var $1=$0.find('ul li.active');if($1.length>0){return $1;}return $0.find('ul li').eq(0);},$1_7:function($p0){$p0.preventDefault();if(this.$1_1){return;}this.$1_1=true;var $0=BvD.Form.extractInfo($p0.currentTarget);this.call($0.query.set('__shareaction','email'),null,true);this.$1_1=false;},$1_8:function($p0){$p0.preventDefault();$($p0.currentTarget).select();},$1_9:function($p0){$p0.preventDefault();this.$1_A($($p0.currentTarget).closest('li'));this.get_rootElement().find('.errorBlock').hide();},$1_A:function($p0){if(!$p0.length){return;}var $0=this.get_rootElement();var $1=$0.find('#ShareLinkTab');var $2=$0.find('#ShareLinkContainer');var $3=$0.find('#ShareEmailTab');var $4=$0.find('#ShareEmailContainer');var $5=$0.find('#ShareNotesTab');var $6=$0.find('#ShareNotesContainer');switch($p0[0].id){case 'ShareEmailTab':$1.add($5).removeClass('active').find('.hidden_link_tab_text').addClass('dn');$2.add($6).hide();$3.addClass('active').find('.hidden_link_tab_text').removeClass('dn');$4.show();$0.find('#emailto').focus();break;case 'ShareLinkTab':$3.add($5).removeClass('active').find('.hidden_link_tab_text').addClass('dn');$4.add($6).hide();$1.addClass('active').find('.hidden_link_tab_text').removeClass('dn');$2.show();$0.find('#ShareLinkUrl').focus();break;case 'ShareNotesTab':$1.add($3).removeClass('active').find('.hidden_link_tab_text').addClass('dn');$2.add($4).hide();$5.addClass('active').find('.hidden_link_tab_text').removeClass('dn');$6.show();$0.find('.sharenotes-moreinfo').focus();break;}},$1_B:function($p0){$p0.preventDefault();$p0.stopPropagation();var $0=new BvD.QueryString().set('__shareaction','startsharingnotes').set('__sharexmlid',this.$1_0);this.call($0,null,true);},$1_C:function($p0){$p0.preventDefault();$p0.stopPropagation();var $0=this.get_rootElement();$0.find('#sharenotes1,#sharenotes2').toggle();$0.find('.sharenotes-moreinfo').focus();},$1_D:function($p0){$p0.preventDefault();$p0.stopPropagation();var $0=new BvD.QueryString().set('__shareaction','stopsharingnotes').set('__sharexmlid',this.$1_0);this.call($0,null,true);},$1_E:function($p0){if($p0!=null){$p0.preventDefault();$p0.stopPropagation();}var $0=this.get_rootElement();$0.find('#sharenotes-buttons2').hide();$0.find('#sharenotes-buttons3').show();$0.find('#notes-password').focus();},$1_F:function($p0){$p0.preventDefault();$p0.stopPropagation();var $0=this.get_rootElement();$0.find('#sharenotes-buttons2,#sharenotes-buttons3').toggle();$0.find('#notes-password').val(this.get_rootElement().find('#currentpasscode').val());$0.find('.sharenotes-moreinfo').focus();$0.find('.errorBlock').hide();},$1_10:function($p0){$p0.preventDefault();$p0.stopPropagation();var $0=this.get_rootElement();var $1=$0.find('#currentpasscode').html();var $2=$0.find('#notes-password').val();var $3=new BvD.QueryString().set('__shareaction','setpasscode').set('__shareoldpasscode',$1).set('__sharenewpasscode',$2).set('__sharexmlid',this.$1_0);this.call($3,null,true);}}
CourseSmartReader.CReader$2A=function(domElm,isbn){CourseSmartReader.CReader$2A.initializeBase(this,['AddBookModal',CourseSmartReader.CReader$2A.$1_0(domElm,isbn)]);}
CourseSmartReader.CReader$2A.$1_0=function($p0,$p1){var $0=new BvD.LayerConfig();$0.width=CourseSmartReader._Layers.$1(380);$0.destroyOnClose=true;$0.modalProperties=CourseSmartReader._Layers.$0;$0.domObj=$p0;$0.urlParameter.set('__addisbn',$p1);return $0;}
CourseSmartReader.CReader$7=function(){this.$0=$('#outline-content');this.$1=$('#smartviewer');this.$2=$('#htmlscroller');this.$3=$('#help-offline');this.$4=$('#OfflineHelp');this.$5=$('#bar-marketing-parent');this.$6=$('#btn-close-marketing-bar');this.$7=$((CourseSmartReader.CReader$F.get_$2())?'#zoom_in':'#btn-zoom-in');this.$8=$((CourseSmartReader.CReader$F.get_$2())?'#zoom_out':'#btn-zoom-out');this.$9=$('#btn-print');this.$A=$('#btn-share,#btn-sharenotes');this.$B=$('#btn-outline');this.$C=$('#btn-toc');this.$D=$('#btn-search');this.$E=$('#btn-pan');this.$F=$('#btn-view');this.$10=this.$F.next();this.$11=$('#page-submit').closest('form');var $0=$('.left-sidebar');this.$14=$0.filter('.toc');this.$15=$0.filter('.search');this.$16=$0.filter('.notes');this.$12=$('#page-submit');this.$13=$('#page-jump');this.$17=$('#readersearch').closest('form');this.$18=$('#tab-allresults');this.$19=$('#tab-thispage');this.$1A=$('#tab-thischapter');this.$1B=$('#readersearchfor');this.$1C=$('#outline-btn-toc');this.$1D=$('#outline-btn-mynotes');this.$1E=$('#outline-btn-bookmarks');this.$1F=$('#go-back-btn');this.$20=$('#outline-btn-incmaterial');this.$21=$('#outline-section-toc');this.$22=$('#outline-section-mynotes');this.$23=$('#outline-section-bookmarks');this.$24=$('#outline-section-incmaterial');this.$25=$('#rtoolbar');this.$26=$('#shownotesc');this.$27=$('#shownotesc_counter');this.$28=$('#shownotesc_label');this.$29=$('#cbookmarkpf');this.$2A=$('#allpagenotes');this.$2B=$('#bookmark-page');this.$2C=$('#addpagenotebut');this.$2D=$('#html-btn-prev,#btn-prev,#btn-508-prev');this.$2E=$('#html-btn-next,#btn-next,#btn-508-next');this.$2F=$('#pfv2_pagecontentdiv');this.$30=$('#rtoolbar');this.$31=$('#shownotesc');this.$32=$('#shownotesc_counter');this.$33=$('#shownotesc_label');this.$34=$('#cbookmarkpf');this.$35=$('#allpagenotes');this.$36=$('#bookmark-page');this.$37=$('#addpagenotebut');}
CourseSmartReader.CReader$7.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:null,$D:null,$E:null,$F:null,$10:null,$11:null,$12:null,$13:null,$14:null,$15:null,$16:null,$17:null,$18:null,$19:null,$1A:null,$1B:null,$1C:null,$1D:null,$1E:null,$1F:null,$20:null,$21:null,$22:null,$23:null,$24:null,$25:null,$26:null,$27:null,$28:null,$29:null,$2A:null,$2B:null,$2C:null,$2D:null,$2E:null,$2F:null,$30:null,$31:null,$32:null,$33:null,$34:null,$35:null,$36:null,$37:null,get_$38:function(){return this.$0;},get_$39:function(){return this.$1;},get_$3A:function(){return this.$2;},get_$3B:function(){return this.$3;},get_$3C:function(){return this.$4;},get_$3D:function(){return this.$5;},get_$3E:function(){return this.$6;},get_$3F:function(){return this.$7;},get_$40:function(){return this.$8;},get_$41:function(){return this.$9;},get_$42:function(){return this.$A;},get_$43:function(){return this.$B;},get_$44:function(){return this.$C;},get_$45:function(){return this.$D;},get_$46:function(){return this.$E;},get_$47:function(){return this.$F;},get_$48:function(){return this.$10;},get_$49:function(){return this.$11;},get_$4A:function(){return this.$12;},get_$4B:function(){return this.$13;},get_$4C:function(){return this.$14;},get_$4D:function(){return this.$15;},get_$4E:function(){return this.$16;},get_$4F:function(){return this.$17;},get_$50:function(){return this.$18;},get_$51:function(){return this.$19;},get_$52:function(){return this.$1A;},get_$53:function(){return this.$1B;},get_$54:function(){return this.$1C;},get_$55:function(){return this.$1D;},get_$56:function(){return this.$1E;},get_$57:function(){return this.$1F;},get_$58:function(){return this.$20;},get_$59:function(){return this.$21;},get_$5A:function(){return this.$22;},get_$5B:function(){return this.$23;},get_$5C:function(){return this.$24;},get_$5D:function(){return this.$25;},get_$5E:function(){return this.$26;},get_$5F:function(){return this.$27;},get_$60:function(){return this.$28;},get_$61:function(){return this.$29;},get_$62:function(){return this.$2A;},get_$63:function(){return this.$2B;},get_$64:function(){return this.$2C;},get_$65:function(){return this.$2D;},get_$66:function(){return this.$2E;},get_$67:function(){return this.$2F;},get_$68:function(){return $('#rtoolbar');},get_$69:function(){return $('#shownotesc');},get_$6A:function(){return $('#shownotesc_counter');},get_$6B:function(){return $('#toggleshared');},get_$6C:function(){return $('#shownotesc_label');},get_$6D:function(){return $('#cbookmarkpf');},get_$6E:function(){return $('#allpagenotes');},get_$6F:function(){return $('#bookmark-page');},get_$70:function(){return $('#addpagenotebut');}}
CourseSmartReader.CReader$8=function(smartReaderUI){this.$5=-1;this.$6=-1;if(smartReaderUI.$2.$0.get_mode()===BvD.ReaderMode.flash){return;}this.$2=smartReaderUI;this.$1=this.$2.$2;this.$0=this.$1.$0;this.$3=this.$2.$3;this.$3.get_$65().on('click',ss.Delegate.create(this,this.$13)).on('mousewheel DOMMouseScroll',ss.Delegate.create(this,this.$15));this.$3.get_$66().on('click',ss.Delegate.create(this,this.$14)).on('mousewheel DOMMouseScroll',ss.Delegate.create(this,this.$15));$(document).on('click','#btn-508-prev',ss.Delegate.create(this,this.$13));$(document).on('click','#btn-508-next',ss.Delegate.create(this,this.$14));if(this.$0.get_mode()===BvD.ReaderMode.images){this.$3.get_$39().onGesture('swipe',ss.Delegate.create(this,this.$E)).onGesture('transform',ss.Delegate.create(this,this.$10)).onGesture('tap',ss.Delegate.create(this,this.$11));if(!CourseSmartReader._WebApp.$8()){this.$3.get_$39().onGesture('drag',ss.Delegate.create(this,this.$F));}this.$3.get_$39().css('-ms-touch-action','none');this.$20();this.$21();this.$2A();}this.$0.add_pageLoaded(ss.Delegate.create(this,this.$1B));this.$0.add_zoomChanged(ss.Delegate.create(this,this.$1A));this.$0.add_grabChanged(ss.Delegate.create(this,this.$17));this.$0.add_grabStarted(ss.Delegate.create(this,this.$18));this.$0.add_grabEnded(ss.Delegate.create(this,this.$19));$(document).on('click','.add-bookshelf',ss.Delegate.create(this,this.$23));if(this.$0.get_mode()===BvD.ReaderMode.html&&this.$1.$1.useHtmlIFrame){$(document).on('resize',ss.Delegate.create(this,this.$12));$(window).on('orientationchange',ss.Delegate.create(this,this.$12));}}
CourseSmartReader.CReader$8.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$7:null,$8:false,$9:false,$A:false,$B:false,$C:function(){this.$A=!this.$A;this.$D();$('#togglesharedlabel').html((this.$A)?'Show':'Hide');},$D:function(){if(this.$0.get_mode()===BvD.ReaderMode.images){this.$3.get_$39().toggleClass('hide_shared_highlights',this.$A);}else if(this.$0.get_mode()===BvD.ReaderMode.html){BvD.IFrameProxy.getIFramesDocument('#HtmlView').find('body').toggleClass('hide_shared_highlights',this.$A);}},$E:function($p0){if($p0.get_pointerType()===BvD.PointerType.touch){if($p0.get_direction()===BvD.GestureDirection.left){this.$0.next();}else if($p0.get_direction()===BvD.GestureDirection.right){this.$0.previous();}}},$F:function($p0){if(!this.$B&&$p0.get_pointerType()===BvD.PointerType.touch){this.$3.get_$39()[0].scrollTop-=$p0.get_distanceY();this.$3.get_$39()[0].scrollLeft-=$p0.get_distanceX();}},$10:function($p0){if($p0.get_pointerType()===BvD.PointerType.touch){var $0=this.$2.$2.$0.get_zoomLevel();$0*=$p0.get_scale();this.$2.$2.$0.set_zoomLevel($0);}},$11:function($p0){if($p0.get_pointerType()===BvD.PointerType.touch){this.$0.get_selections().touchClearSelection();}},$12:function($p0){if(this.$0.get_mode()===BvD.ReaderMode.images){return;}if(this.$1.$1.useHtmlIFrame&&(BvD.Browser.isIPad||BvD.Browser.isIPhone)){var $0=BvD.IFrameProxy.getIFramesDocument('#HtmlView');if($0.length>0){BvD.Timer.setTimeout('BowSmartReaderUIContent',100,ss.Delegate.create(this,function(){
var $1_0=$('.htmlcontent');var $1_1=$1_0.width();var $1_2=$0.find('body');var $1_3=$1_2.outerWidth(true)-$1_2.width();$1_2.width($1_1-$1_3);this.$2.$6.$4();}));}}this.$2.$6.$4();},$13:function($p0){$p0.preventDefault();this.$0.previous();},$14:function($p0){$p0.preventDefault();this.$0.next();},$15:function($p0){$p0.preventDefault();var $0=BvD.Mouse.getWheelDelta($p0);if($0<0){this.$0.next();}else if($0>0){this.$0.previous();}},$16:function(){this.$1E();var $0=$('#forceviewid');if($0.length>0&&!!$0.val()){this.$0.set_view(parseInt($0.val(),10));}this.$12(null);},$17:function($p0,$p1){$('#PFView').toggleClass('grabon',this.$0.get_grab());},$18:function($p0,$p1){$('#PFView').addClass('grabdown');},$19:function($p0,$p1){$('#PFView').removeClass('grabdown');},$1A:function($p0,$p1){this.$1D();this.$1E();this.$1F();this.$12(null);},$1B:function($p0,$p1){if(this.$1.$1.useHtmlIFrame){this.$1C();}if(this.$9){this.$9=true;this.$16();}this.$1A($p0,$p1);this.$D();},$1C:function(){var $0=BvD.IFrameProxy.getIFramesDocument('#HtmlView').find('head');if($0.length>0){$0.append('<link type="text/css" rel="stylesheet" href="'+BvD.Utils.filePath('v5/smartreader_iframe.css')+'"/>');}},$1D:function(){if(this.$0.get_mode()===BvD.ReaderMode.html){return;}$('#PFView').removeClass('hideelem');var $0=this.$3.get_$67();var $1=$('#pfv2_gen');var $2=91;var $3=1;var $4=$0.css('width');var $5=$0.css('height');var $6=parseInt($4,10);var $7=parseInt($5,10);$1.css('width',($6+$2+$3)+'px').css('height',$5);$('#pfv2_sidebar').css('margin-left',$6+'px').css('height',$5);this.$3.get_$66().css('marginLeft',($6-23)+'px');var $8=this.$0.get_zoomLevel()/800;$8=Math.round($8*100)/100;var $9=300*$8;var $A=100*$8;var $B=$6>=$9&&$7>=$A;if($B){if(this.$5===-1||(this.$7!==this.$0.get_currentTocEntry().get_xmlId())){this.$7=this.$0.get_currentTocEntry().get_xmlId();this.$5=Math.random();this.$6=Math.random();}var $C=Math.max(0,this.$5*($6-$9));var $D=Math.max(0,this.$6*($7-$A));var $E={};$E['left']=$C+'px';$E['top']=$D+'px';$E['width']=$9+'px';$E['height']=$A+'px';this.$4.css($E).removeClass('hideelem');}else{this.$4.addClass('hideelem');}},$1E:function(){this.$3.get_$65().toggleClass('hideelem',this.$0.get_isFirstPage());this.$3.get_$66().toggleClass('hideelem',this.$0.get_isLastPage());},$1F:function(){if(this.$0.get_mode()===BvD.ReaderMode.html){return;}var $0=$('#selectiondiv').attr('data-preview')==='1';if($0&&!this.$8){this.$8=true;var $1=new BvD.QueryString().set('xmlid',this.$0.get_currentTocEntry().get_xmlId()).set('__called','1');BvD.Ajax.link($1,'pfv2_previewdest');}$('#pfv2_previewbox').toggleClass('hideelem',!$0);},$20:function(){$('<div></div>').attr('id','popupdivpf').attr('data-copy','1').attr('data-tap','false').addClass('pfv2_popupdivpf').appendTo('#pfcontent');},$21:function(){var $0={};$0['opacity']='0.2';$0['z-index']='1000';$0['position']='absolute';this.$4=$('<img/>').on('click touchstart contextmenu mousedown touchmove touchcancel',ss.Delegate.create(this,this.$22)).attr('alt','').attr('src','/UserWatermark?wmFormat=gif').addClass('hideelem').css($0).appendTo('#pfcontent');},$22:function($p0){$p0.preventDefault();},$23:function($p0){$p0.preventDefault();new CourseSmartReader.CReader$2A($p0.currentTarget,this.$1.$1.xmlId.xmlId).show();},$24:null,$25:null,$26:null,$27:null,$28:null,$29:false,$2A:function(){if(!CourseSmartReader._WebApp.$7()){return;}var $0=$('#smartviewer');this.$27=$('<div></div>').attr('id','lefttoucharrow').addClass('lefttoucharrow').addClass('hideelem').on('click contextmenu mousedown touchmove touchcancel',ss.Delegate.create(this,this.$22)).on('touchstart',ss.Delegate.create(this,this.$2D)).appendTo($0);this.$28=$('<div></div>').attr('id','righttoucharrow').addClass('righttoucharrow').addClass('hideelem').on('click contextmenu mousedown touchmove touchcancel',ss.Delegate.create(this,this.$22)).on('touchstart',ss.Delegate.create(this,this.$2D)).appendTo($0);this.$0.get_selections().add_selectionEnded(ss.Delegate.create(this,this.$2B));this.$0.get_selections().add_cleared(ss.Delegate.create(this,this.$2C));},$2B:function($p0,$p1){if($p1==null){return;}var $0=$p1.positionStart;var $1=$p1.positionEnd;var $2=Math.round(this.$27.width()/2);var $3=new BvD.Position($0.left-$2,$0.top);var $4=new BvD.Position($1.left-$2,$1.top);this.$30(true);this.$27.css('left','').css('top','').offset($3.tojQueryPosition());this.$28.css('left','').css('top','').offset($4.tojQueryPosition());},$2C:function($p0,$p1){this.$30(false);},$2D:function($p0){$p0.preventDefault();this.$B=true;this.$26=$($p0.currentTarget);this.$29=this.$26.attr('id')==='lefttoucharrow';var $0=this.$26.offset();this.$25=new BvD.Position($0.left,$0.top);this.$24=BvD.Touch.jQueryGetPosition($p0,BvD.PointerPositionType.page);$(document).on('touchmove.csreader',ss.Delegate.create(this,this.$2F)).on('touchend.csreader',ss.Delegate.create(this,this.$2E));},$2E:function($p0){$p0.preventDefault();this.$B=false;this.$0.get_selections().touchStopMoving();$(document).off('touchmove.csreader touchend.csreader');},$2F:function($p0){$p0.preventDefault();var $0=BvD.Touch.jQueryGetPosition($p0,BvD.PointerPositionType.page);var $1=$0.left-this.$24.left;var $2=$0.top-this.$24.top;var $3=this.$25.left+$1;var $4=this.$25.top+$2;this.$26.offset(new BvD.Position($3,$4).tojQueryPosition());this.$0.get_selections().touchMoveSelection(new BvD.Position($3,$4),this.$29);},$30:function($p0){if($p0){this.$27.removeClass('hideelem');this.$28.removeClass('hideelem');}else{this.$27.addClass('hideelem');this.$28.addClass('hideelem');}}}
CourseSmartReader.CReader$A=function(textArea,contentCss,isReadOnly){var $0=textArea.attr('id');var $1=$0;textArea.attr('id',$0+'__source');this.$0=$('<iframe></iframe>').attr('id',$1).attr('name',$1).attr('title','Note').attr('marginWidth','0').attr('marginHeight','0').attr('frameBorder','0').attr('border','0').attr('leftMargin','0').attr('topMargin','0').attr('allowtransparency','false').attr('scrolling','auto').addClass('htmleditor');$('[for='+$0+']').on('click',ss.Delegate.create(this,function($p1_0){
this.$0.focus();}));this.$2=$(null);var $2=textArea.attr('class');if(!String.isNullOrEmpty($2)){var $F=$2.split(' ');for(var $10=0;$10<$F.length;++$10){this.$0.addClass($F[$10]);}}this.$0.insertBefore(textArea);textArea.hide();if(!isReadOnly){this.$0.prop('contentEditable',true);}this.$1=this.$0[0].contentWindow.document;if(!isReadOnly){this.$1.designMode='on';}this.$1.open();this.$1.write('<html id="'+$1+'"><head></head><body></body></html>');this.$1.close();var $3=this.$1.getElementsByTagName('head')[0];var $4=document.createElement('style');$4.setAttribute('type','text/css');var $5=$4.styleSheet;if($5!=null){$5.cssText=contentCss;}else{$4.appendChild(document.createTextNode(contentCss));}$3.appendChild($4);this.$5(textArea.val());var $6=$('a[data-command]');var $7=$6.length;for(var $11=0;$11<$7;++$11){var $12=$6.eq($11);var $13=$12.attr('data-command');if(!String.isNullOrEmpty($13)){this.$2=this.$2.add($12);$12.on('click',ss.Delegate.create(this,this.$8));}}var $8=this.$0[0].contentWindow;var $9=$8.document;var $A=$($8);var $B=$($9);var $C=$($9.activeElement);var $D=ss.Delegate.create(this,function($p1_0){
this.$A();});var $E=ss.Delegate.create(this,function($p1_0){
this.$9();});$A.on('click focus',$D);this.$0.on('click',$E);$A.on('click',$E);$B.on('click',$E);$C.on('click',$E);$B.on('click',$D);$(this.$1.body).keypress(ss.Delegate.create(this,this.$B));}
CourseSmartReader.CReader$A.prototype={$0:null,$1:null,$2:null,add_$3:function($p0){this.$4=ss.Delegate.combine(this.$4,$p0);},remove_$3:function($p0){this.$4=ss.Delegate.remove(this.$4,$p0);},$4:null,$5:function($p0){if(!String.isNullOrEmpty($p0)){var $0=this.$1.getElementsByTagName('body')[0];$0.innerHTML=CourseSmartReader._BBCode.$2($p0);}},$6:function(){var $0=this.$1.getElementsByTagName('body')[0];var $1=$0.innerHTML;var $2=CourseSmartReader._BBCode.$1($1);if($2==='[br]'){return '';}return $2;},$7:function($p0){var $0=$p0.which;var $1=$p0.ctrlKey;var $2=$p0.altKey;var $3=$p0.shiftKey;if($2||!$1){return;}var $4=null;switch($0){case 98:$4='bold';break;case 105:$4='italic';break;case 117:$4='underline';break;case 100:$4='strikethrough';break;case 43:if($3){$4='superscript';}break;case 61:if($3){$4='superscript';}else{$4='subscript';}break;case 32:$4='removeformat';break;case 101:if(this.$2.filter('.command-justifycenter').hasClass('active')){$4='justifyleft';}else{$4='justifycenter';}break;case 114:if(this.$2.filter('.command-justifyright').hasClass('active')){$4='justifyleft';}else{$4='justifyright';}break;case 106:if(this.$2.filter('.command-justifyleft').hasClass('active')){$4='justifyleft';}else{$4='justifyfull';}break;case 109:if($3){$4='outdent';}else{$4='indent';}break;}if($4!=null){$p0.preventDefault();this.$2.filter('.command-'+$4).trigger('click');}},$8:function($p0){$p0.preventDefault();var $0=$($p0.currentTarget);if(!$0.is('a[data-command]')){$0=$0.closest('a[data-command]');}var $1=$0.attr('data-command');var $2=$0.attr('data-param');this.$9();this.$1.execCommand($1,false,$2);this.$9();this.$A();},$9:function(){this.$0.focus();this.$0[0].contentWindow.document.body.focus();},$A:function(){var $0=this.$2.length;for(var $1=0;$1<$0;++$1){var $2=this.$2.eq($1);try{if(this.$1.queryCommandState($2.attr('data-command'))){$2.addClass('active');}else{$2.removeClass('active');}}catch($3){$2.removeClass('active');}}},$B:function($p0){if(this.$4!=null){this.$4($p0);}}}
CourseSmartReader.CReader$9=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$1.$3;this.$2.get_$59().data('dataObject',this.$1.$C);this.$2.get_$5A().data('dataObject',this.$1.$D);this.$2.get_$5B().data('dataObject',this.$1.$E);this.$2.get_$57().on('click',ss.Delegate.create(this,this.$A));this.$2.get_$54().on('click',ss.Delegate.create(this,this.$B));if(this.$0.$3.get_$1_3()){this.$2.get_$55().on('click',ss.Delegate.create(this,this.$C));}else{this.$2.get_$55().hide();}if(this.$0.$4.get_$1_2()){this.$2.get_$56().on('click',ss.Delegate.create(this,this.$D));}else{this.$2.get_$56().hide();}this.$2.get_$58().on('click',ss.Delegate.create(this,this.$E));this.$4=this.$2.get_$54();this.$3=this.$2.get_$59();}
CourseSmartReader.CReader$9.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:false,$6:false,$7:function(){if(!this.$5&&this.$3!=null){this.$5=true;this.$3.show();this.$4.addClass('active');var $0=this.$3.data('dataObject');if($0!=null){($0).show();}}},$8:function(){if(this.$5&&this.$3!=null){this.$5=false;this.$3.hide();this.$4.removeClass('active');var $0=this.$3.data('dataObject');if($0!=null){($0).hide();}}},$9:function($p0,$p1){this.$8();this.$3=$p1;this.$4=$p0;this.$7();},$A:function($p0){$p0.preventDefault();this.$1.$1E(0);},$B:function($p0){$p0.preventDefault();this.$9(this.$2.get_$54(),this.$2.get_$59());},$C:function($p0){$p0.preventDefault();this.$9(this.$2.get_$55(),this.$2.get_$5A());},$D:function($p0){$p0.preventDefault();this.$9(this.$2.get_$56(),this.$2.get_$5B());},$E:function($p0){$p0.preventDefault();if(!this.$6){this.$6=true;BvD.Ajax.link(null,'aciscompanion');}this.$9(this.$2.get_$58(),this.$2.get_$5C());}}
CourseSmartReader.CReader$4=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$3=this.$1.$3;if(this.$0.get_isOffline()||CourseSmartReader.CReader$F.get_$2()||this.$2.get_mode()===BvD.ReaderMode.html){this.$7=false;}this.$4=$('<ul></ul>').addClass((this.$7)?'bookmarks2':'bookmarks').on('click','a[data-bookmark-id]',ss.Delegate.create(this,this.$A)).on('click','a[data-bookmark-xmlid]',ss.Delegate.create(this,this.$B));this.$2.get_bookmarks().add_collectionChanged(ss.Delegate.create(this,this.$8));}
CourseSmartReader.CReader$4.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:true,$6:false,$7:true,show:function(){this.$6=true;if(this.$5){this.$9();}},hide:function(){this.$6=false;},$8:function($p0,$p1){if(this.$6){this.$9();}else{this.$5=true;}},$9:function(){this.$5=false;this.$4.detach();this.$4.html('');var $0=this.$0.$4.$1_4();var $1=$0.length;for(var $2=0;$2<$1;++$2){if(this.$7){this.$4.append(this.$C($0[$2]));}else{this.$4.append(this.$D($0[$2]));}}this.$4.appendTo(this.$3.get_$5B());},$A:function($p0){$p0.preventDefault();this.$2.get_bookmarks().remove(BvD.MathUtils.parseInt32($($p0.currentTarget).attr('data-bookmark-id'),0));},$B:function($p0){$p0.preventDefault();this.$2.goTo($($p0.currentTarget).attr('data-bookmark-xmlid'));this.$1.$1E(0);},$C:function($p0){var $0=this.$2.get_tableOfContents().getByXmlId($p0.xmlId);if($0==null){return null;}var $1=$('<li></li>');$('<span></span>').addClass('label').append(document.createTextNode($0.get_title())).appendTo($1);var $2=$p0.utcDateTime;$('<span></span>').addClass('date').append(document.createTextNode(($2.getMonth()+1)+'/'+$2.getDate()+'/'+$2.getFullYear())).appendTo($1);var $3=$('<a></a>').addClass('thumbnail').attr('data-bookmark-xmlid',$p0.xmlId).attr('href','/'+$p0.xmlId).attr('title',BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($0.get_title())).append($('<span></span>').attr('style',this.$2.get_thumbnails().getThumbnailStyle($p0.xmlId))).appendTo($1);$('<a></a>').addClass('delete').attr('href','#').attr('title','Delete').attr('data-bookmark-id',$p0.id.toString()).append(document.createTextNode('Delete')).append($('<span></span>').addClass('icon')).appendTo($1);return $1;},$D:function($p0){var $0=this.$2.get_tableOfContents().getByXmlId($p0.xmlId);if($0==null){return null;}var $1=$('<li></li>');var $2=$('<a></a>').addClass('fr').addClass('delete').attr('title','Delete').append(document.createTextNode('Delete'));$1.append($2);if(!this.$0.$6.$5($0)){$2.attr('data-bookmark-id',$p0.id.toString());}else{$1.addClass('unavailable');}var $3=$p0.utcDateTime;var $4=$('<span></span>').addClass('date').addClass('fr').append(document.createTextNode(($3.getMonth()+1)+'/'+$3.getDate()+'/'+$3.getFullYear()));$1.append($4);$2=$('<a></a>').attr('title',BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($0.get_title())).append(document.createTextNode($0.get_title()));$1.append($2);if(!this.$0.$6.$5($0)){$2.attr('data-bookmark-xmlid',$p0.xmlId).attr('href','/'+$p0.xmlId);}return $1;}}
CourseSmartReader.CReader$5=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$11=$('#print-notes');this.$12=$('#show-notes');if(BvD.Browser.isAndroid){$('#outline-notes-print').hide();}$('#lnk-print-notes').on('click',function($p1_0){
$p1_0.preventDefault();window.print();});$('#chk-highlights,#chk-highlightsandnotes,#chk-notes,#chk-allnotes,#chk-mynotes,#chk-sharednotes').on('change',ss.Delegate.create(this,function($p1_0){
this.$13(this,ss.EventArgs.Empty);}));$('#chk-booktitle').on('change',ss.Delegate.create(this,function($p1_0){
this.$B=$($p1_0.currentTarget).prop('checked');this.$11.find('.book-title').toggle(this.$B);}));$('#chk-notetitle').on('change',ss.Delegate.create(this,function($p1_0){
this.$C=$($p1_0.currentTarget).prop('checked');this.$11.find('.note-title').toggle(this.$C);}));$('#chk-date').on('change',ss.Delegate.create(this,function($p1_0){
this.$D=$($p1_0.currentTarget).prop('checked');this.$11.find('.note-date').toggle(this.$D);}));$('#chk-notelocation').on('change',ss.Delegate.create(this,function($p1_0){
this.$E=$($p1_0.currentTarget).prop('checked');this.$11.find('.note-location').toggle(this.$E);}));$('#chk-notetext').on('change',ss.Delegate.create(this,function($p1_0){
this.$F=$($p1_0.currentTarget).prop('checked');this.$11.find('.note-text').toggle(this.$F);}));$('#chk-highlight').on('change',ss.Delegate.create(this,function($p1_0){
this.$10=$($p1_0.currentTarget).prop('checked');this.$11.find('.note-highlight').toggle(this.$10);}));this.$2.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$13));}
CourseSmartReader.CReader$5.prototype={$0:null,$1:null,$2:null,$3:false,$4:true,$5:false,$6:false,$7:false,$8:true,$9:false,$A:false,$B:true,$C:true,$D:true,$E:true,$F:true,$10:true,$11:null,$12:null,show:function(){this.$3=true;if(this.$4){this.$14();}},hide:function(){this.$3=false;},$13:function($p0,$p1){if(this.$3){this.$14();}else{this.$4=true;}},$14:function(){this.$4=false;this.$12.html('');this.$11.html('');var $0=this.$0.$3.$1_E();$('#sharednotesfilters').hide();this.$5=$('#chk-highlights').prop('checked');this.$6=$('#chk-highlightsandnotes').prop('checked');this.$7=$('#chk-notes').prop('checked');this.$8=$('#chk-allnotes').prop('checked');this.$9=$('#chk-mynotes').prop('checked');this.$A=$('#chk-sharednotes').prop('checked');var $1=$('<ul></ul>').addClass('my-notes');var $2=null;var $3=null;var $4=null;var $5=null;var $6=null;var $7=$0.length;for(var $8=0;$8<$7;++$8){var $9=$0[$8];if($9.xmlId===$6){continue;}$6=$9.xmlId;var $A=this.$0.$6.$6(this.$2.get_tableOfContents().getByXmlId($9.xmlId));if($A==null){$A=this.$2.get_tableOfContents().get_root();}if($5==null||$5!==$A.get_xmlId()){$5=$A.get_xmlId();$4=null;}$4=this.$15($A,(($A.get_isRoot())?this.$2.get_notes().getOrphanNotes():this.$2.get_notes().getNotesOnXmlId($9.xmlId)),$4);if($4!=null){var $B=this.$0.$6.$7($A);if($B===$A){$1.append($('<li></li>').append($4));continue;}if($3==null||$B.get_xmlId()!==$3){var $C=$('<li></li>').addClass('chpt-level');var $D=$('<a></a>').attr('data-toggle','on').attr('data-container','chapter-'+$B.get_xmlId().replaceAll('/','')).on('click',ss.Delegate.create(this,this.$1A));$D.append(BvD.HtmlUtils.escapeTagsAndEntities($B.get_title()));$C.append($D);$2=$('<ul></ul>').attr('id','chapter-'+$B.get_xmlId().replaceAll('/',''));$C.append($2);$1.append($C);$3=$B.get_xmlId();}$2.append($4);}}this.$12.append($1);},$15:function($p0,$p1,$p2){var $0;var $1;if($p2==null||!$p2.length){$0=$('<li></li>').addClass('page-level');var $2=$('<a></a>').attr('data-toggle','on').attr('href','/'+$p0.get_xmlId()).attr('data-container','page-'+$p0.get_xmlId().replaceAll('/','')).attr('title','Go to this page').on('click',ss.Delegate.create(this,this.$1A));if($p0.get_isRoot()){$2.append('Orphaned Notes');}else{$2.append(BvD.HtmlUtils.escapeTagsAndEntities($p0.get_title()));var $3=$('<span></span>');$3.append(BvD.HtmlUtils.escapeTagsAndEntities(' Go to this page'));if(!this.$0.$6.$5($p0)){$3.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$2.goTo($p0.get_xmlId());this.$1.$1E(0);}));}else{$0.addClass('unavailable');}$2.append($3);}$0.append($2);$1=$('<ul></ul>');}else{$0=$p2;$1=$p2.find('ul').eq(0);}$1.attr('id','page-'+$p0.get_xmlId().replaceAll('/',''));var $enum1=ss.IEnumerator.getEnumerator($p1);while($enum1.moveNext()){var $4=$enum1.current;var $5=($4.userId===BvD.Xsl.get_userId())?null:this.$0.$3.get_$1_4().$1($4.userId);if($5!=null){$('#sharednotesfilters').show();}var $6;if(this.$0.$3.$1_D($4)){$6=this.$16($4,$5);}else{$6=this.$17($4,$5);}if($('#print-notes').length>0){this.$18($p0,$4);}if($6!=null){$1.append($6);}}if(!$1.html()){return null;}$0.append($1);return $0;},$16:function($p0,$p1){if((!this.$5&&$p0.isHighlightOnly)||(!this.$7&&$p0.type===BvD.NoteType.page)||(!this.$6&&!$p0.isHighlightOnly&&$p0.type!==BvD.NoteType.page)){return null;}if(($p1!=null&&this.$9)||($p1==null&&this.$A)){return null;}var $0=BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($p0.title);var $1=CourseSmartReader._BBCode.$2($p0.comment);var $2=BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($p0.selection);var $3='';var $4='';var $5='';var $6='';var $7=$('<li></li>');if($p1==null){$7.addClass('owner');}else{$7.addClass('shared');$4=' title="Notes and highlights shared by ';if($p1.accountrole==='Instructor'){$7.addClass('instructor');$4+='the instructor"';$3='Professor '+$p1.lastname;}else{$4+='another student"';$3=$p1.firstname+' '+$p1.lastname;}}if($p0.type===BvD.NoteType.page){$7.addClass('note');$6='<span>'+($1||$0)+'</span>';$5=$0;}else if($p0.isHighlightOnly){$7.addClass('highlight');$6='<em>&#34;'+$2+'&#34;</em>';$5=$2;}else{$7.addClass('highlight-note');$6='<em>&#34;'+$2+'&#34;</em><span>'+$1+'</span>';$5=$0;}var $8=$p0.date;$7.append('<span class="icon fl"'+$4+'></span>').append($('<a href="#" class="fr delete" title="Delete">Delete</a>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);}))).append('<span class="date fr">'+(($8.getMonth()+1)+'/'+$8.getDate()+'/'+$8.getFullYear())+'</span>');$('<a href="#" title="'+$5+'">'+$6+'</a>').appendTo($7).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));if($p1!=null){$7.append('<span class="sharedBy">Shared by: '+$3);}return $7;},$17:function($p0,$p1){if((!this.$5&&$p0.isHighlightOnly)||(!this.$7&&$p0.type===BvD.NoteType.page)||(!this.$6&&!$p0.isHighlightOnly&&$p0.type!==BvD.NoteType.page)){return null;}if(($p1!=null&&this.$9)||($p1==null&&this.$A)){return null;}var $0=BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($p0.title);var $1=CourseSmartReader._BBCode.$2($p0.comment);var $2=BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($p0.selection);var $3='';var $4=$0;var $5='';var $6=$('<li></li>');if($p1==null){$6.addClass('owner');}else{$6.addClass('shared');$5=' title="Notes and highlights shared by ';if($p1.accountrole==='Instructor'){$6.addClass('instructor');$5+='the instructor"';$3='Professor '+$p1.lastname;}else{$5+='another student"';$3=$p1.firstname+' '+$p1.lastname;}}var $7=$('<a class="fr delete" title="Delete">Delete</a>');var $8=$p0.date;$6.append('<span class="icon fl"></span>').append($7).append('<span class="date fr">'+(($8.getMonth()+1)+'/'+$8.getDate()+'/'+$8.getFullYear())+'</span>');var $9=$('<a href="#"></a>');if($p0.type===BvD.NoteType.page){$6.addClass('note');$7.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);}));$9.append('<span>'+($1||$0)+'</span>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));}else if($p0.isHighlightOnly){$6.addClass('highlight');$7.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);}));$9.append('<em>&#34;'+$2+'&#34;</em>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1A($p0);}));$4=$2;}else{$6.addClass('highlight-note');$7.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$0.$3.$1_B($p0);}));$9.append('<em>&#34;'+$2+'&#34;</em>').appendTo($6).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1A($p0);}));$('<a href="#" class="fr delete" title="Delete">Delete</a>').appendTo($6).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$0.$3.$1_C($p0,null);}));$9=$('<a href="#"><span>'+$1+'</span></a>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));}$9.attr('title',$4);$6.append($9);if($p1!=null){$6.append('<span class="sharedBy">Shared by: '+$3+'</span>');}return $6;},$18:function($p0,$p1){if(BvD.Browser.isAndroid){return;}var $0=$('<div></div>').addClass('note');var $1=$p1.date;this.$19($0,'book-title','Book Title',this.$2.get_tableOfContents().get_root().get_title(),true).toggle(this.$B);this.$19($0,'note-title','Note Title',$p1.title,true).toggle(this.$C);this.$19($0,'note-date','Date',($1.getMonth()+1)+'/'+$1.getDate()+'/'+$1.getFullYear(),true).toggle(this.$D);this.$19($0,'note-location','Note Location',($p0.get_isBvdPage())?$p0.get_page():'',true).toggle(this.$E);this.$19($0,'note-text','Note Text',CourseSmartReader._BBCode.$2($p1.comment),false).toggle(this.$F);this.$19($0,'note-highlight','Highlight',$p1.selection||'',true).toggle(this.$10);this.$11.append($0);},$19:function($p0,$p1,$p2,$p3,$p4){if(BvD.Browser.isAndroid){return null;}return $('<div></div>').addClass('line '+$p1).append($('<div></div>').addClass('label').append(document.createTextNode($p2))).append($('<div></div>').addClass('value').append(($p4)?BvD.HtmlUtils.escapeTagsAndEntities($p3):$p3)).append($('<div></div>').addClass('clr')).appendTo($p0);},$1A:function($p0){$p0.preventDefault();var $0=$($p0.currentTarget);var $1=$('#'+$0.attr('data-container'));var $2=$0.attr('data-toggle');if($1==null||!$1.length){return;}if($2==='off'){$0.attr('data-toggle','on');$1.show();}else{$0.attr('data-toggle','off');$1.hide();}}}
CourseSmartReader.CReader$10=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;}
CourseSmartReader.CReader$10.prototype={$0:null,$1:null,$2:null,$3:false,$4:null,$5:null,show:function(){if(!this.$3){this.$3=true;$('#outline-section-toc').append(this.$8(this.$2.get_tableOfContents().get_root().get_children(),0));}this.$6();},hide:function(){},$6:function(){var $0=this.$2.get_currentTocEntry();if($0===this.$4){return;}if(this.$5!=null){this.$5.removeClass('active');this.$5=null;}this.$4=$0;if($0.get_isBvdPage()){$0=$0.get_parent();}if(!$0.get_isRoot()){this.$5=$('#outline'+$0.get_xmlId().replaceAll('/','-')).addClass('active');}},$7:function($p0){$p0.preventDefault();this.$2.goTo($($p0.currentTarget).closest('a').parent().attr('xmlid'));this.$1.$1E(0);},$8:function($p0,$p1){if($p0==null||!$p0.length){return null;}var $0=$('<ul></ul>');if(!$p1){$0.addClass('toc').on('click','a[href]',ss.Delegate.create(this,this.$7));}var $1=$p0.length;for(var $2=0;$2<$1;++$2){var $3=$p0[$2];if($3.get_isBvdPage()){continue;}var $4=$('<li></li>').attr('id','outline'+$3.get_xmlId().replaceAll('/','-')).attr('xmlid',this.$0.$6.$6($3).get_xmlId());var $5=$('<a></a>');if(!this.$0.$6.$5($3)){$5.attr('href','/'+$3.get_xmlId()).attr('title',$3.get_xmlId());}else{$4.addClass('unavailable');}if(this.$0.get_isPageMode()){var $7=$('<span></span>').addClass('pagenumber').html(BvD.HtmlUtils.escapeTagsAndEntities($3.get_pageLabel()));$5.append($7);}var $6=$3.get_title();if($3.get_prefix()!=null){$6=$3.get_prefix()+$6;}$5.append(BvD.HtmlUtils.escapeTagsAndEntities($6));$4.append($5);if(this.$0.$6.$5($3)){$4.append($('<span class="hidden_links">chapter not checked out for offline use</span>'));}if($3.get_children().length>0){var $8=this.$8($3.get_children(),$p1+1);if($8!=null){$4.append($8);}}$0.append($4);}return (!$p1||$0.children().length>0)?$0:null;}}
CourseSmartReader.CReader$F=function(){}
CourseSmartReader.CReader$F.get_$2=function(){return BvD.Browser.isIPad||BvD.Browser.isIPhone||BvD.Browser.isIpod||BvD.Browser.isAndroid||BvD.Browser.isWindowsPhone;}
CourseSmartReader.CReader$F.get_$3=function(){var $0=window.screen.width;var $1=window.self.devicePixelRation;return ($0<=800&&$1>=1.1)||($0<=700&&$1<=1);}
CourseSmartReader.CReader$F.$4=function($p0){if($p0!=null){$p0=$p0.replace(CourseSmartReader.CReader$F.$0,'');$p0=$p0.replace(CourseSmartReader.CReader$F.$1,'');}return $p0;}
CourseSmartReader.CReader$13=function(smartReader){this.$11=BvD.ReaderView.undefined;this.$2=smartReader;this.$3=new CourseSmartReader.CReader$7();this.$1=0;this.$F=new CourseSmartReader.CReader$E(this);this.$4=new CourseSmartReader.CReader$D(this);this.$5=new CourseSmartReader.CReader$8(this);this.$6=new CourseSmartReader.CReader$18(this);this.$7=new CourseSmartReader.CReader$16(this);this.$8=new CourseSmartReader.CReader$B(this);this.$9=new CourseSmartReader.CReader$C(this);this.$A=new CourseSmartReader.CReader$12(this);this.$C=new CourseSmartReader.CReader$10(this);this.$D=new CourseSmartReader.CReader$5(this);this.$E=new CourseSmartReader.CReader$4(this);this.$B=new CourseSmartReader.CReader$9(this);this.$3.get_$3B().on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1E(2);}));this.$3.get_$3E().on('click',ss.Delegate.create(this,this.$1F));$(document).on('keydown',ss.Delegate.create(this,this.$2B));BvD.IFrameProxy.get_all().on('keydown',null,ss.Delegate.create(this,this.$2B));var $0=this.$2.$0;$0.add_pageLoaded(ss.Delegate.create(this,this.$2E));$0.add_zoomChanged(ss.Delegate.create(this,this.$2F));$0.add_linkClicked(ss.Delegate.create(this,this.$23));$0.add_viewChanged(ss.Delegate.create(this,this.$22));if($0.get_mode()===BvD.ReaderMode.flash){$0.add_keyPressed(ss.Delegate.create(this,this.$2C));$0.add_noteAdded(ss.Delegate.create(this,this.$26));$0.add_noteRemoved(ss.Delegate.create(this,this.$27));$0.add_allNotesSelected(ss.Delegate.create(this,this.$28));$0.get_notes().add_flashNotesSelected(ss.Delegate.create(this,this.$29));}$('#toExec').hide().next().hide().next().hide().next().hide();if(CourseSmartReader.CReader$F.get_$2()){$(window).on('orientationchange',ss.Delegate.create(this,this.$24));this.$24(null);}this.$2A();}
CourseSmartReader.CReader$13.prototype={$0:null,$1:0,$2:null,$3:null,$4:null,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:null,$D:null,$E:null,$F:null,$10:false,$12:0,$13:false,$14:true,$15:function($p0){$('#'+$p0).children().eq(0).attr('tabindex','-1').focus();},$16:function(){if(this.$14){this.$14=false;return;}else if(this.$2.$2.get_$2()){this.$2.$2.set_$2(false);$('#left-search').find('ul.submenu li.active a').focus();return;}this.$12=0;$('#booktext508').focus();},$17:function(){var $0=this.$3.get_$6D().hasClass('marked');var $1=($0)?this.$3.get_$6D().attr('data-str-removebookmark'):this.$3.get_$6D().attr('data-str-addbookmark');this.$3.get_$6D().find('a').attr('title',$1).html($1);this.$3.get_$6D().find('label span').html(($0)?'Remove Bookmark':'Bookmark');this.$3.get_$6D().toggleClass('marked',$0);this.$2.$0.get_bookmarks().toggleOnCurrentPage();},$18:function($p0,$p1,$p2,$p3,$p4){if($p2){var $0=new CourseSmartReader.CReader$1F($p0,-1,null,null,null,$p3,$p4,null,false);$0.add_$1_12(ss.Delegate.create(this.$2.$3,this.$2.$3.$1_F));$0.add_$1_14(ss.Delegate.create(this.$2.$3,this.$2.$3.$1_10));$0.show();}else{this.$2.$3.$1_A($p3);}},$19:function($p0,$p1){var $0=new CourseSmartReader.CReader$1F($p0,$p1.id,$p1.title,$p1.comment,$p1,null,$p1.type,this.$2.$3.get_$1_4().$1($p1.userId),!this.$2.get_isOffline());$0.add_$1_12(ss.Delegate.create(this.$2.$3,this.$2.$3.$1_F));$0.add_$1_14(ss.Delegate.create(this.$2.$3,this.$2.$3.$1_10));$0.add_$1_16(ss.Delegate.create(this.$2.$3,this.$2.$3.$1_11));$0.show();},$1A:function($p0){var $0=this.$2.$3.get_$1_4().$1($p0.userId);var $1=new CourseSmartReader.CReader$2B(null,$p0,$0);$1.add_$1_3(ss.Delegate.create(this,function($p1_0,$p1_1){
if($p0.isHighlightOnly){this.$2.$3.$1_9($p0);}else{this.$2.$3.$1_B($p0);}}));$1.show();},$1B:function($p0){var $0=new CourseSmartReader.CReader$29(null,$p0);$0.show();},$1C:function($p0){var $0=new CourseSmartReader.CReader$22(null);$0.add_$1_0(ss.Delegate.create(this,function($p1_0,$p1_1){
this.$2.$3.$1_9($p0);}));$0.show();},$1D:function(){if(this.$2.$0.get_isReady()){var $0=this.$2.$0.get_mode();var $1=($0===BvD.ReaderMode.flash)?BvD.ReaderMode.images:BvD.ReaderMode.flash;if(this.$2.isModeSupported($1)){this.$2.switchMode($1,BvD.ReaderView.undefined);}}},$1E:function($p0){if($p0===this.$1){return;}var $0=$('#PFView,#HtmlView');if($p0===1){this.$3.get_$3C().hide();this.$3.get_$38().show().attr('data-toggle','on');$0.hide();if(BvD.Browser.isIPad||BvD.Browser.isIPhone||BvD.Browser.isIPhone){this.$3.get_$39().hide();}else{this.$3.get_$39().css('visibility','hidden');}this.$3.get_$39().attr('data-toggle','off');this.$B.$7();}else if($p0===2){this.$3.get_$3C().show();if(BvD.Browser.isIPad||BvD.Browser.isIPhone||BvD.Browser.isIPhone){this.$3.get_$39().hide();}else{this.$3.get_$39().css('visibility','hidden');}this.$3.get_$39().attr('data-toggle','off');}else{this.$3.get_$3C().hide();this.$3.get_$38().hide().attr('data-toggle','off');$0.css('display','');if(BvD.Browser.isIPad||BvD.Browser.isIPhone||BvD.Browser.isIPhone){this.$3.get_$39().show();}else{this.$3.get_$39().css('visibility','visible');}this.$3.get_$39().attr('data-toggle','on');this.$B.$8();if(this.$10){this.$2.$0.zoomPageWidth();this.$10=false;}}this.$4.$1D($p0);},$1F:function($p0){$p0.preventDefault();this.$3.get_$3D().removeClass('show-bar-marketing').addClass('hide-bar-marketing');},$20:function($p0){$p0.preventDefault();this.$21($($p0.currentTarget),false);},$21:function($p0,$p1){if(!$p1&&$p0.hasClass('left-sidepanel-expand')){$p0.removeClass('left-sidepanel-expand').addClass('left-sidepanel-collapse').next().hide();var $0=$p0.attr('data-collapsetitle');$p0.attr('title',$0);$p0.text($0);}else{$p0.removeClass('left-sidepanel-collapse').addClass('left-sidepanel-expand').next().show();var $1=$p0.attr('data-expandtitle');$p0.attr('title',$1);$p0.text($1);}},$22:function($p0,$p1){$('#'+this.$2.$1.containerId).toggleClass('thumbnail_active',this.$2.$0.get_view()===BvD.ReaderView.thumbnails);if(this.$2.$0.get_view()===BvD.ReaderView.thumbnails){$('#t_block_list .thumbnail').first().focus();}},$23:function($p0,$p1){if(!this.$2.get_isOffline()){if($p1.jEvent!=null){var $2=$($p1.jEvent.currentTarget);if($2.closest('#popupdivpf').length>0||(!$2.closest('#pfv2_page').length&&!$2.closest('html[bowIsIFrame]').length)){return;}if($2.closest('.previewsrbox').length>0){return;}$p1.jEvent.preventDefault();}var $0=this.$2.$0.get_currentTocEntry();var $1=$p1.link;if($1.startsWith('ATC://')){var $3=$1.substr(6);this.$25($3,'/'+$0.get_xmlId(),'',$('#FreeTrialCart').val(),$('#IsSalesPrice').val());return;}else if($1.startsWith('ATB://')){var $4=$1.substr(6);var $5=new CourseSmartReader.CReader$2A(null,$4);$5.show();return;}window.open($1,'_blank');}},$24:function($p0){this.$3.get_$4B().attr('placeholder',(CourseSmartReader.CReader$F.get_$3())?'Go to':'');if(!this.$1){this.$2.$0.zoomPageWidth();}else{this.$10=true;}},$25:function($p0,$p1,$p2,$p3,$p4){BvD.GoogleAnalytics.push(['_trackPageview','/goal/s/eTextbook-subscription/add-to-cart.html']);if(String.isNullOrEmpty($p1)){$p1='/';}var $0=new BvD.QueryString().set('page','0').set('isbn',$p0).set('targetpage',$p1).set('_offline','0');if(!String.isNullOrEmpty($p2)){$0.set('_instructoruserid',$p2);}if(!String.isNullOrEmpty($p3)){$0.set('freetrialcart',$p3);}if(!String.isNullOrEmpty($p4)){$0.set('__saleprice',$p4);}var $1='/cart?'+$0.toString();BvD.Go.to($1,false);},$26:function($p0,$p1){var $0=$p1.type;var $1=null;if($0===BvD.NoteType.printFidelity){$1=new BvD.SelectionEventArgs($p1.xmlid,$0,$p1.selectedText,null,null,null,new BvD.Position($p1.coordinates.left,$p1.coordinates.top),new BvD.Position($p1.coordinates.right,$p1.coordinates.bottom));}this.$18(null,$p1.xmlid,$p1.isNote,$1,$0);},$27:function($p0,$p1){this.$1C(this.$2.$0.get_notes().getById($p1.id));},$28:function($p0,$p1){this.$A.$7();},$29:function($p0,$p1){if($p1.ids!=null&&$p1.ids.length>0){this.$A.$8(this.$2.$0.get_notes().getByIds($p1.ids));}},$2A:function(){try{var $0=$('#CS6828');if($0.length>0){if(!this.$13){this.$13=true;$0.focus();}else{$0.remove();}}}catch($1){}},$2B:function($p0){var $0=$p0.target;var $1=$0.nodeName;if($1==='INPUT'||$1==='TEXTAREA'||$1==='SELECT'){return;}if(this.$2D($p0.which,$p0.ctrlKey,$p0.altKey,$p0.shiftKey,$p0.metaKey)){$p0.preventDefault();}},$2C:function($p0,$p1){this.$2D($p1.code,$p1.ctrl,$p1.alt,$p1.shift,$p1.meta);},$2D:function($p0,$p1,$p2,$p3,$p4){if(($p3&&$p0!==32)||$p1||$p2||$p4||BvD.Layer.get_countOpened()>0){return false;}var $0=this.$2.$0;var $1=false;var $2=$0.get_view();if($p0===36&&$2!==BvD.ReaderView.vertical){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailFirstPage);}else{$0.setFocus(BvD.FocusType.pageTop);}}else if($p0===35&&$2!==BvD.ReaderView.vertical){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailLastPage);}else{$0.setFocus(BvD.FocusType.pageBottom);}}else if($p0===49||$p0===97||$p0===37||$p0===80){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailLeft);}else{$0.previous();}}else if($p0===51||$p0===99||$p0===39||$p0===78){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailRight);}else{$0.next();}}else if($p0===40){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailDown);}else if($2===BvD.ReaderView.vertical){$0.next();}else if($0.get_mode()===BvD.ReaderMode.flash){$0.emulateMouseWheel(-1);}}else if(($p0===13||$p0===32)&&$2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailEnter);}else if($p0===38){$1=true;if($2===BvD.ReaderView.thumbnails){$0.setFocus(BvD.FocusType.thumbnailUp);}else if($2===BvD.ReaderView.vertical){$0.previous();}else if($0.get_mode()===BvD.ReaderMode.flash){$0.emulateMouseWheel(1);}}else if($p0===52||$p0===100||$p0===66){$1=true;this.$17();}else if($p0===53||$p0===101||$p0===72){$1=true;this.$18($('#addpagenotebut').get(0),$0.get_currentTocEntry().get_xmlId(),true,null,BvD.NoteType.page);}else if($p0===83){if(this.$3.get_$42().length>0&&!this.$3.get_$42().hasClass('disabled')){$1=true;var $3=new CourseSmartReader.CReader$26($('#btn-share').get(0),$0.get_currentTocEntry().get_xmlId());$3.show();}}else if($p0===33||($p0===32&&$p3)){$1=true;if($2===BvD.ReaderView.vertical){$0.setFocus(BvD.FocusType.pageTop);}else{$0.smartPageUp();}}else if($p0===34||($p0===32&&!$p3)){$1=true;if($2===BvD.ReaderView.vertical){$0.setFocus(BvD.FocusType.pageBottom);}else{$0.smartPageDown();}}else if($p0===107||$p0===187||$p0===61){$1=true;$0.zoomIn();}else if($p0===109||$p0===189){$1=true;$0.zoomOut();}else if($p0===87){$1=true;$0.zoomPageWidth();}else if($p0===81){$1=true;$0.zoomPageHeight();}else if($p0===71&&this.$3.get_$46().length>0){$1=true;var $4=this.$3.get_$46().attr('data-toggle')==='on';this.$4.$1B(!$4);}else if($p0===84){$1=true;if($2!==BvD.ReaderView.thumbnails){this.$11=$0.get_view();$0.set_view(BvD.ReaderView.thumbnails);}else{$0.set_view(this.$11);}}return $1;},$2E:function($p0,$p1){if(this.$2.$0.get_mode()!==BvD.ReaderMode.html){var $0=this.$2.$0.get_currentTocEntry();if($0==null){return;}if(!$0.get_isBvdPage()){var $2=$0.getFirstDescendantOrFollowingBvdPage();if($2!=null){$0=$2;}}this.$0=$0.get_page();var $1=this.$0;if($1!=null){if($1.length<=4){$1='<span>Page </span>'+$1;}$('#page-number').html($1);}}this.$16();},$2F:function($p0,$p1){this.$2.$5.$4(-1,true);}}
CourseSmartReader.CReader$12=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$1.$3.get_$4E().on('click','.collapse-button',ss.Delegate.create(this.$1,this.$1.$20));this.$2.get_notes().add_collectionChanged(ss.Delegate.create(this,this.$C));this.$2.add_pageLoaded(ss.Delegate.create(this,this.$B));}
CourseSmartReader.CReader$12.prototype={$0:null,$1:null,$2:null,$3:false,$4:true,$5:null,$6:false,show:function(){this.$3=true;if(this.$4){this.$9();}},hide:function(){this.$3=false;},$7:function(){if(!this.$6){this.$6=true;this.$4=true;this.$5=null;}this.$1.$4.$6();this.$1.$21(this.$1.$3.get_$4E().find('.collapse-button'),true);},$8:function($p0){if($p0!=null&&$p0.length>0){if($p0.length===1){this.$1.$19(null,$p0[0]);}else{if(this.$6){this.$6=true;this.$5=$p0;this.$4=true;this.$1.$4.$6();}}}},$9:function(){if(this.$6){this.$5=this.$2.get_notes().getNotesOnCurrentPage();}this.$A();},$A:function(){this.$4=false;var $0=this.$5.length;if(!$0){this.$1.$4.$7(null);}else{var $1=$('<ul></ul>');for(var $2=0;$2<$0;++$2){var $3=this.$5[$2];var $4=($3.userId===BvD.Xsl.get_userId())?null:this.$0.$3.get_$1_4().$1($3.userId);if(this.$0.$3.$1_D($3)){$1.append(this.$D($3,$4));}else{$1.append(this.$E($3,$4));}}$('#notescontainer').html('').append($1);}},$B:function($p0,$p1){this.$6=true;this.$5=null;if(this.$3){this.$9();}else{this.$4=true;}},$C:function($p0,$p1){if(this.$6){this.$5=null;}else{var $0=$p1;var $1=$0.addedItems;var $2=$0.removedItems;var $3=$0.updatedItems;if(this.$5!=null){if($2!=null&&$2.length>0){for(var $4=0;$4<$2.length;++$4){this.$5.remove($2[$4]);}}if($1!=null&&$1.length>0){for(var $5=0;$5<$1.length;++$5){this.$5.add($1[$5]);}}if($3!=null&&$3.length>0){for(var $6=0;$6<$3.length;++$6){}}}}if(this.$3){this.$9();}else{this.$4=true;}},$D:function($p0,$p1){var $0=BvD.HtmlUtils.escapeTagsAndEntities($p0.title)||'';var $1=CourseSmartReader.CReader$F.$4($p0.comment);var $2=BvD.HtmlUtils.escapeTagsAndEntities($p0.selection)||'';var $3;var $4='';var $5=$('<li></li>');if($p1==null){$5.addClass('owner');}else{$5.addClass('shared');$4=' title="Notes and highlights shared by ';if($p1.accountrole==='Instructor'){$5.addClass('instructor');$4+='the instructor"';}else{$4+='another student"';}}$5.append('<span class="icon fl"'+$4+'></span>');if($p0.type===BvD.NoteType.page){$3='<span>'+($1||$0)+'</span>';$5.addClass('note');}else if($p0.isHighlightOnly){$3='<em>&#34;'+$2+'&#34;</em>';$5.addClass('highlight');}else{$3='<em>&#34;'+$2+'&#34;</em><span>'+$1+'</span>';$5.addClass('highlight-note');}if($p1==null){$5.append($('<a class="fr delete" title="Delete" href="#">Delete</a>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);})));}$('<a href="#" title="'+(($p1==null)?'Edit':'View')+'">'+$3+'</a>').appendTo($5).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));return $5;},$E:function($p0,$p1){var $0=BvD.HtmlUtils.escapeTagsAndEntities($p0.title)||'';var $1=CourseSmartReader.CReader$F.$4($p0.comment);var $2=BvD.HtmlUtils.escapeTagsAndEntities($p0.selection)||'';var $3='';var $4=$('<li></li>');if($p1==null){$4.addClass('owner');}else{$4.addClass('shared');$3=' title="Notes and highlights shared by ';if($p1.accountrole==='Instructor'){$4.addClass('instructor');$3+='the instructor"';}else{$3+='another student"';}}$4.append('<span class="icon fl"'+$3+'></span>');var $5=($p1!=null)?null:$('<a href="#" class="fr delete" title="Delete">Delete</a>').appendTo($4);var $6=$('<a href="#" title="'+(($p1==null)?'Edit':'View')+'"></a>').appendTo($4);if($p0.type===BvD.NoteType.page){$4.addClass('note');if($5!=null){$5.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);}));}$6.html('<span>'+($1||$0)+'</span>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));}else if($p0.isHighlightOnly){$4.addClass('highlight');if($5!=null){$5.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1C($p0);}));}$6.append('<em>&#34;'+$2+'&#34;</em>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1A($p0);}));}else{$4.addClass('highlight-note');if($5!=null){$5.on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$0.$3.$1_B($p0);}));}$('<em>&#34;'+$2+'&#34;</em>').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$1A($p0);})).appendTo($6);if($p1==null){$('<a href="#" class="fr delete" title="Delete">Delete</a>').appendTo($4).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$0.$3.$1_C($p0,null);}));}$6=$('<a href="#" title="'+(($p1==null)?'Edit':'View')+'"></a>').appendTo($4);$('<span>'+$1+'</span>').appendTo($6).on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$1.$19($p1_0.currentTarget,$p0);}));}return $4;}}
CourseSmartReader.CReader$C=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$3=this.$1.$3;this.$3.get_$4D().on('click','.collapse-button',ss.Delegate.create(this.$1,this.$1.$20));this.$3.get_$4F().on('submit',ss.Delegate.create(this,this.$5));this.$3.get_$50().on('click',ss.Delegate.create(this,this.$6));this.$3.get_$51().on('click',ss.Delegate.create(this,this.$7));this.$3.get_$52().on('click',ss.Delegate.create(this,this.$8));$('#left-search').on('click','*[data-xmlid]',ss.Delegate.create(this,this.$4));}
CourseSmartReader.CReader$C.prototype={$0:null,$1:null,$2:null,$3:null,show:function(){},hide:function(){},$4:function($p0){$p0.preventDefault();this.$D($($p0.currentTarget).attr('data-xmlid'));},$5:function($p0){$p0.preventDefault();if(!this.$3.get_$4F().length){return;}var $0=$('#readersearch');var $1=(($0!=null)?$0.val():'');if($1.length>0){var $2=this.$2.get_tableOfContents().get_root().get_xmlId();var $3=this.$2.get_currentTocEntry();var $4=null;if($3!=null){if($3.get_xmlId()!=null){$2=$3.get_xmlId();}$4=this.$0.$6.$7($3);if($4!=null){var $6=$('#ParentSection');if($6!=null){$6.val($4.get_xmlId());}}}var $5=BvD.Form.extractInfo(this.$3.get_$4F()[0]);if(!this.$0.get_isOffline()){$5.query.set('xmlid',$2).set('__className','SearchReader').set('pagemode',((this.$0.get_isPageMode())?'1':'0'));BvD.Ajax.link($5.query,'SearchReader');}else{var $7=this.$3.get_$53().val();if($7==='book'){$7='all';}var $8=this.$0.$B.$5($('#readersearch').val(),$7);var $9=$('<ul></ul>');if($8!=null){for(var $A=0;$A<$8.length;++$A){var $B=$8[$A];$9.append(this.$C($B));}}if(!$9.children().length){var $C=$('<li></li>').attr('id','search-noresult').addClass('result');var $D=$('<p></p>').append(document.createTextNode('No results found')).appendTo($C);$9.appendTo($C);}else{var $E=$('#readersearch').val();var $F=this.$0.$B.$6($E);this.$0.$0.setQuery($E);this.$0.$0.setSearchTerms($F);}$('#SearchReader-ResultList').html('').append($9);}}},$6:function($p0){this.$B(this.$3.get_$50());this.$9('book');this.$5($p0);},$7:function($p0){this.$B(this.$3.get_$51());this.$9('page');this.$5($p0);},$8:function($p0){this.$B(this.$3.get_$52());this.$9('chapter');this.$5($p0);},$9:function($p0){this.$3.get_$53().val($p0);},$A:function(){this.$3.get_$50().parent().removeClass('active');this.$3.get_$51().parent().removeClass('active');this.$3.get_$52().parent().removeClass('active');},$B:function($p0){this.$A();$p0.parent().addClass('active');},$C:function($p0){var $0=this.$2.get_tableOfContents().getByXmlId($p0);var $1=$('<li></li>').addClass('result');var $2=$('<a></a>').attr('href','#').attr('title',$0.get_page()).addClass('pagenumber').css('cursor','pointer').css('float','none').on('click',ss.Delegate.create(this,function($p1_0){
$p1_0.preventDefault();this.$2.goTo($p0);}));if(this.$0.get_isPageMode()){$2.append(document.createTextNode($0.get_page()));}else{var $3=$0.get_title();if($0.get_prefix()!=null){$3=$0.get_prefix()+$3;}$2.append(document.createTextNode($3));}$1.append($2);return $1;},$D:function($p0){this.$2.goTo($p0);if(CourseSmartReader.CReader$F.get_$2()&&CourseSmartReader.CReader$F.get_$3()){this.$1.$4.$8();}}}
CourseSmartReader.CReader$B=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$1.$3.get_$4C().on('click','.collapse-button',ss.Delegate.create(this.$1,this.$1.$20));this.$2.add_pageLoaded(ss.Delegate.create(this,this.$8));}
CourseSmartReader.CReader$B.prototype={$0:null,$1:null,$2:null,$3:null,$4:false,$5:false,$6:false,show:function(){if(!this.$4){this.$4=true;var $0=this.$C(this.$2.get_tableOfContents().get_root().get_children(),0);var $1=$($0).attr('id','toc-root-container').on('click','a[href]',ss.Delegate.create(this,this.$D));this.$1.$3.get_$4C().find('.inner').eq(0).append($1);this.$0.$8.$5();this.$6=true;}if(this.$6){this.$9();}this.$5=true;},hide:function(){this.$5=false;},$7:function(){if(this.$3!=null&&this.$3.length>0){this.$3[0].scrollIntoView();}},$8:function($p0,$p1){if(this.$5){this.$9();}else{this.$6=true;}},$9:function(){this.$6=false;this.$A();this.$B(this.$2.get_currentTocEntry().get_xmlId());this.$7();},$A:function(){if(this.$3!=null&&this.$3.length>0){this.$3.removeClass('active').parentsUntil('#toc-root-container').filter('ul').hide();this.$3.children().filter('ul').hide();}},$B:function($p0){this.$3=$('#toc-root-container').find('li[data-xmlid="'+$p0+'"]');if(this.$3.length>0){this.$3.addClass('active').parentsUntil('#toc-root-container').filter('ul').show();this.$3.children().filter('ul').show();}},$C:function($p0,$p1){if($p0==null||!$p0.length){return '';}var $0='<ul'+(($p1>=1)?' style="display:none;"':'')+'>';var $1=$p0.length;for(var $2=0;$2<$1;++$2){var $3=$p0[$2];if(!this.$0.get_isPageMode()&&$3.get_isBvdPage()){continue;}var $4=this.$0.$6.$5($3);var $5=(!$p1)?'class="chpt'+(($4)?' unavailable':'')+'"':'';$0+='<li '+$5+' id="'+$3.get_xmlId()+'" data-xmlid="'+this.$0.$6.$6($3).get_xmlId()+'">';var $6=($4)?'':(' href="/'+$3.get_xmlId()+'"');var $7=$3.get_title();if($3.get_prefix()!=null){$7=$3.get_prefix()+$7;}$0+='<a'+$6+' title="'+BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($7)+'">';if(this.$0.get_isPageMode()){$0+='<span>'+BvD.HtmlUtils.escapeTagsAndEntities($3.get_pageLabel())+'</span>';}$0+=BvD.HtmlUtils.escapeTagsAndEntities(this.$E($7,$p1));$0+='</a>';if($4){$0+=' <span class="hidden_links">chapter not checked out for offline use</span>';}if($3.get_children().length>0){var $8=this.$C($3.get_children(),$p1+1);if($8!=null){$0+=$8;}}$0+='</li>';}$0+='</ul>';return $0;},$D:function($p0){$p0.preventDefault();this.$1.$12=1;var $0=$($p0.currentTarget).closest('a').parent();var $1=$0.hasClass('active');var $2=$0.attr('data-xmlid');this.$A();this.$B($2);this.$7();this.$2.goTo($2);if($1&&CourseSmartReader.CReader$F.get_$2()&&CourseSmartReader.CReader$F.get_$3()){this.$1.$4.$A($p0);}},$E:function($p0,$p1){var $0=(!$p1)?15:$p1*30;var $1=300-$0;var $2=$1/((!$p1)?9:7);if($p0.length>$2){$p0=$p0.substring(0,$2)+'...';}return $p0;}}
CourseSmartReader.CReader$D=function(smartReaderUI){this.$1=smartReaderUI;this.$0=this.$1.$2;this.$2=this.$0.$0;this.$3=this.$1.$3;this.$3.get_$43().on('click',ss.Delegate.create(this,this.$9));this.$3.get_$44().on('click',ss.Delegate.create(this,this.$A));this.$3.get_$45().on('click',ss.Delegate.create(this,this.$B));this.$3.get_$46().on('click',ss.Delegate.create(this,this.$C));this.$3.get_$47().on('click',ss.Delegate.create(this,this.$D));this.$3.get_$3F().on('click',ss.Delegate.create(this,this.$E));this.$3.get_$40().on('click',ss.Delegate.create(this,this.$F));this.$3.get_$41().on('click',ss.Delegate.create(this,this.$10));this.$3.get_$42().on('click',ss.Delegate.create(this,this.$11));this.$3.get_$49().on('submit',ss.Delegate.create(this,this.$12));$('#toc-close').on('click',ss.Delegate.create(this,this.$A));$('#search-close').on('click',ss.Delegate.create(this,this.$B));$('#mynotes-close').on('click',ss.Delegate.create(this,this.$7));$(document).on('click',ss.Delegate.create(this,this.$23));if(BvD.Browser.isAndroid){this.$3.get_$41().hide();}if(this.$3.get_$47().length>0){if(this.$1.$F.$3(BvD.ReaderMode.flash)||this.$1.$F.$3(BvD.ReaderMode.images)){$('#viewmode-single').closest('li').show();}if(this.$1.$F.$3(BvD.ReaderMode.html)){$('#viewmode-reflow').closest('li').show();}if(this.$1.$F.$3(BvD.ReaderMode.flash)){$('#viewmode-continuous,#viewmode-sidebyside').closest('li').show();}if(this.$0.get_hasHtmlThumbnails()||this.$0.get_isPageMode()){$('#viewmode-thumbnails').closest('li').show();}this.$3.get_$48().find('a').on('click',ss.Delegate.create(this,function($p1_0){
this.$24($p1_0);this.$D($p1_0);}));}this.$2.add_grabChanged(ss.Delegate.create(this,this.$1F));this.$2.add_zoomChanged(ss.Delegate.create(this,this.$1E));this.$2.add_viewChanged(ss.Delegate.create(this,this.$20));this.$1E(null,null);this.$20(null,null);if(!this.$0.get_isPageMode()){if(!this.$2.get_tableOfContents().get_hasEpubAnchors()){$('.fc.fl.page').hide();}if(this.$3.get_$46().length>0){this.$22(this.$3.get_$46());this.$3.get_$46().hide();}if(this.$3.get_$41().length>0){if(!this.$3.get_$41().hasClass('disabled')){this.$22(this.$3.get_$41());}this.$3.get_$41().hide();}}}
CourseSmartReader.CReader$D.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,$6:function(){this.$17(true);},$7:function($p0){if($p0!=null){$p0.preventDefault();}this.$17(false);},$8:function(){this.$16(false);},$9:function($p0){this.$13($p0,this.$3.get_$38(),ss.Delegate.create(this,this.$14));},$A:function($p0){this.$13($p0,this.$3.get_$4C(),ss.Delegate.create(this,this.$15));},$B:function($p0){this.$13($p0,this.$3.get_$4D(),ss.Delegate.create(this,this.$16));},$C:function($p0){this.$13($p0,this.$3.get_$46(),ss.Delegate.create(this,this.$1B));},$D:function($p0){$p0.stopPropagation();this.$13($p0,this.$3.get_$48(),ss.Delegate.create(this,this.$1C));},$E:function($p0){$p0.preventDefault();if(!this.$3.get_$3F().hasClass('disabled')){this.$2.zoomIn();}},$F:function($p0){$p0.preventDefault();if(!this.$3.get_$40().hasClass('disabled')){this.$2.zoomOut();}},$10:function($p0){$p0.preventDefault();if(this.$3.get_$41().hasClass('disabled')){return;}var $0=this.$2.get_currentTocEntry();var $1=new CourseSmartReader.CReader$25($p0.currentTarget,$0.get_xmlId(),$0.get_page());$1.add_$1_5(ss.Delegate.create(this,function($p1_0,$p1_1){
var $1_0=$1.get_$1_3();var $1_1=this.$2.get_tableOfContents().getByPage($1_0);if($1_1!=null&&$1_1.length>0){this.$2.print2($1_1[0].get_xmlId(),$1.get_$1_4());$1.close();}}));$1.show();},$11:function($p0){$p0.preventDefault();if(!this.$3.get_$42().hasClass('disabled')){new CourseSmartReader.CReader$26($p0.currentTarget,this.$2.get_currentTocEntry().get_xmlId()).show();}},$12:function($p0){$p0.preventDefault();if(this.$3.get_$4B().hasClass('disabled')){return;}var $0=this.$3.get_$4B().val();if(String.isNullOrEmpty($0)||!$0.trim()){this.$3.get_$4B().val('');return;}if(this.$2.get_mode()===BvD.ReaderMode.html){var $1=this.$2.get_tableOfContents().getEpubAnchor($0);if($1==null){new CourseSmartReader.CReader$27($p0.currentTarget,$0).show();}else{if(this.$0.$6.$5($1.tocEntry)){new CourseSmartReader.CReader$28($p0.currentTarget,$0).show();}else{this.$2.goTo($0);this.$1.$1E(0);}}}else{var $2=this.$2.get_tableOfContents().getByPage($0);if($2!=null&&$2.length>0){if(this.$0.$6.$5($2[0])){new CourseSmartReader.CReader$28($p0.currentTarget,$0).show();}else{this.$2.goTo($2[0].get_xmlId());this.$1.$1E(0);}}else{new CourseSmartReader.CReader$27($p0.currentTarget,$0).show();}}this.$3.get_$4B().val('');},$13:function($p0,$p1,$p2){$p0.preventDefault();var $0=$($p0.currentTarget).closest('a');var $1=$p1.attr('data-toggle');if($1==='on'){$p1.attr('data-toggle','off');$p2(false);}else{$p1.attr('data-toggle','on');$p2(true);}},$14:function($p0){if(!this.$3.get_$43().hasClass('disabled')&&this.$3.get_$38().length>0){this.$1.$1E(($p0)?1:0);if($p0){this.$3.get_$54().find('a').focus();}}},$15:function($p0){if(!this.$3.get_$44().hasClass('disabled')&&this.$3.get_$4C().length>0){this.$1.$1E(0);this.$1A(this.$1.$8,this.$3.get_$4C(),$p0);if($p0){this.$1.$15('left-toc-header');}else{this.$3.get_$44().focus();}}},$16:function($p0){if(!this.$3.get_$45().hasClass('disabled')&&this.$3.get_$4D().length>0){this.$2.showSearchTerms($p0);this.$1.$1E(0);this.$1A(this.$1.$9,this.$3.get_$4D(),$p0);if($p0){this.$1.$15('left-search-header');}else{this.$3.get_$45().focus();}}},$17:function($p0){if(this.$3.get_$4E().length>0){this.$1A(this.$1.$A,this.$3.get_$4E(),$p0);if($p0){this.$1.$15('left-mynotes-header');}else{this.$3.get_$6A().focus();}}},$18:function(){if(this.$4!=null&&this.$5!=null){this.$4.show();if(this.$5!=null){this.$5.attr('data-toggle','on').show();}}},$19:function(){if(this.$4!=null){this.$4.hide();this.$5.attr('data-toggle','off').hide();this.$4=null;this.$5=null;}},$1A:function($p0,$p1,$p2){if($p2&&this.$4===$p0){return;}this.$19();if($p2){this.$4=$p0;this.$5=$p1;this.$18();}},$1B:function($p0){if(!this.$3.get_$46().hasClass('disabled')){this.$2.set_grab($p0);}},$1C:function($p0){if(!this.$3.get_$47().hasClass('disabled')&&this.$3.get_$48().length>0){this.$3.get_$48().toggle($p0);}},$1D:function($p0){if($p0===this.$1.$1){return;}this.$1.$1=$p0;this.$1A(null,null,false);if($p0===1){this.$22(this.$3.get_$3F());this.$22(this.$3.get_$40());this.$22(this.$3.get_$41());this.$22(this.$3.get_$46());if(this.$3.get_$47().length>0){this.$22(this.$3.get_$47());}if(this.$3.get_$48().length>0){this.$3.get_$48().hide();this.$3.get_$48().attr('data-toggle','off');}this.$22(this.$3.get_$43());}else{this.$21(this.$3.get_$3F(),true);this.$21(this.$3.get_$40(),true);this.$21(this.$3.get_$41(),true);this.$21(this.$3.get_$42(),true);this.$21(this.$3.get_$46(),true);if(this.$3.get_$47().length>0){this.$21(this.$3.get_$47(),true);}if(this.$3.get_$48().length>0){this.$21(this.$3.get_$48(),true);}this.$21(this.$3.get_$43(),true);}},$1E:function($p0,$p1){if(this.$2.get_isFirstZoomLevel()){this.$22(this.$3.get_$40());}else{this.$21(this.$3.get_$40(),false);}if(this.$2.get_isLastZoomLevel()){this.$22(this.$3.get_$3F());}else{this.$21(this.$3.get_$3F(),false);}},$1F:function($p0,$p1){this.$3.get_$46().attr('data-toggle',(this.$2.get_grab())?'on':'off');},$20:function($p0,$p1){var $0=this.$2.get_view();var $1=null;switch($0){case BvD.ReaderView.singlePage:if(this.$2.get_mode()!==BvD.ReaderMode.html){$1=$('#viewmode-single');}else{$1=$('#viewmode-reflow');}break;case BvD.ReaderView.vertical:case BvD.ReaderView.fit:$1=$('#viewmode-continuous');break;case BvD.ReaderView.twoSinglePages:$1=$('#viewmode-sidebyside');break;case BvD.ReaderView.thumbnails:$1=$('#viewmode-thumbnails');break;}if($0===BvD.ReaderView.thumbnails){this.$22(this.$3.get_$3F());this.$22(this.$3.get_$40());}else{this.$21(this.$3.get_$3F(),true);this.$21(this.$3.get_$40(),true);}if($1!=null&&$1.length>0){$1=$1.parent().parent();var $2=this.$3.get_$48().find('.active');if($2.length===1){$2.removeClass('active');}if(!$1.length){return;}$1.addClass('active');}},$21:function($p0,$p1){if($p0.length>0){var $0=$p0.attr('data-state')==='enabled';if($0||!$p1){$p0.removeClass('disabled');}}},$22:function($p0){if($p0.length>0){$p0.attr('data-state',($p0.hasClass('disabled'))?'disabled':'enabled');$p0.addClass('disabled');}},$23:function($p0){var $0=this.$3.get_$48();var $1=ss.Delegate.create(this,this.$1C);var $2=$0.attr('data-toggle');if($2==='on'){$0.attr('data-toggle','off');$1(false);}},$24:function($p0){$p0.preventDefault();var $0=$($p0.currentTarget).closest('a');var $1=$0[0].id;switch($1){case 'viewmode-single':if(this.$2.get_mode()!==BvD.ReaderMode.html){this.$2.set_view(BvD.ReaderView.singlePage);}else{this.$1.$F.$2(BvD.ReaderView.singlePage);}break;case 'viewmode-continuous':if(this.$2.get_mode()!==BvD.ReaderMode.html){this.$2.set_view(BvD.ReaderView.vertical);}else{this.$1.$F.$2(BvD.ReaderView.vertical);}break;case 'viewmode-sidebyside':if(this.$2.get_mode()!==BvD.ReaderMode.html){this.$2.set_view(BvD.ReaderView.twoSinglePages);}else{this.$1.$F.$2(BvD.ReaderView.twoSinglePages);}break;case 'viewmode-reflow':if(this.$2.get_mode()===BvD.ReaderMode.html){this.$2.set_view(BvD.ReaderView.singlePage);}else{this.$1.$F.$2(BvD.ReaderView.singlePage);}break;case 'viewmode-thumbnails':this.$2.set_view(BvD.ReaderView.thumbnails);break;}}}
CourseSmartReader.CReader$E=function(smartReaderUI){this.$0=smartReaderUI.$2;this.$1=this.$0.$0;}
CourseSmartReader.CReader$E.prototype={$0:null,$1:null,$2:function($p0){var $0=this.$1.get_mode();if($0===BvD.ReaderMode.html){if(this.$0.isModeSupported(BvD.ReaderMode.flash)){this.$0.switchMode(BvD.ReaderMode.flash,$p0);}else{this.$0.switchMode(BvD.ReaderMode.images,$p0);}}else{this.$0.switchMode(BvD.ReaderMode.html,$p0);}},$3:function($p0){var $0=BvD.ReaderMode.html;if($p0===BvD.ReaderMode.flash&&!CourseSmartReader.CReader$F.get_$2()){$0=BvD.ReaderMode.flash;}else if($p0===BvD.ReaderMode.flash&&CourseSmartReader.CReader$F.get_$2()){return false;}else if($p0===BvD.ReaderMode.images){$0=BvD.ReaderMode.images;}return this.$0.isModeSupported($0);}}
CourseSmartReader.SmartReader=function(){}
CourseSmartReader.SmartReader.prototype={$0:null,$1:null,$2:null,$3:null,$4:null,$5:null,$6:null,$7:null,$8:null,$9:null,$A:null,$B:null,$C:false,$D:false,$E:null,start:function(isOffline){this.$D=isOffline;this.$F();},$F:function(){try{var $0=$('#smartviewer');if($0.attr('data-fulfillmentredirect')==='1'){BvD.Go.to('/pagenotfound',false);}this.$C=$0.attr('data-migrationstatus')==='MigrationInProgress';this.$1=new BvD.ReaderConfig();this.$1.containerId='smartviewer';this.$1.xmlId=BvD.BookSection.parse($0.attr('data-reader-xmlid'));this.$1.allowBookmarks=$0.attr('data-reader-allowbookmarks')==='1';this.$1.allowNotes=$0.attr('data-reader-allownotes')==='1';this.$1.allowHighlights=this.$1.allowNotes;this.$1.is508Enabled=false;this.$1.showSoms=false;this.$1.somState=null;this.$1.useHtmlIFrame=$0.attr('data-reader-iframe')==='1';var $1=this.get_isOffline();if($1&&!this.$14(this.$1.xmlId,this.$1.containerId)){return;}var $2;if($('#PFView').length>0){$2=BvD.ReaderMode.images;}else if($('#HtmlView').length>0){$2=BvD.ReaderMode.html;}else{$2=BvD.ReaderMode.flash;}switch($2){case BvD.ReaderMode.images:this.$1.viewerId='PFView';this.$1.ajaxComponent=($1)?'offlinepfv2json':'pfv2json';this.$1.zoom=BvD.MathUtils.parseInt32($0.attr('data-reader-pfzoom'),0);if($1){this.$1.zoomConfig=new BvD.ReaderZoomConfig(300,2000,80,[800]);}else{this.$1.zoomConfig=new BvD.ReaderZoomConfig(300,2000,80,null);}break;case BvD.ReaderMode.html:this.$1.viewerId='HtmlView';this.$1.ajaxComponent=($1)?'HtmlViewOffline':'HtmlView';this.$1.zoom=BvD.MathUtils.parseInt32($0.attr('data-reader-htmlzoom'),0);$('#smartviewer').addClass('reflowable');break;case BvD.ReaderMode.flash:if($('#isnondesktopplatform').val()==='1'){this.$11(null,null);return;}this.$1.containerId='readercontent';this.$1.viewerId='viewer';this.$1.zoom=BvD.MathUtils.parseInt32($0.attr('data-reader-flashzoom'),0);this.$1.accessKey='2';this.$1.link=$0.attr('data-reader-link');this.$1.flashFile=($1)?'viewer_offline':'viewer';this.$1.flashInitialConfig=$('#flash_config').val();this.$1.flashSearchHighlightHeuristicEnabled=$0.attr('data-reader-flashsearchhighlightenabled')==='1';if($1){this.$1.flashOfflineVersion=BvD.Xsl.get_offlineVersion().toString()+';'+CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(this.$1.xmlId.bookId).get_versions().pages.toString()+';'+BvD.Xsl.get_userId().toString();}var $4=$0.attr('data-reader-flashprintheader-username');var $5=$0.attr('data-reader-flashprintheader-booktitle');this.$1.flashPrintHeader='<b>Username: </b>'+$4+'<b>Book: </b>'+$5+". No part of any book may be reproduced or transmitted in any form by any means without the publisher's prior written permission. Use (other than pursuant to the qualified fair use privilege) in violation of the law or these Terms of Service is prohibited. Violators will be prosecuted to the full extent of the law.";var $6=document.getElementById('CreateFlashPreviewXml');if($6!=null){var $7=BvD.Utils.getNodeSource($6);this.$1.flashPreviewMessage=$7;}break;}if($1){var $8=this.$1.xmlId.bookId;var $9=this.$15($8);if($9!=null){switch($2){case BvD.ReaderMode.images:if(!!$9['pfzoom']){this.$1.zoom=parseInt($9['pfzoom'],10);}break;case BvD.ReaderMode.html:if(!!$9['htmlzoom']){this.$1.zoom=parseInt($9['htmlzoom'],10);}break;}}}var $3=new BvD.TableOfContents($('#TOCJSon').val());if($2===BvD.ReaderMode.images){this.$0=BvD.Reader.createJsonReader(this.$1,$3,'jsonpf','pfv2_pagecontentdiv','pfv2_page','pfcontent');}else if($2===BvD.ReaderMode.html){this.$0=BvD.Reader.create(BvD.ReaderMode.html,this.$1,$3);}else if($2===BvD.ReaderMode.flash){this.$0=BvD.Reader.create(BvD.ReaderMode.flash,this.$1,$3);this.$0.add_noFlashDetected(ss.Delegate.create(this,this.$11));this.$0.add_redirected(ss.Delegate.create(this,this.$12));}if($1){if($2===BvD.ReaderMode.html){this.$0.set_contentsNavigator(new CourseSmartReader.CReader$2D(this,this.$0.get_tableOfContents()));}else{this.$0.set_contentsNavigator(new CourseSmartReader.CReader$2E(this,this.$0.get_tableOfContents()));}this.$9=new CourseSmartReader.CReader$15(this);this.$A=new CourseSmartReader.CReader$19(this);this.$B=new CourseSmartReader.CReader$14(this);this.$0.get_selections().set_loadTextFunction(ss.Delegate.create(this.$9,this.$9.$3));if($2===BvD.ReaderMode.flash){this.$0.add_logHit(ss.Delegate.create(this,this.$13));}BvD.AjaxEngine.add_onLogHit(ss.Delegate.create(this,this.$13));}this.$5=new CourseSmartReader.CReader$11(this);this.$2=new CourseSmartReader.CReader$17(this);this.$3=new CourseSmartReader.CReader$24(this);this.$4=new CourseSmartReader.CReader$21(this);this.$6=new CourseSmartReader.CReader$6(this);this.$7=new CourseSmartReader.CReader$2C(this);if($1&&$2===BvD.ReaderMode.flash){this.$0.setFlashToc(this.$6.$10());}this.$E=new CourseSmartReader.CReader$13(this);this.$8=new CourseSmartReader._WebApp(this.$E);this.$0.get_bookmarks().set_readerWriter(this.$4);this.$0.get_notes().set_readerWriter(this.$3);this.$0.get_thumbnails().set_infoProvider(this.$7);this.$0.start();if($2===BvD.ReaderMode.images||$2===BvD.ReaderMode.html){if($1&&$2===BvD.ReaderMode.images){var $A=this.$6.$4();var $B=($A==null)?'':$A.get_xmlId();this.$0.forceReload($B);}else if($2===BvD.ReaderMode.html){this.$0.forceReload(null);}}}catch($C){BvD.ClientSideError.send('[SmartReader] - InitializeReader',$C);}this.$3.$1_8();this.$10();},$10:function(){BvD.AjaxEngine.onPanelReady('AjaxBookmarks',ss.Delegate.create(this.$4,this.$4.$1_3));BvD.AjaxEngine.onPanelReady('AjaxNotes',ss.Delegate.create(this.$3,this.$3.$1_5));BvD.AjaxEngine.onPanelReady('SearchReader',ss.Delegate.create(this.$2,this.$2.$3));},$11:function($p0,$p1){if(!this.get_isOffline()){this.switchMode(BvD.ReaderMode.images,BvD.ReaderView.undefined);}},$12:function($p0,$p1){var $0=$p1.url;if($0==null){BvD.ClientSideError.send('[SmartReader] FlashRedirect - Url is null and should not be!',null);$0='/maxsessions';}BvD.Go.to($0,false);},switchMode:function(mode,view){if(this.get_isOffline()||!this.isModeSupported(mode)){return;}var $0=(this.$0!=null&&this.$0.get_isReady())?'http://'+BvD.Uri.get_current().host+'/'+this.$0.get_currentTocEntry().get_xmlId():'';var $1=new BvD.QueryString();if((mode===BvD.ReaderMode.images&&$('#flashmodesupported').val()==='1')||(mode!==BvD.ReaderMode.images&&mode!==BvD.ReaderMode.flash)){$1.set('reader',this.modeToString(mode));}$1.set('__viewid',view.toString());var $2=BvD.QueryString.parse(BvD.Uri.get_current().query);if($2.contains('__notinstructor')){$1.set('__notinstructor',$2.get('__notinstructor'));}else if($2.contains('__instructor')){$1.set('__instructor',$2.get('__instructor'));}BvD.Go.to($0+'?'+$1.toString(),false);},isModeSupported:function(mode){if(this.get_isOffline()){return mode===this.$0.get_mode();}else{if(mode===BvD.ReaderMode.images){return $('#pfmodesupported').val()==='1';}if(mode===BvD.ReaderMode.flash){return $('#flashmodesupported').val()==='1'&&BvD.Flash.get_enabled();}if(mode===BvD.ReaderMode.html){return $('#htmlmodesupported').val()==='1';}}return false;},get_hasHtmlThumbnails:function(){if(this.get_isOffline()){var $0=this.$0.get_tableOfContents().get_root().get_xmlId();return CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($0).get_versions().htmlthumb>0;}else{var $1=$('#HasHtmlThumbnails');return $1.length>0&&$1.val()==='1';}},get_isPageMode:function(){return this.$0.get_mode()===BvD.ReaderMode.flash||this.$0.get_mode()===BvD.ReaderMode.images;},get_isOffline:function(){return this.$D;},modeToString:function(mode){switch(mode){case BvD.ReaderMode.flash:return 'flash';case BvD.ReaderMode.html:return 'html';case BvD.ReaderMode.images:return 'pf';default:return '';}},$13:function($p0,$p1){var $0=this.$0.get_currentTocEntry();if($0!=null){var $1=BvD.BookSection.parse($0.get_xmlId());CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($1.bookId).addHit($1.sectionId);}},$14:function($p0,$p1){var $0=CourseSmartLocalStorage.OfflineCache.get_currentUser();if($0==null){return false;}if($0.get_item($p0.bookId).get_isExpired()){var $1=$('#'+$p1).addClass('bookexpired');var $2=$('<div></div>').addClass('unavmesgbox');var $3=$('<span></span>').append(document.createTextNode('Book '+$p0.bookId+' has expired'));$2.append($3);$1.append($2);return false;}return true;},$15:function($p0){$p0=$p0.toUpperCase();var $0=CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($p0).get_preference();var $1=CourseSmartLocalStorage.OfflineCache.get_currentUser().get_preferences();var $2=CourseSmartLocalStorage.OfflineCache.getPreferences($p0);var $3=($1!=null)?$1.flashparams:null;$3=($3==null)?'':$3.trim();var $4=($1!=null)?$1.pfzoom:null;$4=($4==null)?'':($4+'').trim();var $5=($1!=null)?$1.htmlzoom:null;$5=($5==null)?'':($5+'').trim();var $6=($0!=null)?$0.lastviewedpage:null;$6=($6==null)?'':$6.trim();var $7=($0!=null)?$0.lastviewedsection:null;$7=($7==null)?'':$7.trim();var $8=($0!=null&&$0.lastupdate!=null)?BvD.ServerDateTime.parse($0.lastupdate):null;var $9='';var $A='';var $B='';var $C='';var $D='';var $E=null;if($2!=null){$9=$2['flashparams'];$9=($9==null)?'':$9.trim();$A=$2['pfzoom'];$A=($A==null)?'':$A.trim();$B=$2['htmlzoom'];$B=($B==null)?'':$B.trim();$C=$2['lastviewedpage'];$C=($C==null)?'':$C.trim();$D=$2['lastviewedsection'];$D=($D==null)?'':$D.trim();$E=($2['lastupdate']==null)?null:BvD.ServerDateTime.parse($2['lastupdate']);}var $F={};$F['flashparams']=(!!$3)?$3:$9;$F['pfzoom']=(!!$4)?$4:$A;$F['htmlzoom']=(!!$5)?$5:$B;if($8!=null&&$8>(($E!=null)?$8:$E)){$F['lastupdate']=$8;$F['lastviewedpage']=$6;$F['lastviewedsection']=$7;}else{$F['lastupdate']=$E;$F['lastviewedpage']=$C;$F['lastviewedsection']=$D;}return $F;}}
CourseSmartReader.CReader$21=function(smartReader){CourseSmartReader.CReader$21.initializeBase(this);this.$1_0=smartReader;this.$1_1=this.$1_0.$0;}
CourseSmartReader.CReader$21.prototype={$1_0:null,$1_1:null,add:function($p0){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_2()){if(this.$1_0.get_isOffline()){var $0=this.$1_1.get_tableOfContents().getByXmlId($p0);if($0!=null){CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(this.$1_1.get_tableOfContents().get_root().get_xmlId()).addBoomark($0.get_xmlId(),(this.$1_0.get_isPageMode())?1:2);this.$1_5();}}else{var $1=new BvD.QueryString().set('__bookmarkxmlid',$p0).set('readerfilterflag',(this.$1_0.get_isPageMode())?'1':'2');BvD.Ajax.blank('bookreaderaddbookmark',$1,ss.Delegate.create(this,function($p1_0){
this.$1_5();}));}}else{this.$1_5();}},remove:function($p0){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_2()){if(this.$1_0.get_isOffline()){var $0=this.$1_1.get_bookmarks().getById($p0);if($0==null){return;}var $1=this.$1_1.get_tableOfContents().getByXmlId($0.xmlId);if($1==null){return;}var $2=(!$0.mode)?3:$0.mode;var $3=(this.$1_0.get_isPageMode())?1:2;var $4=3&~($2&~$3);CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(this.$1_1.get_tableOfContents().get_root().get_xmlId()).deleteBookmark($1.get_xmlId(),$p0,$4);this.$1_5();}else{var $5=new BvD.QueryString().set('__naction','del').set('__bookmarkid',$p0.toString()).set('readerfilterflag',(this.$1_0.get_isPageMode())?'1':'2');BvD.Ajax.blank('bookreaderbookmarks',$5,ss.Delegate.create(this,function($p1_0){
this.$1_5();}));}}else{this.$1_5();}},reload:function(){if(this.$1_0.get_isOffline()){var $0=this.$1_1.get_tableOfContents().get_root().get_xmlId();var $1=BvD.BookmarksParser.parse(CourseSmartLocalStorage.OfflineCache.getBookmarks($0));var $2=CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($0).get_bookmarks();var $dict1=$2;for(var $key2 in $dict1){var $4={key:$key2,value:$dict1[$key2]};var $5=$4.key;var $6=$4.value;var $7=($0+'/'+$5).toUpperCase();var $8=$6.deleted||$6.deleted2===3;var $9=-1;for(var $A=0;$A<$1.length;++$A){if($1[$A].xmlId.toUpperCase()===$7){$9=$A;break;}}if($9>-1){if($8){$1.removeAt($9);}else{var $B=$1[$9];var $C=3&~(($6.deleted2==null)?0:$6.deleted2);if($C!==$B.mode){var $D=new BvD.Bookmark($B.id,$B.xmlId,$B.utcDateTime,$C);$1.removeAt($9);$1.add($D);}}}else if(!$8){var $E=0;if($6.deleted2!=null){$E=3&~$6.deleted2;}var $F=new BvD.Bookmark($6.id,$6.xmlid,new BvD.BowDate(BvD.ServerDateTime.parse($6.date)),$E);$1.add($F);}}var $3=(this.$1_0.get_isPageMode())?2:1;$1=$1.filter(function($p1_0){
return $p1_0.mode!==$3;});return $1;}else{var $10=BvD.JsonUtils.decompress($('#BookmarksJSon').val());if(!BvD.Is.String($10)){$10='';}var $11=BvD.BookmarksParser.parse($10);var $12=(this.$1_0.get_isPageMode())?2:1;$11=$11.filter(function($p1_0){
return $p1_0.mode!==$12;});return $11;}},get_$1_2:function(){return this.$1_0.$1.allowBookmarks;},$1_3:function($p0,$p1){this.$1_1.get_bookmarks().reload();},$1_4:function(){var $0=this.$1_1.get_bookmarks().get_list();$0.sort(ss.Delegate.create(this,function($p1_0,$p1_1){
var $1_0=this.$1_1.get_tableOfContents().getByXmlId($p1_0.xmlId);var $1_1=this.$1_1.get_tableOfContents().getByXmlId($p1_1.xmlId);var $1_2=($1_0==null)?0:$1_0.get_position();var $1_3=($1_1==null)?0:$1_1.get_position();return $1_2-$1_3;}));return $0;},$1_5:function(){if(this.get_$1_2()&&!this.$1_0.get_isOffline()){BvD.Ajax.link(null,'AjaxBookmarks');}else{this.$1_1.get_bookmarks().reload();}}}
CourseSmartReader.CReader$24=function(smartReader){CourseSmartReader.CReader$24.initializeBase(this);this.$1_0=smartReader;this.$1_1=this.$1_0.$0;this.$1_2=null;}
CourseSmartReader.CReader$24.$1_6=function($p0){var $0={};$0.async=false;$0.cache=false;$0.data='specificnoteid='+$p0.toString();$0.url='/getnoteselection';$0.type='GET';$0.dataType='xml';var $1='';$.ajax($0).success(function($p1_0){
var $1_0=$p1_0;if($1_0==null){return;}var $1_1=$1_0.getElementsByTagName('selectiontext');if($1_1==null){return;}var $1_2=$1_1[0];if($1_2==null){return;}var $1_3=$1_2.firstChild;if($1_3==null){return;}$1=$1_3.nodeValue;});return $1;}
CourseSmartReader.CReader$24.prototype={$1_0:null,$1_1:null,$1_2:null,reload:function(){if(this.get_$1_3()){if(this.$1_0.get_isOffline()){this.$1_2=this.$1_1B();return this.$1_1C();}else{this.$1_2=new CourseSmartReader.CReader$1B($('#SharingNoteUsers').val());var $0=BvD.JsonUtils.decompress($('#NotesJSon').val());if(!BvD.Is.String($0)){$0='';}return BvD.NotesParser.parse($0);}}return null;},get_$1_3:function(){return this.$1_0.$1.allowNotes;},get_$1_4:function(){return this.$1_2;},$1_5:function($p0,$p1){this.$1_1.get_notes().reload();this.$1_8();},$1_7:false,$1_8:function(){if(this.$1_7){return;}var $0=$('#SharedNotes');if($0.length>0){var $1=$0.val();if(!String.isNullOrEmpty($1)){var $2=$1.split(',');var $3=0;var $4=null;$4=ss.Delegate.create(this,function(){
var $1_0=BvD.MathUtils.parseInt32($2[$3++],0);if($1_0>0){this.$1_7=true;var $1_1=new CourseSmartReader.CReader$1E(null,BvD.Xsl.get_currentXmlId(),$1_0);$1_1.add_onUpdate(ss.Delegate.create(this,function($p2_0,$p2_1){
this.$1_13();}));$1_1.add_closed(ss.Delegate.create(this,function($p2_0,$p2_1){
this.$1_7=false;$4();}));$1_1.show();}});$4();}}},$1_9:function($p0){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}var $0=$p0.id;if(this.get_$1_3()){if(this.$1_0.get_isOffline()){CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($p0.xmlId)).deleteNote($p0.id);this.$1_13();}else{var $1=new BvD.QueryString().set('__notecommentformat','1').set('xmlid',this.$1_1.get_currentTocEntry().get_xmlId()).set('__naction','del').set('__noteid',$0.toString());BvD.Ajax.blank('bookreadernotes',$1,ss.Delegate.create(this,function($p1_0){
this.$1_13();}));}}else{this.$1_13();}},$1_A:function($p0){if($p0==null){return;}var $0=this.$1_1.get_tableOfContents().getByXmlId($p0.xmlId);this.$1_14($0,-1,'','',$p0.type,'',$p0.normalizedPositionStart,$p0.normalizedPositionEnd,$p0.type,$p0.offsets,$p0.text,true,null);},$1_B:function($p0){if($p0==null||$p0.type===BvD.NoteType.page||$p0.isHighlightOnly){return;}this.$1_16($p0,null);},$1_C:function($p0,$p1){if($p0==null||$p0.type===BvD.NoteType.page){return;}this.$1_17($p0,$p1);},$1_D:function($p0){if($p0.type===BvD.NoteType.page){return true;}return ($p0.type===BvD.NoteType.html&&!this.$1_0.get_isPageMode())||($p0.type===BvD.NoteType.printFidelity&&this.$1_0.get_isPageMode());},$1_E:function(){var $0=this.$1_1.get_notes().get_list();$0.sort(ss.Delegate.create(this,function($p1_0,$p1_1){
if($p1_0==null&&$p1_1==null){return 0;}if($p1_0==null){return -1;}if($p1_1==null){return 1;}var $1_0=this.$1_1.get_tableOfContents().getByXmlId($p1_0.xmlId);var $1_1=this.$1_1.get_tableOfContents().getByXmlId($p1_1.xmlId);if($1_0==null&&$1_1==null){return 0;}if($1_0==null){return -1;}if($1_1==null){return 1;}return $1_0.get_position()-$1_1.get_position();}));return $0;},$1_F:function($p0,$p1){var $0=$p0;var $1=this.$1_1.get_currentTocEntry();if($0.get_$1_A()===-1){var $2=$0.get_$1_E();var $3=($2==null)?$0.get_$1_F():$2.type;var $4=($2==null)?null:$2.normalizedPositionStart;var $5=($2==null)?null:$2.normalizedPositionEnd;var $6=($2==null)?'':$2.text;var $7=($2==null)?null:$2.offsets;this.$1_14($1,-1,$0.get_$1_B(),$0.get_$1_C(),$3,'',$4,$5,$3,$7,$6,false,ss.Delegate.create($0,$0.$1_1E));}else{this.$1_15($1,$0.get_$1_D(),$0.get_$1_B(),$0.get_$1_C(),'',false,ss.Delegate.create($0,$0.$1_1E));}},$1_10:function($p0,$p1){var $0=$p0;this.$1_9($0.get_$1_D());},$1_11:function($p0,$p1){var $0=$p0;var $1=new CourseSmartReader.CReader$20(null,this.$1_1.get_currentTocEntry().get_xmlId(),$0.get_$1_10());$1.add_onLoad(ss.Delegate.create(this,function($p1_0,$p1_1){
this.$1_13();}));$1.show();},$1_12:function($p0){if(String.isNullOrEmpty($p0)){return $p0;}var $0=new RegExp('&nbsp;','ig');var $1=new RegExp('\\s*','ig');var $2=new RegExp('\\[[^\\]]*\\]','ig');var $3=new RegExp('\\[/[^\\]]*\\]','ig');var $4=new RegExp('[\r\n]+','ig');var $5=$p0.replace($0,'').replace($1,'').replace($2,'').replace($3,'').replace($4,'');if(!$5.length){return null;}return $p0;},$1_13:function(){if(this.get_$1_3()&&!this.$1_0.get_isOffline()){BvD.Ajax.link(null,'AjaxNotes');}else{this.$1_1.get_notes().reload();}},$1_14:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7,$p8,$p9,$p10,$p11,$p12){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_3()){if(this.$1_0.get_isOffline()){if(!$p11&&(String.isNullOrEmpty($p2)||String.isNullOrEmpty($p3))){this.$1_18(this.$1_1A(false,'Missing required parameter "Note title or comment".'),$p12);return;}var $0={};$0.id=-1;$0.xmlId=$p0.get_xmlId();$0.imagePage=$p0.get_page();$0.isHighlightOnly=$p11;$0.subject=$p2;$0.content=$p3;$0.selection=$p10;$0.commentFormat=1;if($p8===BvD.NoteType.printFidelity||$p8===BvD.NoteType.html){if($p8===BvD.NoteType.html){if($p9!=null){$0.coordinate=new Array(2);$0.coordinate[0]=$p9.start;$0.coordinate[1]=$p9.end;}}else if($p8===BvD.NoteType.printFidelity){$0.coordinate=new Array(4);if($p6!=null){$0.coordinate[0]=$p6.left;$0.coordinate[1]=$p6.top;}if($p7!=null){$0.coordinate[2]=$p7.left;$0.coordinate[3]=$p7.top;}}}CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($0.xmlId)).addOrUpdateNote($0);this.$1_18(null,$p12);}else{var $1=new BvD.QueryString().set('__notecommentformat','1').set('__da','1').set('xmlid',this.$1_1.get_tableOfContents().get_root().get_xmlId()).set('__notetitle',$p2).set('__notecomment',$p3).set('__notetags',$p5).set('__naction','add').set('__noteid',$p1.toString()).set('__htype',$p4.toString()).set('__notexmlid',$p0.get_xmlId()).set('__notehighlight',$p10).set('__imagepage',$p0.get_page()).set('__ishighlight',(($p11)?'1':'0'));if($p8!==BvD.NoteType.html){if($p6!=null){$1.set('__coord1',$p6.left.toString()).set('__coord2',$p6.top.toString());}if($p7!=null){$1.set('__coord3',$p7.left.toString()).set('__coord4',$p7.top.toString());}}else{if($p9!=null){$1.set('__coord1',$p9.start.toString()).set('__coord2',$p9.end.toString()).set('__coord3','0').set('__coord4','0');}}BvD.Ajax.blank('bookreadernotes',$1,ss.Delegate.create(this,function($p1_0){
this.$1_18($p1_0,$p12);}));}}else{this.$1_18(null,$p12);}},$1_15:function($p0,$p1,$p2,$p3,$p4,$p5,$p6){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_3()){if(this.$1_0.get_isOffline()){var $0=$p1.id;if($0===-1){this.$1_18(this.$1_1A(false,'Internal error'),$p6);return;}if($p5&&($p1.coordinates==null||!$p1.coordinates.left)){this.$1_18(this.$1_1A(false,'Internal error (2)'),$p6);return;}if(!$p5&&(String.isNullOrEmpty($p2)||String.isNullOrEmpty($p3))){this.$1_18(this.$1_1A(false,'Missing required parameter "Note title and comment".'),$p6);return;}var $1={};$1.id=$0;$1.xmlId=$p0.get_xmlId();$1.imagePage=$p0.get_page();$1.isHighlightOnly=$p5;$1.subject=$p2;$1.content=$p3;$1.commentFormat=1;CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($1.xmlId)).addOrUpdateNote($1);this.$1_18(null,$p6);}else{var $2=$p1.id;var $3=new BvD.QueryString().set('__notecommentformat','1').set('__da','1').set('xmlid',this.$1_1.get_tableOfContents().get_root().get_xmlId()).set('__notetitle',$p2).set('__notecomment',$p3).set('__notetags',$p4).set('__naction','edit').set('__noteid',$2.toString()).set('__notexmlid',$p0.get_xmlId()).set('__ishighlight',(($p5)?'1':'0'));BvD.Ajax.blank('bookreadernotes',$3,ss.Delegate.create(this,function($p1_0){
this.$1_18($p1_0,$p6);}));}}else{this.$1_18(null,$p6);}},$1_16:function($p0,$p1){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_3()){if(this.$1_0.get_isOffline()){var $0=$p0.id;if($0===-1){this.$1_18(this.$1_1A(false,'Internal error'),$p1);return;}var $1=this.$1_0.$0.get_tableOfContents().getByXmlId($p0.xmlId);var $2={};$2.id=$0;$2.xmlId=$1.get_xmlId();$2.imagePage=$1.get_page();$2.isHighlightOnly=false;$2.subject=$p0.title;$2.content=$p0.comment;$2.selection=null;$2.coordinate=null;$2.commentFormat=1;$2.removeHighlight=true;CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($2.xmlId)).addOrUpdateNote($2);this.$1_18(null,$p1);}else{var $3=new BvD.QueryString().set('__notecommentformat','1').set('__da','1').set('xmlid',this.$1_1.get_tableOfContents().get_root().get_xmlId()).set('__naction','topagenote').set('__noteid',$p0.id.toString()).set('getnotes','1');BvD.Ajax.blank('bookreadernotes',$3,ss.Delegate.create(this,function($p1_0){
this.$1_18($p1_0,$p1);}));}}else{this.$1_18(null,$p1);}},$1_17:function($p0,$p1){if(this.$1_0.$C){new CourseSmartReader.CReader$23().show();return;}if(this.get_$1_3()){if(this.$1_0.get_isOffline()){var $0=$p0.id;if($0===-1){this.$1_18(this.$1_1A(false,'Internal error'),$p1);return;}var $1=this.$1_0.$0.get_tableOfContents().getByXmlId($p0.xmlId);var $2={};$2.id=$0;$2.xmlId=$1.get_xmlId();$2.imagePage=$1.get_page();$2.isHighlightOnly=$p0.isHighlightOnly;$2.subject=$p0.title;$2.content=$p0.comment;$2.selection=null;$2.coordinate=null;$2.commentFormat=1;$2.removeHighlight=false;$2.removeContent=true;CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($2.xmlId)).addOrUpdateNote($2);this.$1_18(null,$p1);}else{var $3=new BvD.QueryString().set('__notecommentformat','1').set('__da','1').set('xmlid',this.$1_1.get_tableOfContents().get_root().get_xmlId()).set('__naction','tohighlightonly').set('__noteid',$p0.id.toString()).set('getnotes','1');BvD.Ajax.blank('bookreadernotes',$3,ss.Delegate.create(this,function($p1_0){
this.$1_18($p1_0,$p1);}));}}else{this.$1_18(null,$p1);}},$1_18:function($p0,$p1){var $0=null;if($p0!=null){var $3=$p0.BowXmlDocument;if($3==null){$3=$p0.get_responseXml();}if($3!=null){$0=$3.documentElement;}}var $1=$0==null||this.$1_19($0,'result').toLowerCase()==='true';var $2=null;if($0!=null){var $4=$0.getElementsByTagName('Errors');if($4!=null&&$4.length>0){$2=$4[0];}}if($p1!=null){$p1($1,$2);}if($1){this.$1_13();}},$1_19:function($p0,$p1){if($p0==null||$p1==null){return '';}for(var $0=0;$0<$p0.attributes.length;++$0){if($p0.attributes[$0].nodeName===$p1){return $p0.attributes[$0].nodeValue;}}return '';},$1_1A:function($p0,$p1){var $0=document.createElement('root');$0.setAttribute('result',($p0)?'True':'False');if(!$p0){var $2=function($p1_0,$p1_1){
var $1_0=document.createElement($p1_0);$1_0.appendChild(document.createTextNode($p1_1));return $1_0;};var $3=document.createElement('Errors');$0.appendChild($3);var $4=document.createElement('Error');$3.appendChild($4);$4.appendChild($2('Code','MissingRequiredParameter'));$4.appendChild($2('Code_Numeric','64'));$4.appendChild($2('Class','InvalidOrMissingParameter'));$4.appendChild($2('Class_Numeric','5'));$4.appendChild($2('Description',$p1));$4.appendChild($2('Data',''));}var $1={documentElement:$0};return {BowXmlDocument:$1};},$1_1B:function(){var $0=this.$1_0.$0.get_tableOfContents().get_root().get_xmlId();return new CourseSmartReader.CReader$1B(CourseSmartLocalStorage.OfflineCache.getSharingNoteUsers($0));},$1_1C:function(){var $0=this.$1_0.$0.get_tableOfContents().get_root().get_xmlId();var $1=BvD.NotesParser.parse(CourseSmartLocalStorage.OfflineCache.getNotes($0));var $2=CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item($0).get_notes();for(var $3=0;$3<$2.length;++$3){var $4=$2[$3];var $5=-1;var $6=null;for(var $7=0;$7<$1.length;++$7){if($1[$7].id===$4.id){$5=$7;$6=$1[$7];}}if($6!=null){if($4.deleted){$1.removeAt($5);}else{var $8=$4.subject||'';var $9=$4.content||'';var $A=new BvD.BowDate(($4.date!=null)?BvD.ServerDateTime.parse($4.date):Date.get_now());var $B=$6.isHighlightOnly;var $C=$6.type;var $D=$6.selection;var $E=$6.coordinates;var $F=$6.offsets;if($4.commentformat!==1){$9=$9.replaceAll('[','&#91;').replaceAll(']','&#93;');}if($4.hlremoved){$E=null;$F=null;}else if($4.contentremoved&&($E!=null||$F!=null)){$8='';$9='';}$B=($E!=null||$F!=null)&&!$8.trim()&&!$9.trim();var $10=new BvD.Note($6.id,$6.userId,$6.xmlId,$F,$E,$B,$C,$8,$9,$A,$D,null);$1.removeAt($5);$1.add($10);}}else{if($4.deleted||$4.id>0){continue;}var $11=$4.subject||'';var $12=$4.content||'';var $13=new BvD.BowDate(($4.date!=null)?BvD.ServerDateTime.parse($4.date):Date.get_now());var $14=$4.selection||'';var $15=null;var $16=null;if(!$4.hlremoved&&$4.coord!=null){if($4.coord.length===4&&!BvD.Is.NullOrUndefined($4.coord[2])){$15=BvD.Rectangle.fromLTRB($4.coord[0],$4.coord[1],$4.coord[2],$4.coord[3]);}else{$16=new BvD.Offsets($4.coord[0],$4.coord[1]);}}if($4.contentremoved&&($15!=null||$16!=null)){$11='';$12='';}if($4.commentformat!==1){$12=$12.replaceAll('[','&#91;').replaceAll(']','&#93;');}if($14.length>50){$14=$14.substr(0,50)+'...';}var $17=($15!=null||$16!=null)&&!$11.trim()&&!$12.trim();var $18=($15==null&&$16==null)?BvD.NoteType.page:(($15!=null)?BvD.NoteType.printFidelity:BvD.NoteType.html);var $19=new BvD.Note($4.id,BvD.Xsl.get_userId(),$4.fpid+'/'+$4.page,$16,$15,$17,$18,$11,$12,$13,$14,null);$1.add($19);}}return $1;}}
CourseSmartReader.CReader$11=function(smartReader){this.$2=BvD.ReaderView.undefined;this.$0=smartReader;this.$1=this.$0.$0;if(this.$0.get_isOffline()){this.$1.add_pageLoaded(ss.Delegate.create(this,this.$A));}this.$1.add_zoomChanged(ss.Delegate.create(this,this.$B));this.$1.add_viewChanged(ss.Delegate.create(this,this.$C));}
CourseSmartReader.CReader$11.prototype={$0:null,$1:null,$3:function(){this.$8(true,-2,false);},$4:function($p0,$p1){if($p1){BvD.Timer.stop('ReaderPreferences');if($p0===-1){$p0=this.$1.get_view();}BvD.Timer.setTimeout('ReaderPreferences',500,ss.Delegate.create(this,function(){
this.$4($p0,false);}));}else{this.$8(false,$p0,false);}},$5:function($p0){this.$8(true,$p0,false);},$6:function(){this.$8(true,0,true);},get_$7:function(){if(this.$0.get_isOffline()){return false;}return !BvD.Xsl.get_isLogged();},$8:function($p0,$p1,$p2){if(this.$0.get_isOffline()){$p0=true;$p1=0;$p2=true;}var $0=this.$1;if(!$0.get_isReady()){return;}if($0.get_mode()===BvD.ReaderMode.flash){if(!this.get_$7()){var $1=$0.createConfig($p0,$p1,$p2);var $2={};$2['flashparams']=$1;this.$9($2,false);}else{var $3=$0.createConfig(true,0,true);var $4={};$4['flashstate']=$3;this.$9($4,true);}}else{var $5=this.$0.modeToString($0.get_mode());var $6={};var $7=$p1===-1||$p2||$p1===$0.get_view();if($p0){$6['reader']=$5;}if($7){$6[$5+'zoom']=$0.get_zoomLevel().toString();}this.$9($6,this.get_$7());}},$9:function($p0,$p1){if(this.$0.get_isOffline()){if(!$p1){CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId(this.$1.get_currentTocEntry().get_xmlId())).setPreferences($p0);}}else{if(!$p1){var $0=new BvD.QueryString();var $dict1=$p0;for(var $key2 in $dict1){var $1={key:$key2,value:$dict1[$key2]};if($1.value!=null){$0.set('__'+$1.key,$1.value);}}if(!$0.get_isEmpty()){BvD.Ajax.blank('readerupdatepreferences',$0,null);}}else{var $dict3=$p0;for(var $key4 in $dict3){var $2={key:$key4,value:$dict3[$key4]};if($2.value!=null){BvD.Cookies.setStateValueParameter($2.key.toLowerCase(),$2.value);}}}}},$A:function($p0,$p1){BvD.Timer.stop('ReaderPreferences');BvD.Timer.setTimeout('ReaderPreferences',500,ss.Delegate.create(this,function(){
var $1_0=this.$1.get_currentTocEntry();if($1_0==null){return;}var $1_1={};if(this.$0.$0.get_mode()!==BvD.ReaderMode.html){$1_1['lastviewedpage']=$1_0.get_page();}$1_1['lastviewedsection']=$1_0.get_xmlId().split('/')[1];CourseSmartLocalStorage.OfflineCache.get_currentUser().get_item(BvD.BookSection.getBookId($1_0.get_xmlId())).setPreferences($1_1);}));},$B:function($p0,$p1){this.$4(-1,true);},$C:function($p0,$p1){if(this.$2!==BvD.ReaderView.undefined){this.$3();}this.$2=this.$1.get_view();}}
CourseSmartReader.CReader$6=function(smartReader){this.$0=smartReader;this.$1=smartReader.$0.get_tableOfContents();if(smartReader.get_isOffline()){this.$8();}}
CourseSmartReader.CReader$6.prototype={$0:null,$1:null,$2:null,$3:null,$4:function(){var $0=this.$1.get_root().get_children()[0];while($0!=null&&this.$5($0)){$0=$0.get_next();}return $0;},$5:function($p0){return this.$2!=null&&!this.$2.contains($p0.get_xmlId().toLocaleLowerCase());},$6:function($p0){return (this.$0.get_isPageMode())?this.$D($p0):this.$E($p0);},$7:function($p0){if($p0==null||$p0.get_isRoot()){return $p0;}var $0=$p0;do{if($0.get_role()==='Chapter'){return $0;}$0=$0.get_parent();}while($0.get_parent()!=null);var $1=0;var $2=null;$0=$p0;do{$1+=this.$A($0,$2);if($1>=20){return $0;}$2=$0;$0=$0.get_parent();}while($0.get_parent()!=null);return $p0;},$8:function(){var $0=CourseSmartLocalStorage.OfflineCache.getPagesList(this.$1.get_root().get_xmlId());var $1=this.$1.get_root().get_xmlId();var $2=this.$0.get_isPageMode();this.$2=[];this.$3=[];var $3=[];for(var $4=0;$4<$0.length;++$4){var $5=$0[$4];var $6=$1+'/'+$5.section;var $7=this.$1.getByXmlId($6);if($7==null){continue;}this.$9($7);if($2&&$5.pages!=null){var $dict1=$5.pages;for(var $key2 in $dict1){var $8={key:$key2,value:$dict1[$key2]};var $9=$8.key;if($3.contains($9)){continue;}$3.add($9);$6=$1+'/'+$8.key;$7=this.$1.getByXmlId($6);if($7==null){continue;}var $A=$7.getFirstDescendantOrFollowingBvdPage();$7=$A||$7;this.$3.add(new CourseSmartReader.CReader$1A($8.value,$7));}}}this.$3.sort(function($p1_0,$p1_1){
return $p1_0.$1.get_position()-$p1_1.$1.get_position();});},$9:function($p0){if(this.$0.get_isPageMode()){var $0=$p0.getFirstDescendantOrFollowingBvdPage();if($0!=null){while($0!=null&&!$0.get_isRoot()){this.$2.add($0.get_xmlId().toLowerCase());$0=$0.get_parent();}}}this.$2.add($p0.get_xmlId().toLowerCase());for(var $1=0;$1<$p0.get_children().length;++$1){this.$9($p0.get_children()[$1]);}},$A:function($p0,$p1){var $0=1;for(var $1=0;$1<$p0.get_children().length;++$1){var $2=$p0.get_children()[$1];if($2===$p1){continue;}$0+=this.$A($2,$p1);}return $0;},$B:function(){return this.$C(this.$0.$0.get_tableOfContents().get_root());},$C:function($p0){if($p0.get_isBvdPage()){return null;}if($p0.get_parent()!=null){return $p0;}for(var $0=0;$0<$p0.get_children().length;++$0){var $1=this.$C($p0.get_children()[$0]);if($1!=null){return $1;}}return null;},$D:function($p0){if($p0==null){return null;}var $0=$p0.getFirstDescendantOrFollowingBvdPage();return $0||$p0;},$E:function($p0){if($p0==null){return null;}if($p0.get_isBvdPage()){$p0=$p0.get_parent();}return ($p0==null||$p0.get_parent()==null)?this.$B():$p0;},$F:function($p0){if($p0.get_isBvdPage()){return null;}var $0=$p0.get_children();for(var $1=$0.length-1;$1>=0;$1--){var $2=this.$F($0[$1]);if($2!=null){return $2;}}return $p0;},$10:function(){var $0='<book title="'+BvD.HtmlUtils.escapeTagsEntitiesAndQuotes(this.$1.get_root().get_title())+'" smallcover="">';$0+='<pages>';for(var $1=0;$1<this.$3.length;++$1){var $2=this.$3[$1];var $3=$2.$1;$0+='<page xmlid="'+$3.get_xmlId()+'" num="'+$1+'" width="'+$2.$0.width+'" height="'+$2.$0.height+'" parentxmlid="'+$3.get_parent().get_xmlId()+'"';var $4='';var $5=$3;while($5!=null&&$5.get_parent()!=null){var $6=$5.get_xmlId();if($4.length>0){$4+=';';}$4=$6;$5=$5.get_parent();}$0+=' parentxmlids="'+$4+'">';$0+=BvD.HtmlUtils.escapeTagsEntitiesAndQuotes($3.get_page());$0+='</page>';}$0+='</pages>';$0+='<count>'+this.$3.length.toString()+'</count>';$0+='</book>';return $0;}}
CourseSmartReader.CReader$22.registerClass('CourseSmartReader.CReader$22',BvD.Layer);CourseSmartReader.CReader$23.registerClass('CourseSmartReader.CReader$23',BvD.Layer);CourseSmartReader.CReader$1E.registerClass('CourseSmartReader.CReader$1E',BvD.Layer);CourseSmartReader.CReader$20.registerClass('CourseSmartReader.CReader$20',BvD.Layer);CourseSmartReader._BBCode.registerClass('CourseSmartReader._BBCode');CourseSmartReader.CReader$18.registerClass('CourseSmartReader.CReader$18');CourseSmartReader.CReader$16.registerClass('CourseSmartReader.CReader$16');CourseSmartReader.CReader$2D.registerClass('CourseSmartReader.CReader$2D',BvD.HtmlContentsNavigator);CourseSmartReader.CReader$2E.registerClass('CourseSmartReader.CReader$2E',BvD.ImagesContentsNavigator);CourseSmartReader.CReader$1A.registerClass('CourseSmartReader.CReader$1A');CourseSmartReader.CReader$1C.registerClass('CourseSmartReader.CReader$1C');CourseSmartReader.CReader$19.registerClass('CourseSmartReader.CReader$19',null,CourseSmartReader.CReader$0);CourseSmartReader.CReader$15.registerClass('CourseSmartReader.CReader$15',null,CourseSmartReader.CReader$0);CourseSmartReader.CReader$14.registerClass('CourseSmartReader.CReader$14');CourseSmartReader.CReader$17.registerClass('CourseSmartReader.CReader$17');CourseSmartReader.CReader$2C.registerClass('CourseSmartReader.CReader$2C',BvD.ThumbnailsInfoProvider);CourseSmartReader.CReader$1B.registerClass('CourseSmartReader.CReader$1B');CourseSmartReader._WebApp.registerClass('CourseSmartReader._WebApp');CourseSmartReader.CReader$29.registerClass('CourseSmartReader.CReader$29',BvD.Layer);CourseSmartReader.CReader$2B.registerClass('CourseSmartReader.CReader$2B',BvD.Layer);CourseSmartReader._Layers.registerClass('CourseSmartReader._Layers');CourseSmartReader.CReader$1F.registerClass('CourseSmartReader.CReader$1F',BvD.Layer);CourseSmartReader.CReader$27.registerClass('CourseSmartReader.CReader$27',BvD.Layer);CourseSmartReader.CReader$28.registerClass('CourseSmartReader.CReader$28',BvD.Layer);CourseSmartReader.CReader$25.registerClass('CourseSmartReader.CReader$25',BvD.Layer);CourseSmartReader.CReader$26.registerClass('CourseSmartReader.CReader$26',BvD.Layer);CourseSmartReader.CReader$2A.registerClass('CourseSmartReader.CReader$2A',BvD.Layer);CourseSmartReader.CReader$7.registerClass('CourseSmartReader.CReader$7');CourseSmartReader.CReader$8.registerClass('CourseSmartReader.CReader$8');CourseSmartReader.CReader$A.registerClass('CourseSmartReader.CReader$A');CourseSmartReader.CReader$9.registerClass('CourseSmartReader.CReader$9');CourseSmartReader.CReader$4.registerClass('CourseSmartReader.CReader$4',null,CourseSmartReader.CReader$1);CourseSmartReader.CReader$5.registerClass('CourseSmartReader.CReader$5',null,CourseSmartReader.CReader$1);CourseSmartReader.CReader$10.registerClass('CourseSmartReader.CReader$10',null,CourseSmartReader.CReader$1);CourseSmartReader.CReader$F.registerClass('CourseSmartReader.CReader$F');CourseSmartReader.CReader$13.registerClass('CourseSmartReader.CReader$13');CourseSmartReader.CReader$12.registerClass('CourseSmartReader.CReader$12',null,CourseSmartReader.CReader$2);CourseSmartReader.CReader$C.registerClass('CourseSmartReader.CReader$C',null,CourseSmartReader.CReader$2);CourseSmartReader.CReader$B.registerClass('CourseSmartReader.CReader$B',null,CourseSmartReader.CReader$2);CourseSmartReader.CReader$D.registerClass('CourseSmartReader.CReader$D');CourseSmartReader.CReader$E.registerClass('CourseSmartReader.CReader$E');CourseSmartReader.SmartReader.registerClass('CourseSmartReader.SmartReader');CourseSmartReader.CReader$21.registerClass('CourseSmartReader.CReader$21',BvD.BookmarksReaderWriter);CourseSmartReader.CReader$24.registerClass('CourseSmartReader.CReader$24',BvD.NotesReaderWriter);CourseSmartReader.CReader$11.registerClass('CourseSmartReader.CReader$11');CourseSmartReader.CReader$6.registerClass('CourseSmartReader.CReader$6');CourseSmartReader._BBCode.$0=null;CourseSmartReader._Layers.$0=new BvD.ModalProperties('#012042',0.8,null,BvD.ZIndex.modal);CourseSmartReader.CReader$F.$0=new RegExp('<([^>]*)>','ig');CourseSmartReader.CReader$F.$1=new RegExp('\\[([^\\]]*)\\]','ig');})(jQuery);// This script was generated using Script# v0.7.4.0
